/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={669:(t,e,i)=>{t.exports=i(609)},448:(t,e,i)=>{"use strict";var s=i(867),n=i(26),r=i(372),o=i(327),a=i(97),h=i(109),c=i(985),u=i(61),l=i(655),d=i(263);t.exports=function(t){return new Promise((function(e,i){var p,f=t.data,m=t.headers,y=t.responseType;function g(){t.cancelToken&&t.cancelToken.unsubscribe(p),t.signal&&t.signal.removeEventListener("abort",p)}s.isFormData(f)&&delete m["Content-Type"];var v=new XMLHttpRequest;if(t.auth){var w=t.auth.username||"",b=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";m.Authorization="Basic "+btoa(w+":"+b)}var x=a(t.baseURL,t.url);function k(){if(v){var s="getAllResponseHeaders"in v?h(v.getAllResponseHeaders()):null,r={data:y&&"text"!==y&&"json"!==y?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:s,config:t,request:v};n((function(t){e(t),g()}),(function(t){i(t),g()}),r),v=null}}if(v.open(t.method.toUpperCase(),o(x,t.params,t.paramsSerializer),!0),v.timeout=t.timeout,"onloadend"in v?v.onloadend=k:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(k)},v.onabort=function(){v&&(i(u("Request aborted",t,"ECONNABORTED",v)),v=null)},v.onerror=function(){i(u("Network Error",t,null,v)),v=null},v.ontimeout=function(){var e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",s=t.transitional||l.transitional;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),i(u(e,t,s.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",v)),v=null},s.isStandardBrowserEnv()){var S=(t.withCredentials||c(x))&&t.xsrfCookieName?r.read(t.xsrfCookieName):void 0;S&&(m[t.xsrfHeaderName]=S)}"setRequestHeader"in v&&s.forEach(m,(function(t,e){void 0===f&&"content-type"===e.toLowerCase()?delete m[e]:v.setRequestHeader(e,t)})),s.isUndefined(t.withCredentials)||(v.withCredentials=!!t.withCredentials),y&&"json"!==y&&(v.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&v.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&v.upload&&v.upload.addEventListener("progress",t.onUploadProgress),(t.cancelToken||t.signal)&&(p=function(t){v&&(i(!t||t&&t.type?new d("canceled"):t),v.abort(),v=null)},t.cancelToken&&t.cancelToken.subscribe(p),t.signal&&(t.signal.aborted?p():t.signal.addEventListener("abort",p))),f||(f=null),v.send(f)}))}},609:(t,e,i)=>{"use strict";var s=i(867),n=i(849),r=i(321),o=i(185),a=function t(e){var i=new r(e),a=n(r.prototype.request,i);return s.extend(a,r.prototype,i),s.extend(a,i),a.create=function(i){return t(o(e,i))},a}(i(655));a.Axios=r,a.Cancel=i(263),a.CancelToken=i(972),a.isCancel=i(502),a.VERSION=i(288).version,a.all=function(t){return Promise.all(t)},a.spread=i(713),a.isAxiosError=i(268),t.exports=a,t.exports.default=a},263:t=>{"use strict";function e(t){this.message=t}e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,t.exports=e},972:(t,e,i)=>{"use strict";var s=i(263);function n(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var i=this;this.promise.then((function(t){if(i._listeners){var e,s=i._listeners.length;for(e=0;e<s;e++)i._listeners[e](t);i._listeners=null}})),this.promise.then=function(t){var e,s=new Promise((function(t){i.subscribe(t),e=t})).then(t);return s.cancel=function(){i.unsubscribe(e)},s},t((function(t){i.reason||(i.reason=new s(t),e(i.reason))}))}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]},n.prototype.unsubscribe=function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}},n.source=function(){var t;return{token:new n((function(e){t=e})),cancel:t}},t.exports=n},502:t=>{"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},321:(t,e,i)=>{"use strict";var s=i(867),n=i(327),r=i(782),o=i(572),a=i(185),h=i(875),c=h.validators;function u(t){this.defaults=t,this.interceptors={request:new r,response:new r}}u.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=t.transitional;void 0!==e&&h.assertOptions(e,{silentJSONParsing:c.transitional(c.boolean),forcedJSONParsing:c.transitional(c.boolean),clarifyTimeoutError:c.transitional(c.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}));var n,r=[];if(this.interceptors.response.forEach((function(t){r.push(t.fulfilled,t.rejected)})),!s){var u=[o,void 0];for(Array.prototype.unshift.apply(u,i),u=u.concat(r),n=Promise.resolve(t);u.length;)n=n.then(u.shift(),u.shift());return n}for(var l=t;i.length;){var d=i.shift(),p=i.shift();try{l=d(l)}catch(t){p(t);break}}try{n=o(l)}catch(t){return Promise.reject(t)}for(;r.length;)n=n.then(r.shift(),r.shift());return n},u.prototype.getUri=function(t){return t=a(this.defaults,t),n(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},s.forEach(["delete","get","head","options"],(function(t){u.prototype[t]=function(e,i){return this.request(a(i||{},{method:t,url:e,data:(i||{}).data}))}})),s.forEach(["post","put","patch"],(function(t){u.prototype[t]=function(e,i,s){return this.request(a(s||{},{method:t,url:e,data:i}))}})),t.exports=u},782:(t,e,i)=>{"use strict";var s=i(867);function n(){this.handlers=[]}n.prototype.use=function(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1},n.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},n.prototype.forEach=function(t){s.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=n},97:(t,e,i)=>{"use strict";var s=i(793),n=i(303);t.exports=function(t,e){return t&&!s(e)?n(t,e):e}},61:(t,e,i)=>{"use strict";var s=i(481);t.exports=function(t,e,i,n,r){var o=new Error(t);return s(o,e,i,n,r)}},572:(t,e,i)=>{"use strict";var s=i(867),n=i(527),r=i(502),o=i(655),a=i(263);function h(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new a("canceled")}t.exports=function(t){return h(t),t.headers=t.headers||{},t.data=n.call(t,t.data,t.headers,t.transformRequest),t.headers=s.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),s.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||o.adapter)(t).then((function(e){return h(t),e.data=n.call(t,e.data,e.headers,t.transformResponse),e}),(function(e){return r(e)||(h(t),e&&e.response&&(e.response.data=n.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},481:t=>{"use strict";t.exports=function(t,e,i,s,n){return t.config=e,i&&(t.code=i),t.request=s,t.response=n,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t}},185:(t,e,i)=>{"use strict";var s=i(867);t.exports=function(t,e){e=e||{};var i={};function n(t,e){return s.isPlainObject(t)&&s.isPlainObject(e)?s.merge(t,e):s.isPlainObject(e)?s.merge({},e):s.isArray(e)?e.slice():e}function r(i){return s.isUndefined(e[i])?s.isUndefined(t[i])?void 0:n(void 0,t[i]):n(t[i],e[i])}function o(t){if(!s.isUndefined(e[t]))return n(void 0,e[t])}function a(i){return s.isUndefined(e[i])?s.isUndefined(t[i])?void 0:n(void 0,t[i]):n(void 0,e[i])}function h(i){return i in e?n(t[i],e[i]):i in t?n(void 0,t[i]):void 0}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:h};return s.forEach(Object.keys(t).concat(Object.keys(e)),(function(t){var e=c[t]||r,n=e(t);s.isUndefined(n)&&e!==h||(i[t]=n)})),i}},26:(t,e,i)=>{"use strict";var s=i(61);t.exports=function(t,e,i){var n=i.config.validateStatus;i.status&&n&&!n(i.status)?e(s("Request failed with status code "+i.status,i.config,null,i.request,i)):t(i)}},527:(t,e,i)=>{"use strict";var s=i(867),n=i(655);t.exports=function(t,e,i){var r=this||n;return s.forEach(i,(function(i){t=i.call(r,t,e)})),t}},655:(t,e,i)=>{"use strict";var s=i(867),n=i(16),r=i(481),o={"Content-Type":"application/x-www-form-urlencoded"};function a(t,e){!s.isUndefined(t)&&s.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var h,c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(h=i(448)),h),transformRequest:[function(t,e){return n(e,"Accept"),n(e,"Content-Type"),s.isFormData(t)||s.isArrayBuffer(t)||s.isBuffer(t)||s.isStream(t)||s.isFile(t)||s.isBlob(t)?t:s.isArrayBufferView(t)?t.buffer:s.isURLSearchParams(t)?(a(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):s.isObject(t)||e&&"application/json"===e["Content-Type"]?(a(e,"application/json"),function(t,e,i){if(s.isString(t))try{return(0,JSON.parse)(t),s.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(0,JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||c.transitional,i=e&&e.silentJSONParsing,n=e&&e.forcedJSONParsing,o=!i&&"json"===this.responseType;if(o||n&&s.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(o){if("SyntaxError"===t.name)throw r(t,this,"E_JSON_PARSE");throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};s.forEach(["delete","get","head"],(function(t){c.headers[t]={}})),s.forEach(["post","put","patch"],(function(t){c.headers[t]=s.merge(o)})),t.exports=c},288:t=>{t.exports={version:"0.24.0"}},849:t=>{"use strict";t.exports=function(t,e){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return t.apply(e,i)}}},327:(t,e,i)=>{"use strict";var s=i(867);function n(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,i){if(!e)return t;var r;if(i)r=i(e);else if(s.isURLSearchParams(e))r=e.toString();else{var o=[];s.forEach(e,(function(t,e){null!=t&&(s.isArray(t)?e+="[]":t=[t],s.forEach(t,(function(t){s.isDate(t)?t=t.toISOString():s.isObject(t)&&(t=JSON.stringify(t)),o.push(n(e)+"="+n(t))})))})),r=o.join("&")}if(r){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+r}return t}},303:t=>{"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},372:(t,e,i)=>{"use strict";var s=i(867);t.exports=s.isStandardBrowserEnv()?{write:function(t,e,i,n,r,o){var a=[];a.push(t+"="+encodeURIComponent(e)),s.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),s.isString(n)&&a.push("path="+n),s.isString(r)&&a.push("domain="+r),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},793:t=>{"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},268:t=>{"use strict";t.exports=function(t){return"object"==typeof t&&!0===t.isAxiosError}},985:(t,e,i)=>{"use strict";var s=i(867);t.exports=s.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function n(t){var s=t;return e&&(i.setAttribute("href",s),s=i.href),i.setAttribute("href",s),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return t=n(window.location.href),function(e){var i=s.isString(e)?n(e):e;return i.protocol===t.protocol&&i.host===t.host}}():function(){return!0}},16:(t,e,i)=>{"use strict";var s=i(867);t.exports=function(t,e){s.forEach(t,(function(i,s){s!==e&&s.toUpperCase()===e.toUpperCase()&&(t[e]=i,delete t[s])}))}},109:(t,e,i)=>{"use strict";var s=i(867),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,i,r,o={};return t?(s.forEach(t.split("\n"),(function(t){if(r=t.indexOf(":"),e=s.trim(t.substr(0,r)).toLowerCase(),i=s.trim(t.substr(r+1)),e){if(o[e]&&n.indexOf(e)>=0)return;o[e]="set-cookie"===e?(o[e]?o[e]:[]).concat([i]):o[e]?o[e]+", "+i:i}})),o):o}},713:t=>{"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},875:(t,e,i)=>{"use strict";var s=i(288).version,n={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){n[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}}));var r={};n.transitional=function(t,e,i){function n(t,e){return"[Axios v"+s+"] Transitional option '"+t+"'"+e+(i?". "+i:"")}return function(i,s,o){if(!1===t)throw new Error(n(s," has been removed"+(e?" in "+e:"")));return e&&!r[s]&&(r[s]=!0,console.warn(n(s," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,s,o)}},t.exports={assertOptions:function(t,e,i){if("object"!=typeof t)throw new TypeError("options must be an object");for(var s=Object.keys(t),n=s.length;n-- >0;){var r=s[n],o=e[r];if(o){var a=t[r],h=void 0===a||o(a,r,t);if(!0!==h)throw new TypeError("option "+r+" must be "+h)}else if(!0!==i)throw Error("Unknown option "+r)}},validators:n}},867:(t,e,i)=>{"use strict";var s=i(849),n=Object.prototype.toString;function r(t){return"[object Array]"===n.call(t)}function o(t){return void 0===t}function a(t){return null!==t&&"object"==typeof t}function h(t){if("[object Object]"!==n.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function c(t){return"[object Function]"===n.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),r(t))for(var i=0,s=t.length;i<s;i++)e.call(null,t[i],i,t);else for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.call(null,t[n],n,t)}t.exports={isArray:r,isArrayBuffer:function(t){return"[object ArrayBuffer]"===n.call(t)},isBuffer:function(t){return null!==t&&!o(t)&&null!==t.constructor&&!o(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:a,isPlainObject:h,isUndefined:o,isDate:function(t){return"[object Date]"===n.call(t)},isFile:function(t){return"[object File]"===n.call(t)},isBlob:function(t){return"[object Blob]"===n.call(t)},isFunction:c,isStream:function(t){return a(t)&&c(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function t(){var e={};function i(i,s){h(e[s])&&h(i)?e[s]=t(e[s],i):h(i)?e[s]=t({},i):r(i)?e[s]=i.slice():e[s]=i}for(var s=0,n=arguments.length;s<n;s++)u(arguments[s],i);return e},extend:function(t,e,i){return u(e,(function(e,n){t[n]=i&&"function"==typeof e?s(e,i):e})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";class t extends Phaser.GameObjects.Container{constructor(t,e,i,s,n){super(t),this.scene=t,this.x=e,this.y=i,this.btn=t.add.image(e,i,s).setOrigin(0),this.btn.setInteractive().on("pointerdown",n)}get width(){return this.btn.width}get height(){return this.btn.height}update(t,e){t&&(this.x=t,this.btn.x=t),e&&(this.y=e,this.btn.y=e)}destroy(){this.btn.destroy()}}var e=i(669),s=i.n(e);class n extends Phaser.Scene{constructor(t,e){super(),this.playPreroll=t,this.callback=e}preload(){try{document.getElementsByClassName("grecaptcha-badge")[0].style.opacity=100}catch(t){console.log("captcha hasnt loaded yet")}}create(){this.optimalServer="us2";const e=(t=!0)=>{var e={us1:"https://us2.swordbattle.io",us2:"https://sword-io-game.herokuapp.com",eu1:"https://swordbattle.herokuapp.com"},i=t=>new Promise(((i,s)=>{var n=Date.now(),r={error:!1,ping:0,info:{}};fetch(e[t]+"/api/serverinfo?t="+Date.now()).then((t=>{200==t.status?(r.ping=Date.now()-n,t.json().then((t=>{r.info=t,i(r)})).catch((t=>{r.error=!0,i(r)}))):(r.error=!0,i(r))})).catch((t=>{r.error=!0,i(r)}))})),s=[],n=["us1","us2","eu1"],r=["USA","USA 2","Europe"];i("us1").then((e=>{s.push(e),i("us2").then((e=>{s.push(e),i("eu1").then((e=>{if(s.push(e),s.filter((t=>t.error)).length==s.length)alert("Could not find an available server. Please try again later.");else{var i=s.map((t=>t.ping-10*t.info.playerCount+("No lag"==t.info.lag?0:"Moderate lag"==t.info.lag?200:500)+(t.info.playerCount>20?50*Math.abs(20-t.info.playerCount):0))).map((t=>t||1/0)),o=n[i.indexOf(Math.min(...i))];console.log("optimal server found: "+o+" with score: "+Math.min(...i)),this.optimalServer=o,console.log(t),t&&(n.forEach(((t,e)=>{document.getElementById(t).innerHTML=r[e]+(s[e].error?" (OFFLINE)":` (${s[e].ping}ms, ${s[e].info.playerCount} players)`)})),document.getElementById("auto").innerHTML="Auto ("+r[i.indexOf(Math.min(...i))]+")")}}))}))}))};var i=(t,e,i)=>t<e?e:t>i?i:t;this.footerdone=!1,this.redirect=!1;var n=!0;try{window.localStorage}catch(t){n=!1}n?window.localStorage.getItem("options")?this.options=JSON.parse(window.localStorage.getItem("options")):(this.options={movementMode:"keys",sound:"normal",server:"auto"},window.localStorage.setItem("options",JSON.stringify(this.options))):this.options={movementMode:"keys",sound:"normal",server:"auto"};try{this.music=this.sound.add("openingsound",{mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!0,delay:0}),this.music.play()}catch(t){return}this.background=this.add.image(0,0,"opening").setOrigin(0).setScrollFactor(0,0).setScale(2),this.footer=this.add.dom(this.canvas.width/2,this.canvas.height).createFromCache("footer").setOrigin(.5).setScale(this.mobile?1:2),this.nameBox=this.add.dom(this.canvas.width/2,0).createFromCache("title"),this.showPromo&&(this.promo=this.add.dom(0,0).createFromCache("promo"),this.promo.x=this.canvas.width/2,this.promo.y=this.canvas.height/2,this.promo.getChildByName("close").onclick=()=>{this.promo.destroy()},e(!1)),this.nameBox.getChildByName("name").value=n&&window.localStorage.getItem("oldName")?window.localStorage.getItem("oldName"):"",this.done=!1,this.text=this.add.text(this.canvas.width/2,0,"Swordbattle.io",{fontSize:"64px",fill:"#000000"}).setOrigin(.5),"normal"==this.options.sound?this.music.volume=.5:"high"==this.options.sound?this.music.volume=1:"low"==this.options.sound?this.music.volume=.2:"off"==this.options.sound?this.music.volume=0:(this.options.sound="normal",this.music.volume=.5,n&&window.localStorage.setItem("options",JSON.stringify(this.options))),this.options.hasOwnProperty("server")||(this.options.server="auto",n&&window.localStorage.setItem("options",JSON.stringify(this.options))),this.settingsBtn=new t(this,0,0,"settingsBtn",(()=>{if(!(this.promo&&this.promo.visible||this.login&&this.login.visible||this.signup&&this.signup.visible)){if(this.settings&&this.settings.visible)return this.settings.destroy();this.settings=this.add.dom(0,0).createFromCache("settings"),this.settings.x=this.canvas.width/2,this.settings.y=this.canvas.height/2,this.settings.getChildByName("close").onclick=()=>{this.settings.destroy()},document.getElementById("movement").value=this.options.movementMode,document.getElementById("sound").value=this.options.sound,document.getElementById("server").value=this.options.server,e(),document.getElementById("movement").onchange=()=>{this.options.movementMode=document.getElementById("movement").value,n&&window.localStorage.setItem("options",JSON.stringify(this.options))},document.getElementById("sound").onchange=()=>{this.options.sound=document.getElementById("sound").value,n&&window.localStorage.setItem("options",JSON.stringify(this.options)),"normal"==this.options.sound?this.music.volume=.6:"high"==this.options.sound?this.music.volume=1.2:"low"==this.options.sound?this.music.volume=.2:"off"==this.options.sound&&(this.music.volume=0)},document.getElementById("server").onchange=()=>{this.options.server=document.getElementById("server").value,n&&window.localStorage.setItem("options",JSON.stringify(this.options))}}}));const r=()=>{let t=this.nameBox.getChildByName("name");if(t&&""!=t.value&&!this.done){this.done=!0,n&&window.localStorage.setItem("oldName",t.value);var e=t.value;this.playPreroll&&void 0!==aiptag.adplayer?(this.nameBox.getChildByName("btn").innerHTML="Connecting..",this.nameBox.getChildByName("btn").style.backgroundColor="grey",this.music.stop(),aiptag.cmd.player.push((()=>{aiptag.adplayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!0,AD_CENTERPLAYER:!1,LOADING_TEXT:"loading advertisement",PREROLL_ELEM:function(){return document.getElementById("preroll")},AIP_COMPLETE:t=>{this.nameBox.destroy(),document.getElementById("game").focus(),this.callback(e,this.music,this.secret),console.log("Preroll Ad Completed: "+t)}})})),aiptag.cmd.player.push((()=>{aiptag.adplayer.startPreRoll()}))):(this.nameBox.destroy(),this.callback(e,this.music,this.secret))}};var o=()=>{this.promo&&this.promo.visible?this.promo.destroy():this.login&&this.login.visible?this.login.getChildByName("login").click():this.signup&&this.signup.visible?this.signup.getChildByName("signup").click():this.nameBox.getChildByName("btn").disabled||(this.settings&&this.settings.visible?this.settings.destroy():r())};this.nameBox.getChildByName("btn").onclick=()=>{o()},this.returnKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER,!1),this.returnKey.on("down",(t=>{o()}));var a=!1;this.secret=void 0;const h=t=>{this.nameBox.getChildByName("btn").innerHTML="Connecting..",this.nameBox.getChildByName("btn").disabled=!0,console.log("Attempting to login"),grecaptcha.ready((()=>{grecaptcha.execute("6LdVxgYdAAAAAPtvjrXLAzSd2ANyzIkiSqk_yFpt",{action:"relogin"}).then((e=>{s().post("/api/loginsecret",{secret:t,captcha:e}).then((e=>{if(e.data.error){alert("Login Error: "+e.data.error);try{window.localStorage.getItem("secret")&&window.localStorage.removeItem("secret")}catch(t){}return u(),void console.log(e)}try{window.localStorage.setItem("secret",t)}catch(t){console.log("Failed to save secret"),console.log(t)}a=!0,this.secret=t,console.log("Logged in"),this.loginButton&&this.loginButton.destroy(),this.signupButton&&this.signupButton.destroy(),this.nameBox&&this.nameBox.visible&&(this.nameBox.getChildByName("name").value=e.data.username,this.nameBox.getChildByName("name").disabled=!0,this.nameBox.getChildByName("name").classList.add("loggedin"),this.nameBox.getChildByName("btn").innerHTML="Play!",this.nameBox.getChildByName("btn").disabled=!1,this.accountData=e.data,c())})).catch((t=>{console.log("Login Error: "),console.log(t),alert("Failed to login automatically, please try manually.")}))}))}))};var c=()=>{this.dropdown=this.add.dom(0,0).createFromCache("dropdown").setOrigin(0),document.getElementById("username").innerHTML=this.accountData.username,document.getElementById("profile").setAttribute("onclick",`location.href='/${this.accountData.username}'`),this.nameBox.getChildByName("name").classList.add("loggedin"),this.nameBox.getChildByName("name").disabled=!0,document.getElementById("username").style.fontSize="30px",this.dropdown.x=this.canvas.width/1.2-document.getElementById("username").getBoundingClientRect().width,this.dropdown.y=-20,document.getElementById("logout").onclick=()=>{this.dropdown.destroy();try{window.localStorage.removeItem("secret")}catch(t){console.log("failed to clear local storage")}this.secret=void 0,this.accountData=void 0,a=!1,this.nameBox.getChildByName("name").disabled=!1,this.nameBox.getChildByName("name").classList.remove("loggedin"),this.nameBox.getChildByName("name").value="";try{window.localStorage.removeItem("oldName")}catch(t){console.log("failed to clear local storage oldname")}u(),d()}};this.shopBtn=new t(this,10,10,"shopBtn",(()=>{document.getElementById("shopFrame").contentWindow.location.replace("/shop?secret="+this.secret),document.getElementById("shopFrame").onload=()=>{var t=document.getElementById("shopFrame").contentWindow.document;document.getElementById("shopFrame").style.display="",t.getElementById("closeShop").onclick=()=>{document.getElementById("shopFrame").style.display="none"}}})),this.shopBtn.btn.setScale(this.canvas.width/6e3),this.shopBtn.btn.setScale(4*this.shopBtn.btn.scale);var u=()=>{a||(this.loginButton=new t(this,this.canvas.width-(this.canvas.width>610?300:100),0,"loginbtn",(()=>{this.promo&&this.promo.visible||this.signup&&this.signup.visible||this.settings&&this.settings.visible||this.login&&this.login.visible||(this.login=this.add.dom(0,0).createFromCache("login"),this.login.x=this.canvas.width/2,this.login.y=this.canvas.height/2,this.login.getChildByName("close").onclick=()=>{this.login.destroy()},this.login.getChildByName("login").onclick=()=>{grecaptcha.ready((()=>{grecaptcha.execute("6LdVxgYdAAAAAPtvjrXLAzSd2ANyzIkiSqk_yFpt",{action:"login"}).then((t=>{try{var e=this.login.getChildByName("username").value,i=this.login.getChildByName("password").value;if(""==e.trim()||""==i)return;this.login.getChildByName("login").innerHTML="Logging in..",this.login.getChildByName("login").disabled=!0,this.login.getChildByName("close").disabled=!0,s().post("/api/login",{username:e,password:i,captcha:t}).then((t=>{if(t.data.error)alert(t.data.error),this.login.getChildByName("login").disabled=!1,this.login.getChildByName("close").disabled=!1,this.login.getChildByName("login").innerHTML="Login";else{this.login.getChildByName("login").disabled=!1,this.login.getChildByName("close").disabled=!1,this.login.getChildByName("login").innerHTML="Login",this.login.destroy();try{h(t.data.secret)}catch(t){console.log("Failed to login"),console.log(t)}}})).catch((t=>{alert("Unexpected error, please try again later"),console.log(t),this.login.getChildByName("login").disabled=!1,this.login.getChildByName("close").disabled=!1,this.login.getChildByName("login").innerHTML="Login"}))}catch(t){console.log(t)}}))}))})})),this.signupButton=new t(this,this.canvas.width-(this.canvas.width>610?300:100),0,"signupbtn",(()=>{this.promo&&this.promo.visible||this.signup&&this.signup.visible||this.settings&&this.settings.visible||this.login&&this.login.visible||(this.signup=this.add.dom(0,0).createFromCache("signup"),this.signup.x=this.canvas.width/2,this.signup.y=this.canvas.height/2,this.signup.getChildByName("close").onclick=()=>{this.signup.destroy()},this.signup.getChildByName("signup").onclick=()=>{grecaptcha.ready((()=>{grecaptcha.execute("6LdVxgYdAAAAAPtvjrXLAzSd2ANyzIkiSqk_yFpt",{action:"signup"}).then((t=>{try{var e=this.signup.getChildByName("username").value,i=this.signup.getChildByName("password").value,n=this.signup.getChildByName("email").value;if(""==e.trim()||""==i)return;this.signup.getChildByName("signup").innerHTML="Signing up..",this.signup.getChildByName("signup").disabled=!0,this.signup.getChildByName("close").disabled=!0,s().post("/api/signup",{username:e,password:i,email:n,captcha:t}).then((t=>{if(t.data.error)alert(t.data.error),this.signup.getChildByName("signup").disabled=!1,this.signup.getChildByName("close").disabled=!1,this.signup.getChildByName("signup").innerHTML="Sign Up";else{this.signup.getChildByName("signup").disabled=!1,this.signup.getChildByName("close").disabled=!1,this.signup.getChildByName("signup").innerHTML="Sign Up",this.signup.destroy();try{h(t.data.secret)}catch(t){console.log("Failed to login"),console.log(t)}}})).catch((t=>{alert("Unexpected error, please try again later"),console.log(t),this.login.getChildByName("login").disabled=!1,this.login.getChildByName("close").disabled=!1,this.login.getChildByName("login").innerHTML="Login"}))}catch(t){console.log(t)}}))}))})})),this.loginButton.btn.setScale(.25),this.signupButton.btn.setScale(.25))};try{var l=window.localStorage.getItem("secret");l&&!this.accountData?h(l):l&&this.accountData?(this.secret=this.accountData.secret,c()):u()}catch(t){console.log("failed to autologin"),console.log(t)}const d=(t=!1)=>{this.game.scale.resize(this.canvas.width,this.canvas.height);try{const t=this.cameras.main.width,e=this.cameras.main.height;this.shopBtn.btn.setScale(i(this.canvas.width/6e3,.05,.2)),this.shopBtn.btn.setScale(4*this.shopBtn.btn.scale),this.background.setScale(Math.max(t/this.background.width,e/this.background.height)),this.background.x=0-(this.background.displayWidth-t)/2}catch(t){}this.nameBox.x=this.canvas.width/2,this.text.x=this.canvas.width/2,this.settingsBtn.btn.setScale(i(this.canvas.width/1e4,.08,.4)),this.settingsBtn.btn.y=this.canvas.height-this.settingsBtn.btn.displayHeight,this.settings&&this.settings.visible&&(this.settings.x=this.canvas.width/2,this.settings.y=this.canvas.height/2);var e=.17;this.canvas.width<950&&(e-=.035),this.canvas.width<870&&(e-=.025),this.canvas.width<750&&(e-=.015),this.canvas.width<610&&(e-=.015),this.canvas.width<500&&(e-=.0035),this.loginButton&&this.loginButton.btn.setScale(e),this.signupButton&&this.signupButton.btn.setScale(e),this.loginButton&&this.loginButton.update(this.canvas.width-this.loginButton.btn.displayWidth,0),this.signupButton&&this.signupButton.update(this.canvas.width-this.signupButton.btn.displayWidth,this.loginButton.btn.displayHeight+10),this.dropdown&&this.dropdown.visible&&(this.dropdown.x=this.canvas.width/1.2-document.getElementById("username").getBoundingClientRect().width),this.scene.isActive("title")&&(this.promo&&this.promo.visible||this.signup&&this.signup.visible||this.login&&this.login.visible||this.settings&&this.settings.visible||(this.footer.destroy(),this.footer=this.add.dom(this.canvas.width/2,this.canvas.height).createFromCache("footer").setOrigin(.5).setScale(this.mobile?1:2)));var s=this.canvas.height-this.footer.height;this.canvas.height<384&&(s=this.canvas.height-this.footer.height/2),this.footerdone&&(this.text.y=this.canvas.height/4),this.footerdone&&(this.footer.y=s);try{this.text.setFontSize(this.canvas.width/13)}catch(t){}this.footer.x=this.canvas.width/2,this.promo&&this.promo.visible&&(this.promo.x=this.canvas.width/2,this.promo.y=this.canvas.height/2),this.login&&this.login.visible&&(this.login.x=this.canvas.width/2,this.login.y=this.canvas.height/2),this.signup&&this.signup.visible&&(this.signup.x=this.canvas.width/2,this.signup.y=this.canvas.height/2)};var p;window.addEventListener("resize",(function(){clearTimeout(p),p=setTimeout(d,100)})),d(!0);var f=this.canvas.height-this.footer.height;this.canvas.height<384&&(f=this.canvas.height-this.footer.height/2),this.tweens.add({targets:this.footer,y:f,onComplete:()=>{this.footerdone=!0},duration:1e3,ease:"Power2"}),this.tweens.add({targets:this.text,y:this.canvas.height/4,duration:1e3,ease:"Power2"})}update(t){this.nameBox.y=this.mobile?this.text.y+this.text.height/2:this.text.y+this.text.height;var e=this.canvas.height-this.footer.height;this.canvas.height<384&&(e=this.canvas.height-this.footer.height/2),this.footerdone&&this.footer.y!=e&&(this.footer.y=e)}}const r=n,o=class{constructor(t,e,i,s,n,r=!1){this.custom=r,this.bar=new Phaser.GameObjects.Graphics(t).setDepth(99),this.x=e,this.y=i,this.maxValue=100,this.value=0,this.toLerp=0,this.height=n,this.width=s,t.add.existing(this.bar)}setHealth(t){var e,i;return this.value=(e=t,0,i=this.maxValue,Math.min(Math.max(e,0),i)),this.draw(),0===this.value}setLerpValue(t){this.toLerp=t}draw(){this.bar.clear(),this.bar.fillStyle(0),this.bar.fillRect(this.x,this.y,this.width,this.height),this.bar.fillStyle(16777215),this.bar.fillRect(this.x+2,this.y+2,this.width-4,this.height-4),this.custom?this.bar.fillStyle(65535):this.value/this.maxValue<.3?this.bar.fillStyle(16711680):this.value/this.maxValue<.5?this.bar.fillStyle(16776960):this.bar.fillStyle(65280);var t=Math.floor((this.width-4)*(this.value/this.maxValue));this.bar.fillRect(this.x+2,this.y+2,t,this.height-4)}update(){this.setHealth((1-.25)*this.value+.25*this.toLerp)}destroy(){this.bar.destroy()}};function a(t,e){for(var i=e.length,s=new Array(i+1),n=0;n<i;++n)s[n]=e[n];return s[i]=t,s}function h(t,e,i){for(var s=e,n=0,r=i.length;n<r;++n)s=t(s,i[n],n);return s}function c(t,e){for(var i=e.length,s=new Array(i),n=0,r=void 0,o=0;o<i;++o)t(r=e[o])||(s[n]=r,++n);return s.length=n,s}function u(t,e){for(var i=0,s=e.length;i<s;++i)if(t===e[i])return i;return-1}var l=function(t){return t},d=function(t,e){return t(e)};function p(t){return function e(i,s){switch(arguments.length){case 0:return e;case 1:return function(e){return t(i,e)};default:return t(i,s)}}}function f(t){return function e(i,s,n){switch(arguments.length){case 0:return e;case 1:return p((function(e,s){return t(i,e,s)}));case 2:return function(e){return t(i,s,e)};default:return t(i,s,n)}}}var m=function(){function t(t,e,i,s,n){this.time=t,this.localOffset=e,this.period=i,this.task=s,this.scheduler=n,this.active=!0}return t.prototype.run=function(){return this.task.run(this.time-this.localOffset)},t.prototype.error=function(t){return this.task.error(this.time-this.localOffset,t)},t.prototype.dispose=function(){return this.active=!1,this.scheduler.cancel(this),this.task.dispose()},t}(),y=function(){function t(t,e){this.origin=t,this.scheduler=e}return t.prototype.currentTime=function(){return this.scheduler.currentTime()-this.origin},t.prototype.scheduleTask=function(t,e,i,s){return this.scheduler.scheduleTask(t+this.origin,e,i,s)},t.prototype.relative=function(e){return new t(e+this.origin,this.scheduler)},t.prototype.cancel=function(t){return this.scheduler.cancel(t)},t.prototype.cancelAll=function(t){return this.scheduler.cancelAll(t)},t}();function g(t){try{return t.run()}catch(e){return t.error(e)}}var v=function(){function t(t,e){var i=this;this._runReadyTasksBound=function(){return i._runReadyTasks()},this.timer=t,this.timeline=e,this._timer=null,this._nextArrival=1/0}return t.prototype.currentTime=function(){return this.timer.now()},t.prototype.scheduleTask=function(t,e,i,s){var n=this.currentTime()+Math.max(0,e),r=new m(n,t,i,s,this);return this.timeline.add(r),this._scheduleNextRun(),r},t.prototype.relative=function(t){return new y(t,this)},t.prototype.cancel=function(t){t.active=!1,this.timeline.remove(t)&&this._reschedule()},t.prototype.cancelAll=function(t){this.timeline.removeAll(t),this._reschedule()},t.prototype._reschedule=function(){this.timeline.isEmpty()?this._unschedule():this._scheduleNextRun()},t.prototype._unschedule=function(){this.timer.clearTimer(this._timer),this._timer=null},t.prototype._scheduleNextRun=function(){if(!this.timeline.isEmpty()){var t=this.timeline.nextArrival();null===this._timer?this._scheduleNextArrival(t):t<this._nextArrival&&(this._unschedule(),this._scheduleNextArrival(t))}},t.prototype._scheduleNextArrival=function(t){this._nextArrival=t;var e=Math.max(0,t-this.currentTime());this._timer=this.timer.setTimer(this._runReadyTasksBound,e)},t.prototype._runReadyTasks=function(){this._timer=null,this.timeline.runTasks(this.currentTime(),g),this._scheduleNextRun()},t}(),w=function(){function t(){this.tasks=[]}return t.prototype.nextArrival=function(){return this.isEmpty()?1/0:this.tasks[0].time},t.prototype.isEmpty=function(){return 0===this.tasks.length},t.prototype.add=function(t){x(t,this.tasks)},t.prototype.remove=function(t){var e=T(k(t),this.tasks);if(e>=0&&e<this.tasks.length){var i=this.tasks[e].events,s=u(t,i);if(s>=0)return i.splice(s,1),0===i.length&&this.tasks.splice(e,1),!0}return!1},t.prototype.removeAll=function(t){for(var e=0;e<this.tasks.length;++e)S(t,this.tasks[e])},t.prototype.runTasks=function(t,e){for(var i=this.tasks,s=i.length,n=0;n<s&&i[n].time<=t;)++n;this.tasks=i.slice(n);for(var r=0;r<n;++r)this.tasks=b(e,i[r].events,this.tasks)},t}();function b(t,e,i){for(var s=0;s<e.length;++s){var n=e[s];n.active&&(t(n),n.period>=0&&n.active&&(n.time=n.time+n.period,x(n,i)))}return i}function x(t,e){var i=e.length,s=k(t);if(0!==i){var n=T(s,e);n>=i?e.push(B(s,[t])):function(t,e,i,s){var n=e[s];i===n.time?function(t,e){0===e.length||t.time>=e[e.length-1].time?e.push(t):function(t,e){for(var i=0;i<e.length;i++)if(t.time<e[i].time){e.splice(i,0,t);break}}(t,e)}(t,n.events):e.splice(s,0,B(i,[t]))}(t,e,s,n)}else e.push(B(s,[t]))}function k(t){return Math.floor(t.time)}function S(t,e){e.events=c(t,e.events)}function T(t,e){for(var i,s,n=0,r=e.length;n<r;){if(t===(s=e[i=Math.floor((n+r)/2)]).time)return i;t<s.time?r=i:n=i+1}return r}var B=function(t,e){return{time:t,events:e}},A=function(){function t(t){this._clock=t}return t.prototype.now=function(){return this._clock.now()},t.prototype.setTimer=function(t,e){return e<=0?function(t){var e=new C(t);return function(t){Promise.resolve(t).then(g)}(e),e}(t):setTimeout(t,e)},t.prototype.clearTimer=function(t){return t instanceof C?t.cancel():clearTimeout(t)},t}(),C=function(){function t(t){this.f=t,this.active=!0}return t.prototype.run=function(){if(this.active)return this.f()},t.prototype.error=function(t){throw t},t.prototype.cancel=function(){this.active=!1},t}(),O=function(){function t(t,e){this.origin=e,this.clock=t}return t.prototype.now=function(){return this.clock.now()-this.origin},t}(),P=function(){function t(t,e){this.origin=e,this.hrtime=t}return t.prototype.now=function(){var t=this.hrtime(this.origin);return(1e9*t[0]+t[1])/1e6},t}(),E=function(t){return new O(t,t.now())},j=function(t){return t.currentTime()},_=p((function(t,e){return e.scheduleTask(0,0,-1,t)})),M=f((function(t,e,i){return i.scheduleTask(0,t,-1,e)})),N=(f((function(t,e,i){return i.scheduleTask(0,0,t,e)})),function(t){return t.dispose()}),D=(p((function(t,e){return console.warn("DEPRECATED cancelAllTasks to be removed in 2.0.0"),e.cancelAll(t)})),p((function(t,e){return new y(t,e)}))),F=(p((function(t,e){return new v(t,e)})),function(){return new v(I(),new w)}),I=function(){return new A("undefined"!=typeof performance&&"function"==typeof performance.now?E(performance):"undefined"!=typeof process&&"function"==typeof process.hrtime?new P(process.hrtime,process.hrtime()):E(Date))},R=function(){return L},L=new(function(){function t(){}return t.prototype.dispose=function(){},t}()),z=function(t){return new H(t)},H=function(){function t(t){this.disposed=!1,this.disposable=t}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposable&&(this.disposable.dispose(),this.disposable=void 0))},t}(),U=(p((function(t,e){return z(new U(t,e))})),function(){function t(t,e){this._dispose=t,this._resource=e}return t.prototype.dispose=function(){this._dispose(this._resource)},t}()),q=function(t){var e=h(V,[],t);return 0===e.length?R():new W(e)},G=p((function(t,e){return q([t,e])})),V=function(t,e){return function(t){return t===L}(e)?t:e instanceof W?function(t,e){var i=t.length,s=e.length,n=new Array(i+s),r=0;for(r=0;r<i;r++)n[r]=t[r];for(var o=0;o<s;o++)n[r++]=e[o];return n}(t,e.disposables):a(e,t)},W=function(){function t(t){this.disposables=t}return t.prototype.dispose=function(){$(K(this.disposables))},t}(),K=function(t){return h(J,[],t)},J=function(t,e){try{e.dispose()}catch(e){t.push(e)}return t},$=function(t){if(t.length>0)throw new Y(t.length+" errors",t)},Y=function t(e,i){this.name="DisposeAllError",this.message=e,this.errors=i,Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.stack=""+this.stack+X(this.errors)};Y.prototype=Object.create(Error.prototype);var X=function(t){return h(Z,"",t)},Z=function(t,e,i){return t+"\n["+(i+1)+"] "+e.stack},Q=f((function(t,e,i){try{e.dispose()}catch(e){i.error(t,e)}})),tt=function(t,e){return tt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},tt(t,e)};function et(t,e){function i(){this.constructor=t}tt(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function it(t){setTimeout(st,0,t)}function st(t){throw t}var nt=function(t,e,i){return new ct(t,e,i)},rt=function(t,e){return new ut(t,e)},ot=function(t){return new lt(t)},at=function(t,e){return new dt(t,e)},ht=function(){function t(t){this.sink=t,this.active=!0}return t.prototype.dispose=function(){this.active=!1},t.prototype.run=function(t){this.active&&this.runIfActive(t)},t.prototype.error=function(t,e){if(!this.active)return it(e);this.sink.error(t,e)},t}(),ct=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.runEvent=e,n.value=i,n}return et(e,t),e.prototype.runIfActive=function(t){this.runEvent(t,this.value,this.sink)},e}(ht),ut=function(t){function e(e,i){var s=t.call(this,i)||this;return s.value=e,s}return et(e,t),e.prototype.runIfActive=function(t){this.sink.event(t,this.value)},e}(ht),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return et(e,t),e.prototype.runIfActive=function(t){this.sink.end(t)},e}(ht),dt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.value=e,s}return et(e,t),e.prototype.runIfActive=function(t){this.sink.error(t,this.value)},e}(ht),pt=function(){return yt},ft=function(t){return t===yt},mt=function(t){return t.some(ft)},yt=new(function(){function t(){}return t.prototype.run=function(t,e){return _(ot(t),e)},t}()),gt=(new(function(){function t(){}return t.prototype.run=function(){return R()},t}()),function(t,e){return new vt(t,e)}),vt=function(){function t(t,e){this.time=t,this.value=e}return t.prototype.run=function(t,e){return M(this.time,nt(wt,this.value,t),e)},t}();function wt(t,e,i){i.event(t,e),i.end(t)}var bt=function(t){return gt(0,t)},xt=function(){function t(){this.disposable=void 0,this.disposed=!1}return t.prototype.setDisposable=function(t){if(void 0!==this.disposable)throw new Error("setDisposable called more than once");this.disposable=t,this.disposed&&t.dispose()},t.prototype.dispose=function(){this.disposed||(this.disposed=!0,void 0!==this.disposable&&this.disposable.dispose())},t}(),kt=p((function(t,e){return new Promise((function(i,s){return function(t,e,i,s){var n=new xt,r=new St(i,s,n);n.setDisposable(t.run(r,e))}(t,e,i,s)}))})),St=function(){function t(t,e,i){this._end=t,this._error=e,this._disposable=i,this.active=!0}return t.prototype.event=function(){},t.prototype.end=function(){this.active&&this.dispose(this._error,this._end,void 0)},t.prototype.error=function(t,e){this.dispose(this._error,this._error,e)},t.prototype.dispose=function(t,e,i){this.active=!1,function(t,e,i,s){try{s.dispose()}catch(e){return void t(e)}e(i)}(t,e,i,this._disposable)},t}(),Tt=function(t,e,i){return i.run(t,e)},Bt=function(){function t(t,e){this.sink=e,this.offset=t}return t.prototype.event=function(t,e){this.sink.event(t+this.offset,e)},t.prototype.error=function(t,e){this.sink.error(t+this.offset,e)},t.prototype.end=function(t){this.sink.end(t+this.offset)},t}(),At=function(t,e){return new Ct(t,e)},Ct=function(){function t(t,e){this.origin=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(Ot(this.origin,t),D(this.origin,e))},t}(),Ot=function(t,e){return e instanceof Bt?new Bt(t+e.offset,e.sink):new Bt(t,e)},Pt=function(){function t(t){this.sink=t}return t.prototype.end=function(t){return this.sink.end(t)},t.prototype.error=function(t,e){return this.sink.error(t,e)},t}(),Et=function(){function t(t,e,i){this.step=t,this.seed=e,this.source=i}return t.prototype.run=function(t,e){return this.source.run(new jt(this.step,this.seed,t),e)},t}(),jt=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.step=e,n.seed=i,n}return et(e,t),e.prototype.event=function(t,e){var i=this.step(this.seed,e);this.seed=i.seed,this.sink.event(t,i.value)},e}(Pt),_t=function(){function t(t,e,i){this.source=i,this.f=t,this.value=e}return t.prototype.run=function(t,e){var i=_(rt(this.value,t),e),s=this.source.run(new Mt(this.f,this.value,t),e);return G(i,s)},t}(),Mt=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.f=e,n.value=i,n}return et(e,t),e.prototype.event=function(t,e){var i=this.f;this.value=i(this.value,e),this.sink.event(t,this.value)},e}(Pt),Nt=function(t,e){return new Dt(t,e)},Dt=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return new Ft(this.f,this.source,t,e)},t}(),Ft=function(t){function e(e,i,s,n){var r=t.call(this,s)||this;return r.f=e,r.scheduler=n,r.active=!0,r.disposable=z(i.run(r,n)),r}return et(e,t),e.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},e.prototype.end=function(t){this.active&&(Q(t,this.disposable,this.sink),this.startNext(t,this.sink))},e.prototype.startNext=function(t,e){try{this.disposable=this.continue(this.f,t,e)}catch(i){e.error(t,i)}},e.prototype.continue=function(t,e,i){return Tt(i,this.scheduler,At(e,t()))},e.prototype.dispose=function(){return this.active=!1,this.disposable.dispose()},e}(Pt),It=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new Rt(this.p,t),e)},t.create=function(e,i){return ft(i)?i:i instanceof t?new t(Lt(i.p,e),i.source):new t(e,i)},t}(),Rt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.p=e,s}return et(e,t),e.prototype.event=function(t,e){(0,this.p)(e)&&this.sink.event(t,e)},e}(Pt),Lt=function(t,e){return function(i){return t(i)&&e(i)}},zt=function(){function t(t,e,i){this.p=t,this.f=e,this.source=i}return t.prototype.run=function(t,e){return this.source.run(new Ht(this.p,this.f,t),e)},t}(),Ht=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.p=e,n.f=i,n}return et(e,t),e.prototype.event=function(t,e){var i=this.f;(0,this.p)(e)&&this.sink.event(t,i(e))},e}(Pt),Ut=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new qt(this.f,t),e)},t.create=function(e,i){return ft(i)?pt():i instanceof t?new t(function(t,e){return function(i){return t(e(i))}}(e,i.f),i.source):i instanceof It?new zt(i.p,e,i.source):new t(e,i)},t}(),qt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.f=e,s}return et(e,t),e.prototype.event=function(t,e){var i=this.f;this.sink.event(t,i(e))},e}(Pt),Gt=function(t,e){return Ut.create(t,e)},Vt=function(){function t(t,e){this.source=e,this.f=t}return t.prototype.run=function(t,e){return this.source.run(new Wt(this.f,t),e)},t}(),Wt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.f=e,s}return et(e,t),e.prototype.event=function(t,e){(0,this.f)(e),this.sink.event(t,e)},e}(Pt),Kt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.index=e,s.active=!0,s.value=void 0,s}return et(e,t),e.prototype.event=function(t,e){this.active&&(this.value=e,this.sink.event(t,this))},e.prototype.end=function(t){this.active&&(this.active=!1,this.sink.event(t,this))},e}(Pt);function Jt(t,e){switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);case 4:return t(e[0],e[1],e[2],e[3]);case 5:return t(e[0],e[1],e[2],e[3],e[4]);default:return t.apply(void 0,e)}}var $t=function(t,e,i){return Yt(t,[e,i])},Yt=function(t,e){return 0===e.length||mt(e)?pt():1===e.length?Gt(t,e[0]):new Xt(t,e)},Xt=function(){function t(t,e){this.f=t,this.sources=e}return t.prototype.run=function(t,e){for(var i=this.sources.length,s=new Array(i),n=new Array(i),r=new Zt(s,n.length,t,this.f),o=void 0,a=0;a<i;++a)o=n[a]=new Kt(a,r),s[a]=this.sources[a].run(o,e);return q(s)},t}(),Zt=function(t){function e(e,i,s,n){var r=t.call(this,s)||this;return r.disposables=e,r.f=n,r.awaiting=i,r.values=new Array(i),r.hasValue=new Array(i).fill(!1),r.activeCount=i,r}return et(e,t),e.prototype.event=function(t,e){if(e.active){var i=e.index,s=this.updateReady(i);this.values[i]=e.value,0===s&&this.sink.event(t,Jt(this.f,this.values))}else this.dispose(t,e.index)},e.prototype.updateReady=function(t){return this.awaiting>0&&(this.hasValue[t]||(this.hasValue[t]=!0,this.awaiting-=1)),this.awaiting},e.prototype.dispose=function(t,e){Q(t,this.disposables[e],this.sink),0==--this.activeCount&&this.sink.end(t)},e}(Pt),Qt=function(t,e){return te(l,t,e)},te=function(t,e,i){return ft(i)?pt():new ee(t,e,i)},ee=function(){function t(t,e,i){this.f=t,this.concurrency=e,this.source=i}return t.prototype.run=function(t,e){return new ie(this.f,this.concurrency,this.source,t,e)},t}(),ie=function(){function t(t,e,i,s,n){this.f=t,this.concurrency=e,this.sink=s,this.scheduler=n,this.pending=[],this.current=[],this.disposable=z(i.run(this,n)),this.active=!0}return t.prototype.event=function(t,e){this.addInner(t,e)},t.prototype.addInner=function(t,e){this.current.length<this.concurrency?this.startInner(t,e):this.pending.push(e)},t.prototype.startInner=function(t,e){try{this.initInner(t,e)}catch(e){this.error(t,e)}},t.prototype.initInner=function(t,e){var i=new ne(t,this,this.sink);i.disposable=se(this.f,t,e,i,this.scheduler),this.current.push(i)},t.prototype.end=function(t){this.active=!1,Q(t,this.disposable,this.sink),this.checkEnd(t)},t.prototype.error=function(t,e){this.active=!1,this.sink.error(t,e)},t.prototype.dispose=function(){this.active=!1,this.pending.length=0,this.disposable.dispose(),q(this.current).dispose()},t.prototype.endInner=function(t,e){var i=this.current.indexOf(e);i>=0&&this.current.splice(i,1),Q(t,e,this);var s=this.pending;s.length>0?this.startInner(t,s.shift()):this.checkEnd(t)},t.prototype.checkEnd=function(t){this.active||0!==this.current.length||this.sink.end(t)},t}(),se=function(t,e,i,s,n){return t(i).run(s,D(e,n))},ne=function(){function t(t,e,i){this.time=t,this.outer=e,this.sink=i,this.disposable=R()}return t.prototype.event=function(t,e){this.sink.event(t+this.time,e)},t.prototype.end=function(t){this.outer.endInner(t+this.time,this)},t.prototype.error=function(t,e){this.outer.error(t+this.time,e)},t.prototype.dispose=function(){return this.disposable.dispose()},t}(),re=function(t){return Qt(1/0,t)},oe=function(t){return ae(he(t))},ae=function(t){return 0===t.length?pt():1===t.length?t[0]:new le(h(ue,[],t))},he=function(t){return t.filter(ce)},ce=function(t){return!ft(t)},ue=function(t,e){return t.concat(e instanceof le?e.sources:e)},le=function(){function t(t){this.sources=t}return t.prototype.run=function(t,e){for(var i=this.sources.length,s=new Array(i),n=new Array(i),r=new de(s,n,t),o=void 0,a=0;a<i;++a)o=n[a]=new Kt(a,r),s[a]=this.sources[a].run(o,e);return q(s)},t}(),de=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.disposables=e,n.activeCount=i.length,n}return et(e,t),e.prototype.event=function(t,e){e.active?this.sink.event(t,e.value):this.dispose(t,e.index)},e.prototype.dispose=function(t,e){Q(t,this.disposables[e],this.sink),0==--this.activeCount&&this.sink.end(t)},e}(Pt),pe=function(t,e,i){return ft(i)||ft(e)?pt():new fe(t,e,i)},fe=function(){function t(t,e,i){this.f=t,this.values=e,this.sampler=i}return t.prototype.run=function(t,e){var i=new me(this.f,t),s=this.values.run(i.latest,e),n=this.sampler.run(i,e);return G(n,s)},t}(),me=function(t){function e(e,i){var s=t.call(this,i)||this;return s.f=e,s.latest=new ye(s),s}return et(e,t),e.prototype.event=function(t,e){if(this.latest.hasValue){var i=this.f;this.sink.event(t,i(this.latest.value,e))}},e}(Pt),ye=function(t){function e(e){var i=t.call(this,e)||this;return i.hasValue=!1,i}return et(e,t),e.prototype.event=function(t,e){this.value=e,this.hasValue=!0},e.prototype.end=function(){},e}(Pt),ge=function(t,e){var i=Math.max(0,t);return{min:i,max:Math.max(i,e)}},ve=function(t,e){return we(0,t,e)},we=function(t,e,i){return be(ge(t,e),i)},be=function(t,e){return xe(t,e)?pt():e instanceof Ut?Se(t,e):e instanceof Be?Te(t,e):ke(t,e)},xe=function(t,e){return ft(e)||(i=t).min>=i.max;var i},ke=function(t,e){return(i=t).min<=0&&i.max===1/0?e:new Be(t,e);var i},Se=function(t,e){return Ut.create(e.f,be(t,e.source))},Te=function(t,e){return be((i=e.bounds,s=t,ge(i.min+s.min,Math.min(i.max,i.min+s.max))),e.source);var i,s},Be=function(){function t(t,e){this.source=e,this.bounds=t}return t.prototype.run=function(t,e){var i=new xt,s=new Ae(this.bounds.min,this.bounds.max-this.bounds.min,t,i);return i.setDisposable(this.source.run(s,e)),i},t}(),Ae=function(t){function e(e,i,s,n){var r=t.call(this,s)||this;return r.skip=e,r.take=i,r.disposable=n,r}return et(e,t),e.prototype.event=function(t,e){this.skip>0?this.skip-=1:0!==this.take&&(this.take-=1,this.sink.event(t,e),0===this.take&&(this.disposable.dispose(),this.sink.end(t)))},e}(Pt),Ce=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){var i=new xt,s=new Oe(this.p,t,i);return i.setDisposable(this.source.run(s,e)),i},t}(),Oe=function(t){function e(e,i,s){var n=t.call(this,i)||this;return n.p=e,n.active=!0,n.disposable=s,n}return et(e,t),e.prototype.event=function(t,e){if(this.active){var i=this.p;this.active=i(e),this.active?this.sink.event(t,e):(this.disposable.dispose(),this.sink.end(t))}},e}(Pt),Pe=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new Ee(this.p,t),e)},t}(),Ee=function(t){function e(e,i){var s=t.call(this,i)||this;return s.p=e,s.skipping=!0,s}return et(e,t),e.prototype.event=function(t,e){if(this.skipping){var i=this.p;if(this.skipping=i(e),this.skipping)return}this.sink.event(t,e)},e}(Pt),je=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new _e(this.p,t),e)},t}(),_e=function(t){function e(e,i){var s=t.call(this,i)||this;return s.p=e,s.skipping=!1,s}return et(e,t),e.prototype.event=function(t,e){if(!this.skipping){var i=this.p;this.skipping=i(e),this.sink.event(t,e),this.skipping&&this.sink.end(t)}},e}(Pt),Me=function(t,e,i){return ft(i)||0===e.length?pt():new De(t,e,ve(e.length,i))},Ne=function(t){return t},De=function(){function t(t,e,i){this.f=t,this.items=e,this.source=i}return t.prototype.run=function(t,e){return this.source.run(new Fe(this.f,this.items,t),e)},t}(),Fe=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.f=e,n.items=i,n.index=0,n}return et(e,t),e.prototype.event=function(t,e){var i=this.f;this.sink.event(t,i(this.items[this.index],e)),this.index+=1},e}(Pt),Ie=function(){function t(){this.head=0,this.tail=0,this.capacityMask=3,this.list=new Array(4)}return t.prototype.push=function(t){var e=this.tail;return this.list[e]=t,this.tail=e+1&this.capacityMask,this.tail===this.head&&this.growArray(),this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.shift=function(){var t=this.head;if(t!==this.tail){var e=this.list[t];return this.list[t]=void 0,this.head=t+1&this.capacityMask,t<2&&this.tail>1e4&&this.tail<=this.list.length>>>2&&this.shrinkArray(),e}},t.prototype.isEmpty=function(){return this.head===this.tail},t.prototype.length=function(){return this.head===this.tail?0:this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.growArray=function(){this.head&&(this.list=this.copyArray(),this.head=0),this.tail=this.list.length,this.list.length*=2,this.capacityMask=this.capacityMask<<1|1},t.prototype.shrinkArray=function(){this.list.length>>>=1,this.capacityMask>>>=1},t.prototype.copyArray=function(){var t,e=[],i=this.list,s=i.length;for(t=this.head;t<s;t++)e.push(i[t]);for(t=0;t<this.tail;t++)e.push(i[t]);return e},t}(),Re=function(t,e){return 0===e.length||mt(e)?pt():1===e.length?Gt(t,e[0]):new Le(t,e)},Le=function(){function t(t,e){this.f=t,this.sources=e}return t.prototype.run=function(t,e){for(var i=this.sources.length,s=new Array(i),n=new Array(i),r=new Array(i),o=new ze(this.f,r,n,t),a=void 0,h=0;h<i;++h)r[h]=new Ie,a=n[h]=new Kt(h,o),s[h]=this.sources[h].run(a,e);return q(s)},t}(),ze=function(t){function e(e,i,s,n){var r=t.call(this,n)||this;return r.f=e,r.sinks=s,r.buffers=i,r}return et(e,t),e.prototype.event=function(t,e){if(e.active){var i=this.buffers,s=i[e.index];if(s.push(e.value),1===s.length()){if(!function(t){for(var e=0,i=t.length;e<i;++e)if(t[e].isEmpty())return!1;return!0}(i))return;He(this.f,t,i,this.sink),function(t,e){for(var i=0,s=t.length;i<s;++i)if(t[i].isEmpty()&&!e[i].active)return!0;return!1}(this.buffers,this.sinks)&&this.sink.end(t)}}else this.dispose(t,e.index)},e.prototype.dispose=function(t,e){this.buffers[e].isEmpty()&&this.sink.end(t)},e}(Pt),He=function(t,e,i,s){return s.event(e,Jt(t,function(t,e){for(var i=e.length,s=new Array(i),n=0;n<i;++n)s[n]=t(e[n]);return s}(Ue,i)))},Ue=function(t){return t.shift()},qe=function(t){return ft(t)?pt():new Ge(t)},Ge=function(){function t(t){this.source=t}return t.prototype.run=function(t,e){var i=new Ve(t,e);return G(i,this.source.run(i,e))},t}(),Ve=function(){function t(t,e){this.sink=t,this.scheduler=e,this.current=null,this.ended=!1}return t.prototype.event=function(t,e){this.disposeCurrent(t),this.current=new We(e,t,1/0,this,this.sink,this.scheduler)},t.prototype.end=function(t){this.ended=!0,this.checkEnd(t)},t.prototype.error=function(t,e){this.ended=!0,this.sink.error(t,e)},t.prototype.dispose=function(){return this.disposeCurrent(j(this.scheduler))},t.prototype.disposeCurrent=function(t){if(null!==this.current)return this.current.dispose(t)},t.prototype.disposeInner=function(t,e){e.dispose(t),e===this.current&&(this.current=null)},t.prototype.checkEnd=function(t){this.ended&&null===this.current&&this.sink.end(t)},t.prototype.endInner=function(t,e){this.disposeInner(t,e),this.checkEnd(t)},t.prototype.errorInner=function(t,e,i){this.disposeInner(t,i),this.sink.error(t,e)},t}(),We=function(){function t(t,e,i,s,n,r){this.min=e,this.max=i,this.outer=s,this.sink=n,this.disposable=t.run(this,D(e,r))}return t.prototype.event=function(t,e){var i=Math.max(0,t+this.min);i<this.max&&this.sink.event(i,e)},t.prototype.end=function(t){this.outer.endInner(t+this.min,this)},t.prototype.error=function(t,e){this.outer.errorInner(t+this.min,e,this)},t.prototype.dispose=function(t){Q(t,this.disposable,this.sink)},t}(),Ke=function(t){return Je(Xe,t)},Je=function(t,e){return ft(e)?pt():new $e(t,e)},$e=function(){function t(t,e){this.equals=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new Ye(this.equals,t),e)},t}(),Ye=function(t){function e(e,i){var s=t.call(this,i)||this;return s.equals=e,s.value=void 0,s.init=!0,s}return et(e,t),e.prototype.event=function(t,e){this.init?(this.init=!1,this.value=e,this.sink.event(t,e)):this.equals(this.value,e)||(this.value=e,this.sink.event(t,e))},e}(Pt);function Xe(t,e){return t===e}var Ze=function(t,e){return new ti(t,e)},Qe=function(t,e){return new ei(t,e)},ti=function(){function t(t,e){this.maxSignal=t,this.source=e}return t.prototype.run=function(t,e){var i=new xt,s=this.source.run(t,e),n=this.maxSignal.run(new ni(t,i),e);return i.setDisposable(G(s,n)),i},t}(),ei=function(){function t(t,e){this.minSignal=t,this.source=e}return t.prototype.run=function(t,e){var i=new si(this.minSignal,t,e),s=this.source.run(new ii(i,t),e);return G(i,s)},t}(),ii=function(t){function e(e,i){var s=t.call(this,i)||this;return s.min=e,s}return et(e,t),e.prototype.event=function(t,e){this.min.allow&&this.sink.event(t,e)},e}(Pt),si=function(t){function e(e,i,s){var n=t.call(this,i)||this;return n.allow=!1,n.disposable=e.run(n,s),n}return et(e,t),e.prototype.event=function(){this.allow=!0,this.dispose()},e.prototype.end=function(){},e.prototype.dispose=function(){this.disposable.dispose()},e}(Pt),ni=function(t){function e(e,i){var s=t.call(this,e)||this;return s.disposable=i,s}return et(e,t),e.prototype.event=function(t){this.disposable.dispose(),this.sink.end(t)},e.prototype.end=function(){},e}(Pt),ri=function(){function t(t,e){this.dt=t,this.source=e}return t.prototype.run=function(t,e){var i=new oi(this.dt,t,e);return G(i,this.source.run(i,e))},t}(),oi=function(t){function e(e,i,s){var n=t.call(this,i)||this;return n.dt=e,n.scheduler=s,n.tasks=[],n}return et(e,t),e.prototype.dispose=function(){this.tasks.forEach(N)},e.prototype.event=function(t,e){this.tasks.push(M(this.dt,rt(e,this.sink),this.scheduler))},e.prototype.end=function(){this.tasks.push(M(this.dt,ot(this.sink),this.scheduler))},e}(Pt),ai=function(t,e){return ft(e)?pt():e instanceof Ut?hi(t,e):e instanceof ui?ci(t,e):new ui(t,e)},hi=function(t,e){return Ut.create(e.f,ai(t,e.source))},ci=function(t,e){return new ui(Math.max(t,e.period),e.source)},ui=function(){function t(t,e){this.period=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new li(this.period,t),e)},t}(),li=function(t){function e(e,i){var s=t.call(this,i)||this;return s.time=0,s.period=e,s}return et(e,t),e.prototype.event=function(t,e){t>=this.time&&(this.time=t+this.period,this.sink.event(t,e))},e}(Pt),di=function(){function t(t,e){this.dt=t,this.source=e}return t.prototype.run=function(t,e){return new pi(this.dt,this.source,t,e)},t}(),pi=function(){function t(t,e,i,s){this.dt=t,this.sink=i,this.scheduler=s,this.timer=null,this.disposable=e.run(this,s)}return t.prototype.event=function(t,e){this.clearTimer(),this.value=e,this.timer=M(this.dt,new fi(this,e),this.scheduler)},t.prototype.handleEventFromTask=function(t,e){this.clearTimer(),this.sink.event(t,e)},t.prototype.end=function(t){this.clearTimer()&&(this.sink.event(t,this.value),this.value=void 0),this.sink.end(t)},t.prototype.error=function(t,e){this.clearTimer(),this.sink.error(t,e)},t.prototype.dispose=function(){this.clearTimer(),this.disposable.dispose()},t.prototype.clearTimer=function(){return null!==this.timer&&(this.timer.dispose(),this.timer=null,!0)},t}(),fi=function(){function t(t,e){this.sink=t,this.value=e}return t.prototype.run=function(t){this.sink.handleEventFromTask(t,this.value)},t.prototype.error=function(t,e){this.sink.error(t,e)},t.prototype.dispose=function(){},t}(),mi=(function(){function t(t,e){var i=this;this.eventBound=function(t){return i.sink.event(j(i.scheduler),t)},this.endBound=function(){return i.sink.end(j(i.scheduler))},this.errorBound=function(t){return i.sink.error(j(i.scheduler),t)},this.sink=t,this.scheduler=e,this.queue=Promise.resolve()}t.prototype.event=function(t,e){var i=this;this.queue=this.queue.then((function(){return i.handlePromise(e)})).catch(this.errorBound)},t.prototype.end=function(){this.queue=this.queue.then(this.endBound).catch(this.errorBound)},t.prototype.error=function(t,e){var i=this;this.queue=this.queue.then((function(){return i.errorBound(e)})).catch(it)},t.prototype.handlePromise=function(t){return t.then(this.eventBound)}}(),function(){function t(t){this.sink=t,this.active=!0}return t.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},t.prototype.end=function(t){this.active&&(this.disable(),this.sink.end(t))},t.prototype.error=function(t,e){this.disable(),this.sink.error(t,e)},t.prototype.disable=function(){return this.active=!1,this.sink},t}());function yi(t,e,i){try{i.event(t,e)}catch(e){i.error(t,e)}}function gi(t,e){try{e.end(t)}catch(i){e.error(t,i)}}var vi=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return new wi(this.f,this.source,t,e)},t}(),wi=function(){function t(t,e,i,s){this.f=t,this.sink=new mi(i),this.scheduler=s,this.disposable=e.run(this,s)}return t.prototype.event=function(t,e){yi(t,e,this.sink)},t.prototype.end=function(t){gi(t,this.sink)},t.prototype.error=function(t,e){var i=this.sink.disable();Q(t,this.disposable,this.sink),this._startNext(t,e,i)},t.prototype._startNext=function(t,e,i){try{this.disposable=this._continue(this.f,t,e,i)}catch(e){i.error(t,e)}},t.prototype._continue=function(t,e,i,s){return Tt(s,this.scheduler,At(e,t(i)))},t.prototype.dispose=function(){return this.disposable.dispose()},t}(),bi=function(t){return t instanceof xi||ft(t)?t:new xi(t)},xi=function(){function t(t){this.source=new ki(t)}return t.prototype.run=function(t,e){return this.source.run(t,e)},t}(),ki=function(){function t(t){this.source=t,this.sinks=[],this.disposable=R()}return t.prototype.run=function(t,e){return 1===this.add(t)&&(this.disposable=this.source.run(this,e)),z(new Si(this,t))},t.prototype.dispose=function(){var t=this.disposable;return this.disposable=R(),t.dispose()},t.prototype.add=function(t){return this.sinks=a(t,this.sinks),this.sinks.length},t.prototype.remove=function(t){var e=u(t,this.sinks);return e>=0&&(this.sinks=function(t,e){if(t<0)throw new TypeError("i must be >= 0");var i=e.length;return 0===i||t>=i?e:1===i?[]:function(t,e,i){var s,n=new Array(i);for(s=0;s<t;++s)n[s]=e[s];for(s=t;s<i;++s)n[s]=e[s+1];return n}(t,e,i-1)}(e,this.sinks)),this.sinks.length},t.prototype.event=function(t,e){var i=this.sinks;if(1===i.length)return i[0].event(t,e);for(var s=0;s<i.length;++s)yi(t,e,i[s])},t.prototype.end=function(t){for(var e=this.sinks,i=0;i<e.length;++i)gi(t,e[i])},t.prototype.error=function(t,e){for(var i=this.sinks,s=0;s<i.length;++s)i[s].error(t,e)},t}(),Si=function(){function t(t,e){this.source=t,this.sink=e}return t.prototype.dispose=function(){0===this.source.remove(this.sink)&&this.source.dispose()},t}(),Ti=(f(Tt),p(At),f((function(t,e,i){return ft(i)?pt():new Et(t,e,i)})),f((function(t,e,i){return new _t(t,e,i)}))),Bi=p((function(t,e){return Nt((function(){return e}),bt(t))})),Ai=p(Gt),Ci=(p((function(t,e){return Gt((function(){return t}),e)})),p((function(t,e){return new Vt(t,e)}))),Oi=(p((function(t,e){return $t(d,t,e)})),p((function(t,e){return te(t,1/0,e)})),p(Nt),p((function(t,e){return te(t,1,e)})),p(Qt),f(te),p((function(t,e){return oe([t,e])}))),Pi=(f($t),p(Yt),p((function(t,e){return pe((function(t){return t}),t,e)})),f(pe)),Ei=(f(Me),p((function(t,e){return Me(Ne,t,e)})),f((function(t,e,i){return Re(t,[e,i])})),p(Re),p((function(t,e){return It.create(t,e)}))),ji=(p(Je),p(ve),p((function(t,e){return we(t,1/0,e)})),f(we),p((function(t,e){return ft(e)?pt():new Ce(t,e)})),p((function(t,e){return ft(e)?pt():new Pe(t,e)})),p((function(t,e){return ft(e)?pt():new je(t,e)}))),_i=p(Ze),Mi=(p(Qe),p((function(t,e){return Ze(re(t),Qe(t,e))})),p((function(t,e){return t<=0?e:new ri(t,e)}))),Ni=(p(ai),p((function(t,e){return ft(e)?pt():new di(t,e)}))),Di=(p((function(t,e){return ft(e)?pt():new vi(t,e)})),f(nt),p(rt),p(at),function(t,e,i,s,n){this.time=t,this.localOffset=e,this.period=i,this.task=s,this.scheduler=n,this.active=!0});Di.prototype.run=function(){return this.task.run(this.time-this.localOffset)},Di.prototype.error=function(t){return this.task.error(this.time-this.localOffset,t)},Di.prototype.dispose=function(){return this.scheduler.cancel(this),this.task.dispose()};var Fi=function(t,e){this.origin=t,this.scheduler=e};function Ii(t){try{return t.run()}catch(e){return t.error(e)}}Fi.prototype.currentTime=function(){return this.scheduler.currentTime()-this.origin},Fi.prototype.scheduleTask=function(t,e,i,s){return this.scheduler.scheduleTask(t+this.origin,e,i,s)},Fi.prototype.relative=function(t){return new Fi(t+this.origin,this.scheduler)},Fi.prototype.cancel=function(t){return this.scheduler.cancel(t)},Fi.prototype.cancelAll=function(t){return this.scheduler.cancelAll(t)};var Ri=function(t,e){var i=this;this.timer=t,this.timeline=e,this._timer=null,this._nextArrival=1/0,this._runReadyTasksBound=function(){return i._runReadyTasks(i.currentTime())}};Ri.prototype.currentTime=function(){return this.timer.now()},Ri.prototype.scheduleTask=function(t,e,i,s){var n=this.currentTime()+Math.max(0,e),r=new Di(n,t,i,s,this);return this.timeline.add(r),this._scheduleNextRun(),r},Ri.prototype.relative=function(t){return new Fi(t,this)},Ri.prototype.cancel=function(t){t.active=!1,this.timeline.remove(t)&&this._reschedule()},Ri.prototype.cancelAll=function(t){this.timeline.removeAll(t),this._reschedule()},Ri.prototype._reschedule=function(){this.timeline.isEmpty()?this._unschedule():this._scheduleNextRun(this.currentTime())},Ri.prototype._unschedule=function(){this.timer.clearTimer(this._timer),this._timer=null},Ri.prototype._scheduleNextRun=function(){if(!this.timeline.isEmpty()){var t=this.timeline.nextArrival();null===this._timer?this._scheduleNextArrival(t):t<this._nextArrival&&(this._unschedule(),this._scheduleNextArrival(t))}},Ri.prototype._scheduleNextArrival=function(t){this._nextArrival=t;var e=Math.max(0,t-this.currentTime());this._timer=this.timer.setTimer(this._runReadyTasksBound,e)},Ri.prototype._runReadyTasks=function(){this._timer=null,this.timeline.runTasks(this.currentTime(),Ii),this._scheduleNextRun()};var Li=function(){this.tasks=[]};function zi(t,e,i){for(var s=0;s<e.length;++s){var n=e[s];n.active&&(t(n),n.period>=0&&n.active&&(n.time=n.time+n.period,Hi(n,i)))}return i}function Hi(t,e){var i=e.length,s=Ui(t);if(0!==i){var n=Gi(s,e);n>=i?e.push(Vi(s,[t])):function(t,e,i,s){var n=e[s];i===n.time?function(t,e){0===e.length||t.time>=e[e.length-1].time?e.push(t):function(t,e){for(var i=0;i<e.length;i++)if(t.time<e[i].time){e.splice(i,0,t);break}}(t,e)}(t,n.events):e.splice(s,0,Vi(i,[t]))}(t,e,s,n)}else e.push(Vi(s,[t]))}function Ui(t){return Math.floor(t.time)}function qi(t,e){e.events=c(t,e.events)}function Gi(t,e){for(var i,s,n=0,r=e.length;n<r;){if(t===(s=e[i=Math.floor((n+r)/2)]).time)return i;t<s.time?r=i:n=i+1}return r}Li.prototype.nextArrival=function(){return this.isEmpty()?1/0:this.tasks[0].time},Li.prototype.isEmpty=function(){return 0===this.tasks.length},Li.prototype.add=function(t){Hi(t,this.tasks)},Li.prototype.remove=function(t){var e=Gi(Ui(t),this.tasks);if(e>=0&&e<this.tasks.length){var i=u(t,this.tasks[e].events);if(i>=0)return this.tasks[e].events.splice(i,1),!0}return!1},Li.prototype.removeAll=function(t){for(var e=0;e<this.tasks.length;++e)qi(t,this.tasks[e])},Li.prototype.runTasks=function(t,e){for(var i=this.tasks,s=i.length,n=0;n<s&&i[n].time<=t;)++n;this.tasks=i.slice(n);for(var r=0;r<n;++r)this.tasks=zi(e,i[r].events,this.tasks)};var Vi=function(t,e){return{time:t,events:e}},Wi=function(t){this._clock=t};Wi.prototype.now=function(){return this._clock.now()},Wi.prototype.setTimer=function(t,e){return e<=0?function(t){var e=new Ki(t);return function(t){Promise.resolve(t).then(Ii)}(e),e}(t):setTimeout(t,e)},Wi.prototype.clearTimer=function(t){return t instanceof Ki?t.cancel():clearTimeout(t)};var Ki=function(t){this.f=t,this.active=!0};Ki.prototype.run=function(){return this.active&&this.f()},Ki.prototype.error=function(t){throw t},Ki.prototype.cancel=function(){this.active=!1};p((function(t,e){return e.scheduleTask(0,0,-1,t)})),f((function(t,e,i){return i.scheduleTask(0,t,-1,e)})),f((function(t,e,i){return i.scheduleTask(0,0,t,e)})),p((function(t,e){return e.cancelAll(t)})),p((function(t,e){return new Fi(t,e)})),p((function(t,e){return new Ri(t,e)}));var Ji=function(t,e,i){return void 0===i&&(i=!1),new Xi(t,e,i)},$i=function(t,e){return void 0===e&&(e=!1),Ji("resize",t,e)},Yi=function(t,e){return void 0===e&&(e=!1),Ji("scroll",t,e)},Xi=function(t,e,i){this.event=t,this.node=e,this.capture=i};Xi.prototype.run=function(t,e){var i=this,s=function(i){return function(t,e,i){try{i.event(t,e)}catch(e){i.error(t,e)}}(e.currentTime(),i,t)};return this.node.addEventListener(this.event,s,this.capture),{dispose:function(){return i.node.removeEventListener(i.event,s,i.capture)}}};var Zi=function(){var t=[];return[function(e){return Qi(t,e)},new ts(t)]},Qi=function(t,e){return t.forEach((function(t){var i=t.sink;return function(t,e,i){try{i.event(t,e)}catch(e){i.error(t,e)}}(t.scheduler.currentTime(),e,i)}))},ts=function(){function t(t){this.sinks=t}return t.prototype.run=function(t,e){var i={sink:t,scheduler:e};return this.sinks.push(i),new es(i,this.sinks)},t}(),es=function(){function t(t,e){this.sink=t,this.sinks=e}return t.prototype.dispose=function(){var t=this.sinks.indexOf(this.sink);t>=0&&this.sinks.splice(t,1)},t}();function is(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function ss(t){return function e(i){return 0===arguments.length||is(i)?e:t.apply(this,arguments)}}function ns(t,e){switch(t){case 0:return function(){return e.apply(this,arguments)};case 1:return function(t){return e.apply(this,arguments)};case 2:return function(t,i){return e.apply(this,arguments)};case 3:return function(t,i,s){return e.apply(this,arguments)};case 4:return function(t,i,s,n){return e.apply(this,arguments)};case 5:return function(t,i,s,n,r){return e.apply(this,arguments)};case 6:return function(t,i,s,n,r,o){return e.apply(this,arguments)};case 7:return function(t,i,s,n,r,o,a){return e.apply(this,arguments)};case 8:return function(t,i,s,n,r,o,a,h){return e.apply(this,arguments)};case 9:return function(t,i,s,n,r,o,a,h,c){return e.apply(this,arguments)};case 10:return function(t,i,s,n,r,o,a,h,c,u){return e.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function rs(t){return function e(i,s){switch(arguments.length){case 0:return e;case 1:return is(i)?e:ss((function(e){return t(i,e)}));default:return is(i)&&is(s)?e:is(i)?ss((function(e){return t(e,s)})):is(s)?ss((function(e){return t(i,e)})):t(i,s)}}}function os(t,e,i){return function(){for(var s=[],n=0,r=t,o=0;o<e.length||n<arguments.length;){var a;o<e.length&&(!is(e[o])||n>=arguments.length)?a=e[o]:(a=arguments[n],n+=1),s[o]=a,is(a)||(r-=1),o+=1}return r<=0?i.apply(this,s):ns(r,os(t,s,i))}}const as=rs((function(t,e){return 1===t?ss(e):ns(t,os(t,[],e))})),hs=ss((function(t){return as(t.length,t)}));function cs(t,e){return function(){return e.call(this,t.apply(this,arguments))}}function us(t){return function e(i,s,n){switch(arguments.length){case 0:return e;case 1:return is(i)?e:rs((function(e,s){return t(i,e,s)}));case 2:return is(i)&&is(s)?e:is(i)?rs((function(e,i){return t(e,s,i)})):is(s)?rs((function(e,s){return t(i,e,s)})):ss((function(e){return t(i,s,e)}));default:return is(i)&&is(s)&&is(n)?e:is(i)&&is(s)?rs((function(e,i){return t(e,i,n)})):is(i)&&is(n)?rs((function(e,i){return t(e,s,i)})):is(s)&&is(n)?rs((function(e,s){return t(i,e,s)})):is(i)?ss((function(e){return t(e,s,n)})):is(s)?ss((function(e){return t(i,e,n)})):is(n)?ss((function(e){return t(i,s,e)})):t(i,s,n)}}}const ls=Array.isArray||function(t){return null!=t&&t.length>=0&&"[object Array]"===Object.prototype.toString.call(t)};function ds(t){return"[object String]"===Object.prototype.toString.call(t)}const ps=ss((function(t){return!!ls(t)||!!t&&"object"==typeof t&&!ds(t)&&(1===t.nodeType?!!t.length:0===t.length||t.length>0&&t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1))}));var fs=function(){function t(t){this.f=t}return t.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},t.prototype["@@transducer/result"]=function(t){return t},t.prototype["@@transducer/step"]=function(t,e){return this.f(t,e)},t}();const ms=rs((function(t,e){return ns(t.length,(function(){return t.apply(e,arguments)}))}));function ys(t,e,i){for(var s=i.next();!s.done;){if((e=t["@@transducer/step"](e,s.value))&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}s=i.next()}return t["@@transducer/result"](e)}function gs(t,e,i,s){return t["@@transducer/result"](i[s](ms(t["@@transducer/step"],t),e))}var vs="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function ws(t,e,i){if("function"==typeof t&&(t=function(t){return new fs(t)}(t)),ps(i))return function(t,e,i){for(var s=0,n=i.length;s<n;){if((e=t["@@transducer/step"](e,i[s]))&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}s+=1}return t["@@transducer/result"](e)}(t,e,i);if("function"==typeof i["fantasy-land/reduce"])return gs(t,e,i,"fantasy-land/reduce");if(null!=i[vs])return ys(t,e,i[vs]());if("function"==typeof i.next)return ys(t,e,i);if("function"==typeof i.reduce)return gs(t,e,i,"reduce");throw new TypeError("reduce: list must be array or iterable")}const bs=us(ws);function xs(t,e){return function(){var i=arguments.length;if(0===i)return e();var s=arguments[i-1];return ls(s)||"function"!=typeof s[t]?e.apply(this,arguments):s[t].apply(s,Array.prototype.slice.call(arguments,0,i-1))}}const ks=ss(xs("tail",us(xs("slice",(function(t,e,i){return Array.prototype.slice.call(i,t,e)})))(1,1/0)));function Ss(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return ns(arguments[0].length,bs(cs,arguments[0],ks(arguments)))}const Ts=ss((function(t){return ds(t)?t.split("").reverse().join(""):Array.prototype.slice.call(t,0).reverse()}));function Bs(){if(0===arguments.length)throw new Error("compose requires at least one argument");return Ss.apply(this,Ts(arguments))}const As=rs((function(t,e){return e(t)})),Cs="function"==typeof Object.is?Object.is:function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e},Os=rs(Cs);function Ps(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}function Es(t,e,i){for(var s=0,n=i.length;s<n;){if(t(e,i[s]))return!0;s+=1}return!1}function js(t,e){return Object.prototype.hasOwnProperty.call(e,t)}var _s=Object.prototype.toString;const Ms=function(){return"[object Arguments]"===_s.call(arguments)?function(t){return"[object Arguments]"===_s.call(t)}:function(t){return js("callee",t)}}();var Ns=!{toString:null}.propertyIsEnumerable("toString"),Ds=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Fs=function(){return arguments.propertyIsEnumerable("length")}(),Is=function(t,e){for(var i=0;i<t.length;){if(t[i]===e)return!0;i+=1}return!1};const Rs="function"!=typeof Object.keys||Fs?ss((function(t){if(Object(t)!==t)return[];var e,i,s=[],n=Fs&&Ms(t);for(e in t)!js(e,t)||n&&"length"===e||(s[s.length]=e);if(Ns)for(i=Ds.length-1;i>=0;)js(e=Ds[i],t)&&!Is(s,e)&&(s[s.length]=e),i-=1;return s})):ss((function(t){return Object(t)!==t?[]:Object.keys(t)})),Ls=ss((function(t){return null===t?"Null":void 0===t?"Undefined":Object.prototype.toString.call(t).slice(8,-1)}));function zs(t,e,i,s){var n=Ps(t);function r(t,e){return Hs(t,e,i.slice(),s.slice())}return!Es((function(t,e){return!Es(r,e,t)}),Ps(e),n)}function Hs(t,e,i,s){if(Cs(t,e))return!0;var n,r,o=Ls(t);if(o!==Ls(e))return!1;if(null==t||null==e)return!1;if("function"==typeof t["fantasy-land/equals"]||"function"==typeof e["fantasy-land/equals"])return"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e)&&"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t);if("function"==typeof t.equals||"function"==typeof e.equals)return"function"==typeof t.equals&&t.equals(e)&&"function"==typeof e.equals&&e.equals(t);switch(o){case"Arguments":case"Array":case"Object":if("function"==typeof t.constructor&&"Promise"===(n=t.constructor,null==(r=String(n).match(/^function (\w*)/))?"":r[1]))return t===e;break;case"Boolean":case"Number":case"String":if(typeof t!=typeof e||!Cs(t.valueOf(),e.valueOf()))return!1;break;case"Date":if(!Cs(t.valueOf(),e.valueOf()))return!1;break;case"Error":return t.name===e.name&&t.message===e.message;case"RegExp":if(t.source!==e.source||t.global!==e.global||t.ignoreCase!==e.ignoreCase||t.multiline!==e.multiline||t.sticky!==e.sticky||t.unicode!==e.unicode)return!1}for(var a=i.length-1;a>=0;){if(i[a]===t)return s[a]===e;a-=1}switch(o){case"Map":return t.size===e.size&&zs(t.entries(),e.entries(),i.concat([t]),s.concat([e]));case"Set":return t.size===e.size&&zs(t.values(),e.values(),i.concat([t]),s.concat([e]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var h=Rs(t);if(h.length!==Rs(e).length)return!1;var c=i.concat([t]),u=s.concat([e]);for(a=h.length-1;a>=0;){var l=h[a];if(!js(l,e)||!Hs(e[l],t[l],c,u))return!1;a-=1}return!0}const Us=rs((function(t,e){return Hs(t,e,[],[])})),qs=us((function(t,e,i){var s={};for(var n in i)s[n]=i[n];return s[t]=e,s})),Gs=ss((function(t){return null!=t&&"function"==typeof t["fantasy-land/empty"]?t["fantasy-land/empty"]():null!=t&&null!=t.constructor&&"function"==typeof t.constructor["fantasy-land/empty"]?t.constructor["fantasy-land/empty"]():null!=t&&"function"==typeof t.empty?t.empty():null!=t&&null!=t.constructor&&"function"==typeof t.constructor.empty?t.constructor.empty():ls(t)?[]:ds(t)?"":function(t){return"[object Object]"===Object.prototype.toString.call(t)}(t)?{}:Ms(t)?function(){return arguments}():void 0})),Vs=ss((function(t){return null!=t&&Us(t,Gs(t))}));function Ws(t,e){return function(t,e,i){var s,n;if("function"==typeof t.indexOf)switch(typeof e){case"number":if(0===e){for(s=1/e;i<t.length;){if(0===(n=t[i])&&1/n===s)return i;i+=1}return-1}if(e!=e){for(;i<t.length;){if("number"==typeof(n=t[i])&&n!=n)return i;i+=1}return-1}return t.indexOf(e,i);case"string":case"boolean":case"function":case"undefined":return t.indexOf(e,i);case"object":if(null===e)return t.indexOf(e,i)}for(;i<t.length;){if(Us(t[i],e))return i;i+=1}return-1}(e,t,0)>=0}function Ks(t,e,i){var s,n=typeof t;switch(n){case"string":case"number":return 0===t&&1/t==-1/0?!!i._items["-0"]||(e&&(i._items["-0"]=!0),!1):null!==i._nativeSet?e?(s=i._nativeSet.size,i._nativeSet.add(t),i._nativeSet.size===s):i._nativeSet.has(t):n in i._items?t in i._items[n]||(e&&(i._items[n][t]=!0),!1):(e&&(i._items[n]={},i._items[n][t]=!0),!1);case"boolean":if(n in i._items){var r=t?1:0;return!!i._items[n][r]||(e&&(i._items[n][r]=!0),!1)}return e&&(i._items[n]=t?[!1,!0]:[!0,!1]),!1;case"function":return null!==i._nativeSet?e?(s=i._nativeSet.size,i._nativeSet.add(t),i._nativeSet.size===s):i._nativeSet.has(t):n in i._items?!!Ws(t,i._items[n])||(e&&i._items[n].push(t),!1):(e&&(i._items[n]=[t]),!1);case"undefined":return!!i._items[n]||(e&&(i._items[n]=!0),!1);case"object":if(null===t)return!!i._items.null||(e&&(i._items.null=!0),!1);default:return(n=Object.prototype.toString.call(t))in i._items?!!Ws(t,i._items[n])||(e&&i._items[n].push(t),!1):(e&&(i._items[n]=[t]),!1)}}const Js=function(){function t(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}return t.prototype.add=function(t){return!Ks(t,!0,this)},t.prototype.has=function(t){return Ks(t,!1,this)},t}(),$s=rs((function(t,e){for(var i=[],s=0,n=t.length,r=e.length,o=new Js,a=0;a<r;a+=1)o.add(e[a]);for(;s<n;)o.add(t[s])&&(i[i.length]=t[s]),s+=1;return i})),Ys=us((function(t,e,i){return Us(e,i[t])})),Xs=ss((function(t){return function(){return t}})),Zs="visualViewport"in window;function Qs(){return Zs}const tn=navigator.userAgent,en="ontouchend"in document,sn=/\b(\w*Macintosh\w*)\b/.test(tn)&&en,nn=/\b(\w*iPhone\w*)\b/.test(tn)&&/\b(\w*Mobile\w*)\b/.test(tn)&&en,rn=sn||nn,on=()=>screen.orientation.type.startsWith("portrait")?"portrait":"landscape",an=hs(Bs(re,Pi(((t,e)=>t?pt():bt(e)))));function hn(t){if(rn)return function(t){if(!Qs())return console.warn("On-Screen-Keyboard detection not supported on this version of iOS"),()=>{};const[e,i]=Zi(),s=F(),n=Ss((()=>oe([Yi(visualViewport),$i(visualViewport),Yi(window)])),Ni(800),Ci((()=>{console.log(visualViewport.height*visualViewport.scale/document.documentElement.clientHeight)})),Ai((()=>visualViewport.height*visualViewport.scale/document.documentElement.clientHeight<.85)),Ke,Ai((t=>t?"visible":"hidden")),_i(i))();return kt(Ci(t,n),s),e}(t);const e=Math.max(700,700)-500+200,[i,s]=Zi(),n=F(),r=window.innerHeight,o=screen.availHeight-window.innerHeight,a=Oi((m=document.documentElement,void 0===y&&(y=!1),Ji("focusin",m,y)),function(t,e){return void 0===e&&(e=!1),Ji("focusout",t,e)}(document.documentElement)),h=As(Ji("visibilitychange",document))(Ss(Ai((()=>document.visibilityState)),Bi(document.visibilityState))),c=As(a)(Ss(Ai((t=>"focusin"===t.type?bt(!1):gt(700,!0))),qe,Bi(!(document.activeElement&&document.activeElement!==document.body)),Ke,bi)),u=As(function(t,e){return void 0===e&&(e=!1),Ji("change",t,e)}(screen.orientation))(Ss(Pi((t=>t||window.innerHeight===r),c),Ni(700),Ai((t=>({screenOrientation:on(),height:t?window.innerHeight:screen.availHeight-o}))))),l=As(c)(Ss(Ei(Os(!0)),Ai((()=>({screenOrientation:on(),height:window.innerHeight}))))),d=As(oe([l,u]))(Ss(Mi(1e3),an(Ai(Us("hidden"),h)),Ti(((t,{screenOrientation:e,height:i})=>qs(e,i,t)),{[on()]:window.innerHeight}),ji(Bs(Vs,$s(["portrait","landscape"]),Rs)))),p=As($i(window))(Ss(Ni(500),Ai((t=>({width:t.target.innerWidth,height:t.target.innerHeight}))),Ti(((t,e)=>({...e,isJustHeightResize:t.width===e.width,dH:e.height-t.height})),{width:window.innerWidth,height:window.innerHeight,isJustHeightResize:!1,dH:0}),Ei(Ys("isJustHeightResize",!0)))),f=As(p)(Ss(Mi(e),Pi(((t,{height:e,dH:i})=>{const s=t[on()];return s?e<.9*s&&i<0?bt("visible"):e===s&&i>0?bt("hidden"):pt():i>.1*screen.availHeight?bt("hidden"):i<-.1*screen.availHeight?bt("visible"):pt()}),d),re,Oi(As(c)(Ss(Ei(Os(!0)),Ai(Xs("hidden"))))),_i(s),Ke));var m,y;return kt(Ci(t,f),n),i}class cn extends Phaser.Scene{constructor(t){super(),this.callback=t}preload(){window.onbeforeunload=function(t){return t.preventDefault(),"You are in game.. Do you really want to leave?"};try{document.getElementsByClassName("grecaptcha-badge")[0].style.opacity=0}catch(t){console.log(t)}this.ready=!1,this.loadrect=this.add.image(0,0,"opening").setOrigin(0).setScrollFactor(0,0).setScale(2).setDepth(200);const t=this.cameras.main.width,e=this.cameras.main.height;this.loadrect.setScale(Math.max(t/this.loadrect.width,e/this.loadrect.height)),this.loadrect.x=0-(this.loadrect.displayWidth-t)/2,this.loadtext=this.add.text(this.canvas.width/2,this.canvas.height/2,"Loading...",{fontFamily:"Arial",fontSize:"32px",color:"#ffffff"}).setOrigin(.5).setScrollFactor(0,0).setDepth(200),this.ping=0}create(){this.levels=[],grecaptcha.ready((()=>{grecaptcha.execute("6LdVxgYdAAAAAPtvjrXLAzSd2ANyzIkiSqk_yFpt",{action:"join"}).then((e=>{this.readyt=!0,this.openingBgm.stop();var i={mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!1,delay:0};"normal"==this.options.sound?i.volume=.5:"high"==this.options.sound?i.volume=1:"low"==this.options.sound?i.volume=.2:"off"==this.options.sound?i.volume=0:i.volume=.5,this.coin=this.sound.add("coin",i),this.chestOpen=this.sound.add("chestOpen",i),this.damage=this.sound.add("damage",i),this.hit=this.sound.add("hit",i),this.winSound=this.sound.add("winSound",i),this.loseSound=this.sound.add("loseSound",i),this.tps=0,this.background=this.add.tileSprite(0,0,this.canvas.width,this.canvas.height,"background").setOrigin(0).setDepth(2),this.background.fixedToCamera=!0,this.meSword=this.add.image(400,100,"sword").setScale(.25).setDepth(50).setAlpha(.5),this.mePlayer=this.add.image(400,100,"player").setScale(.25).setDepth(51).setAlpha(.5),this.meChat=this.add.text(0,0,"",{fontFamily:"Georgia"}).setOrigin(.5).setDepth(71),this.meChatTween=void 0,this.swordAnim={go:!1,added:0},this.myObj=void 0;try{this.killCount=this.add.rexBBCodeText(15,10,"Stabs: 0",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'}).setFontSize(40).setDepth(101),this.killCount.addImage("coin",{key:"coin",width:45,height:45}),this.killCount.addImage("kill",{key:"kill",width:45,height:45}),this.killCount.setScrollFactor(0),this.playerCount=this.add.text(0,0,"Players: 0"+(this.mobile?"":"\nFPS: 0\nTPS: 0\nPing: 0 ms"),{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif',align:"right"}).setFontSize(20).setDepth(101).setOrigin(1),this.playerCount.setScrollFactor(1),this.leaderboard=this.add.rexBBCodeText(0,10,"",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'}).setFontSize(20).setDepth(101),this.leaderboard.setScrollFactor(0)}catch(t){console.log(t)}const s=(t,e,i)=>i*e/t;this.miniMap={people:[],scaleFactor:s(1189,96,this.canvas.width),square:void 0},this.miniGraphics=this.add.graphics().setDepth(100);var n=13;this.miniMap.scaleFactor=s(1189,96,this.canvas.width),this.miniGraphics.x=this.canvas.width-(2*this.miniMap.scaleFactor+n),this.miniGraphics.y=this.canvas.height-(2*this.miniMap.scaleFactor+n),this.miniGraphics.lineStyle(5,16776960,1),this.miniGraphics.strokeRoundedRect(0,0,2*this.miniMap.scaleFactor,2*this.miniMap.scaleFactor,0),this.cameras.main.ignore(this.miniGraphics),this.mobile&&"keys"==this.options.movementMode&&(this.joyStick=this.plugins.get("rexvirtualjoystickplugin").add(this,{x:this.canvas.width/6,y:this.canvas.height-this.canvas.height/2.5,radius:s(2360,250,this.canvas.width),base:this.add.circle(0,0,s(2360,250,this.canvas.width),8947848),thumb:this.add.circle(0,0,s(2360,100,this.canvas.width),13421772)}),this.cameras.main.ignore(this.joyStick.base),this.cameras.main.ignore(this.joyStick.thumb)),this.meBar=new o(this,0,0,16,80),this.meBar.bar.setAlpha(.5),this.meBar.bar.setDepth(71),this.lvlBar=new o(this,0,0,0,0,!0),n=this.canvas.width/2,this.lvlBar.x=n/2,this.lastKill=Date.now(),this.streak=0,this.killtxts=[],this.lvlBar.width=this.canvas.width-n,this.lvlBar.height=this.canvas.height/30,this.lvlBar.y=this.canvas.height-this.lvlBar.height-this.canvas.height/40,this.lvlBar.draw(),this.chat={obj:null,toggled:!1,btn:new t(this,0,0,"chatbtn",(()=>{if(!this.loadtext.visible&&(this.chat.toggled=!this.chat.toggled,this.spectating&&this.deadText.visible&&(this.callback(),this.socket.disconnect(),this.scene.start("title")),!this.spectating))if(this.chat.toggled){if(this.chat.obj=this.add.dom(this.canvas.width/2,this.canvas.height/2-this.canvas.height/5).createFromCache("chat"),this.chat.obj.getChildByID("chat").focus(),rn?Qs():en){const t=hn((e=>{"hidden"===e&&(this.chat.toggled=!1,this.chat.obj.destroy(),t())}))}}else if(this.chat.obj){var t=this.chat.obj.getChildByID("chat").value.trim();t.length>0&&this.socket.emit("chat",t),this.chat.obj.destroy()}}))},this.chat.btn.btn.setScale(Math.min(this.canvas.height/1e3,this.canvas.width/1500)),this.chat.btn.btn.x=this.killCount.width,this.mobile?this.cameras.main.ignore(this.chat.btn.btn):this.chat.btn.destroy(),this.coins=[],this.chests=[],this.enemies=[],this.dead=!1,this.spectating=!1;var r=Phaser.Input.Keyboard.KeyCodes;this.cursors=this.input.keyboard.addKeys({up:r.UP,down:r.DOWN,left:r.LEFT,right:r.RIGHT,enter:r.ENTER,esc:r.ESC},!1),this.cursors.esc.on("down",(()=>{this.chat.toggled&&(this.chat.obj.destroy(),this.chat.toggled=!1)})),this.cursors.enter.on("down",(()=>{if(!this.loadtext.visible&&(this.chat.toggled=!this.chat.toggled,this.spectating&&this.deadText.visible&&(this.callback(),this.socket.disconnect(),this.scene.start("title")),!this.spectating))if(this.chat.toggled)this.chat.obj=this.add.dom(this.canvas.width/2,this.canvas.height/2-this.canvas.height/5).createFromCache("chat"),this.chat.obj.getChildByID("chat").focus();else if(this.chat.obj){var t=this.chat.obj.getChildByID("chat").value.trim();t.length>0&&this.socket.emit("chat",t),this.chat.obj.destroy()}}));try{this.lvlText=this.add.text(this.canvas.width/2,this.canvas.height/5,"",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'}).setFontSize(s(1366,75,this.canvas.width)).setDepth(75).setAlpha(0).setOrigin(.5),this.lvlTextTween=void 0,this.lvlState=this.add.text(this.canvas.width/2,this.lvlBar.y-this.lvlBar.height,"",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'}).setFontSize(s(1366,50,this.canvas.width)).setDepth(75).setAlpha(1).setOrigin(.5),this.lvlState.y=this.lvlBar.y-this.lvlState.height/2}catch(t){console.log(t)}this.cameras.main.setZoom(1),this.UICam=this.cameras.add(this.cameras.main.x,this.cameras.main.y,this.canvas.width,this.canvas.height),this.cameras.main.ignore([this.killCount,this.playerCount,this.leaderboard,this.lvlBar.bar,this.lvlText,this.lvlState]),this.UICam.ignore([this.mePlayer,this.meBar.bar,this.meSword,this.background,this.meChat]),this.cameras.main.startFollow(this.mePlayer,!0),this.bushes=[],[{x:730,y:1885,scale:1.0376209236313056},{x:925,y:-320,scale:1.5186209845008154},{x:1433,y:754,scale:3.330284753416469},{x:4731,y:4730,scale:2.0686243258009513},{x:-3023,y:-4707,scale:.7038654598544245},{x:4697,y:418,scale:1.802746456554166},{x:1890,y:-648,scale:2.4500834253457233},{x:2835,y:2983,scale:1.9362154580101363},{x:-3012,y:4669,scale:1.546032408451703},{x:-522,y:-4917,scale:3.2978158998596006},{x:-4547,y:-3990,scale:.9277566244553441},{x:796,y:-712,scale:1.1184998043695427},{x:-3766,y:4544,scale:1.4140888384465091},{x:4882,y:-1172,scale:2.9802609570057004},{x:-3496,y:3954,scale:2.3808287583935375},{x:-3238,y:-2996,scale:2.526057254546086},{x:-1389,y:-358,scale:.8106953578091867},{x:-4967,y:-4055,scale:3.0097164420138225},{x:4495,y:-529,scale:2.534394803759131},{x:-1338,y:1861,scale:2.928118076148369},{x:1737,y:-4743,scale:2.263077224463025},{x:-3911,y:2248,scale:.7689489264893516},{x:4896,y:-3368,scale:2.588709259426132},{x:-3883,y:-3703,scale:1.731361865138802},{x:950,y:2029,scale:2.8878029144744146},{x:-173,y:829,scale:1.3048181525137694},{x:2619,y:1091,scale:.5879937552009757},{x:-3017,y:2308,scale:2.264103933252742},{x:1246,y:1595,scale:1.5130647587630643},{x:-2598,y:-262,scale:3.0282547149681767},{x:-3123,y:-1763,scale:2.0368365078668207},{x:-684,y:4420,scale:2.5159608843125834},{x:-1526,y:-4429,scale:1.0488795535338693},{x:-1382,y:1674,scale:1.729326708118081},{x:4954,y:-1326,scale:1.2051737116831303},{x:-3769,y:1367,scale:3.0269153418946013},{x:1237,y:3494,scale:3.2258158972294297},{x:1683,y:-3486,scale:3.2527072679208078},{x:419,y:508,scale:2.652076728813408},{x:-4992,y:2409,scale:2.762880141675235},{x:3056,y:-3543,scale:2.3900673234419982},{x:3495,y:-3043,scale:1.3521516228090635},{x:-4388,y:3200,scale:2.9916255625674655},{x:1292,y:-993,scale:3.3641794453414664},{x:1952,y:2357,scale:1.1450742110647643},{x:-4831,y:1835,scale:1.2585290364415982},{x:-1477,y:-521,scale:3.240414650997602},{x:-4884,y:1193,scale:1.237036932117828},{x:-4521,y:-1972,scale:1.554328117808823},{x:1315,y:3287,scale:.8727352911734498},{x:1150,y:-1059,scale:1.335191874076673},{x:-1293,y:508,scale:2.505831529572055},{x:4333,y:1306,scale:2.3411772808523876},{x:2896,y:4913,scale:2.465530835587337},{x:-634,y:-4615,scale:2.1430471830680315},{x:1355,y:405,scale:1.9967528611299323},{x:3215,y:-3646,scale:2.5265313480752716},{x:-2285,y:-4338,scale:2.8433396478871336},{x:210,y:4727,scale:2.796103862725438},{x:-465,y:154,scale:.6770522495838267},{x:3621,y:-739,scale:1.860257544095416},{x:4421,y:288,scale:3.2011906741552547},{x:3990,y:-3216,scale:.6708087098641271},{x:3413,y:-1356,scale:3.122881532340258},{x:-3161,y:-640,scale:1.0600690011923222},{x:3518,y:411,scale:1.2594288815012689},{x:2584,y:-3716,scale:.8464974155777956},{x:4891,y:4279,scale:3.334059910907162},{x:2550,y:-1426,scale:1.871614075133459},{x:880,y:-1400,scale:1.2988510930930697},{x:2897,y:692,scale:.7811024064504772},{x:18,y:-1805,scale:2.7979346816010358},{x:4933,y:-4731,scale:3.4052415107942737},{x:-3608,y:-2643,scale:3.0182716926485567},{x:631,y:3567,scale:2.048644117075934},{x:3412,y:-2901,scale:1.6173481014877604},{x:-2965,y:-3056,scale:.7452272417689609},{x:-4221,y:1948,scale:3.0571964273080168},{x:-2733,y:-3481,scale:1.7993863030259765},{x:418,y:-170,scale:2.471839671977092},{x:-2643,y:2135,scale:2.224174416443268},{x:-3564,y:-3646,scale:1.123817873201157},{x:-2594,y:-194,scale:2.8359960938485402},{x:-3914,y:-1779,scale:1.669051229582097},{x:-1282,y:3667,scale:3.397330925497699},{x:1474,y:-2638,scale:3.1244654444686324},{x:-4909,y:-1278,scale:2.4338719734410788},{x:-3549,y:2724,scale:3.013256745783262},{x:-2411,y:3431,scale:1.2631073582763315},{x:-2421,y:2356,scale:1.9414196684081193},{x:-4426,y:43,scale:2.611750089893035},{x:494,y:4517,scale:1.6634604133591617},{x:-3123,y:45,scale:1.2116242240774102},{x:3297,y:-3254,scale:2.098822393550005},{x:2230,y:4430,scale:1.949718190558567},{x:3917,y:719,scale:.5019871453063103},{x:4225,y:-3866,scale:1.4486156579085072},{x:113,y:-3228,scale:2.383273384336228},{x:-1466,y:-725,scale:2.549875235972383},{x:2284,y:-1330,scale:3.294659747724501}].forEach(((t,e)=>{e%2!=0&&(this.bushes.push(this.add.image(t.x,t.y,"bush").setScale(t.scale).setDepth(70)),this.UICam.ignore(this.bushes[this.bushes.length-1]))})),this.input.addPointer(3);const a=()=>{if(this.scene.isActive("game"))try{this.game.scale.resize(this.canvas.width,this.canvas.height),this.lvlText.y=this.canvas.height/5,this.lvlText.x=this.canvas.width/2,this.mobile&&"keys"==this.options.movementMode&&(this.joyStick.x=this.canvas.width/8,this.joyStick.y=this.canvas.height-this.canvas.height/2.5,this.joyStick.base.radius=s(2360,250,this.canvas.width),this.joyStick.thumb.radius=s(2360,100,this.canvas.width),this.joyStick.radius=s(2360,250,this.canvas.width)),this.UICam.x=this.cameras.main.x,this.UICam.y=this.cameras.main.y,this.chat.btn.btn.setScale(Math.min(this.canvas.height/1e3,this.canvas.width/1500)),this.chat.btn.btn.x=this.killCount.width,this.miniGraphics.clear();var e=13;if(this.miniMap.scaleFactor=s(1189,96,this.canvas.width),this.miniGraphics.x=this.canvas.width-(2*this.miniMap.scaleFactor+e),this.miniGraphics.y=this.canvas.height-(2*this.miniMap.scaleFactor+e),this.miniGraphics.lineStyle(5,16776960,1),this.miniGraphics.strokeRoundedRect(0,0,2*this.miniMap.scaleFactor,2*this.miniMap.scaleFactor,0),this.background.width=this.canvas.width,this.background.height=this.canvas.height,e=this.canvas.width/2,this.spectating){function r(t){parseInt(t%1e3/100);var e=Math.floor(t/1e3%60),i=Math.floor(t/6e4%60),s=Math.floor(t/36e5%24);return("00"==s?"":s+"h ")+("00"==i?"":i+"m ")+e+"s"}this.deathRect.destroy(),this.deathRect=this.add.rectangle(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2,this.canvas.height/1.5,9498256),this.deadText.destroy(),this.deadText=this.add.text(this.canvas.width/2,this.deathRect.y-this.deathRect.height/2,"You got stabbed",{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.deadText.setFontSize(Math.min(this.canvas.width/25,this.canvas.height/20)),this.deadText.y+=this.deadText.height;var i=["Nooooooooo","Rest in peace","You can do better!","Practice makes perfect!","Keep trying!"],n=i[Math.floor(Math.random()*i.length)];this.dataText.destroy(),this.dataText=this.add.text(this.canvas.width/2,this.deadText.y,n,{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.dataText.setFontSize(Math.min(this.canvas.width/40,this.canvas.height/30)),this.dataText.y+=1.5*this.dataText.height,this.statsText.destroy(),this.statsText=this.add.text(this.canvas.width/2,this.dataText.y,"Stabbed By: "+this.dtas.killedBy+"\nCoins: "+this.myObj.coins+"\nKills: "+this.myObj.kills+"\nSurvived: "+r(this.dtas.timeSurvived),{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.statsText.setFontSize(Math.min(this.canvas.width/35,this.canvas.height/25)),this.statsText.y+=this.statsText.height,this.playAgain.destroy(),this.playAgain=new t(this,0,0,"playAgainBtn",(()=>{this.callback(),this.socket.disconnect(),this.scene.start("title")})),this.playAgain.btn.setScale(Math.min(this.canvas.width/6533.33333333,this.canvas.height/5532.33333333)),this.playAgain.btn.y=this.statsText.y+this.statsText.displayHeight,this.playAgain.btn.x=this.canvas.width/2,this.playAgain.btn.x-=this.playAgain.btn.displayWidth/2}if(this.spectating)return;this.lvlBar.x=e/2,this.lvlBar.width=this.canvas.width-e,this.lvlBar.height=this.canvas.height/30,this.lvlBar.y=this.canvas.height-this.lvlBar.height-this.canvas.height/40,this.lvlBar.draw(),this.lvlState.x=this.canvas.width/2,this.lvlState.setFontSize(s(1366,50,this.canvas.width)),this.lvlState.y=this.lvlBar.y-this.lvlState.height/2,this.playerCount.x=this.miniGraphics.x+2*this.miniMap.scaleFactor,this.playerCount.y=this.canvas.height-2*this.miniMap.scaleFactor-17,this.lvlText.setFontSize(s(1366,75,this.canvas.width))}catch(o){console.log(o)}};var h;window.addEventListener("resize",(function(){clearTimeout(h),h=setTimeout(a,100)}));var c="us1"==this.options.server?"https://us2.swordbattle.io":"us2"==this.options.server?"https://sword-io-game.herokuapp.com":"https://swordbattle.herokuapp.com";function u(t){document.write("Failed to connect to the server, please try a different server or contact devs.<br>"+t+"<br><br>")}this.socket=io(c,{closeOnBeforeunload:!1,transports:["websocket"]}),this.socket.on("connect_error",u),this.socket.on("connect_failed",u),this.secret?this.socket.emit("go",this.secret,e,!0,this.options):this.socket.emit("go",this.name,e,!1,this.options);const l=t=>{this.mobile&&this.joyStick&&this.joyStick.pointer&&this.joyStick.pointer.id==t.id||this.mouseDown||(t&&(this.gamePoint={x:t.x,y:t.y}),this.mouseDown=!0,this.socket.emit("mouseDown",!0))},d=t=>{this.mobile&&this.joyStick&&this.joyStick.pointer&&this.joyStick.pointer.id==t.id||this.mouseDown&&(t&&(this.gamePoint={x:t.x,y:t.y}),this.mouseDown=!1,this.socket.emit("mouseDown",!1))};this.input.keyboard.on("keydown-SPACE",(()=>{l()}),this),this.input.keyboard.on("keyup-SPACE",(()=>{d()}),this),this.input.on("pointerdown",(function(t){l(t)}),this),this.input.on("pointerup",(function(t){d(t)}),this),this.mobile&&(this.gamePoint={x:0,y:0},this.input.on("pointermove",(t=>{this.joyStick.pointer&&this.joyStick.pointer.id==t.id||(this.gamePoint={x:t.x,y:t.y})}))),this.socket.on("tps",(t=>{this.tps=t;var e=Date.now();this.socket.emit("ping",(()=>{this.ping=Date.now()-e}))})),this.socket.on("ban",(t=>{document.write(t)})),this.graphics=this.add.graphics().setDepth(4);this.graphics.lineStyle(5e3,25600,1),this.graphics.strokeRoundedRect(-7500,-7500,15e3,15e3,0),this.graphics.lineStyle(10,16776960,1),this.graphics.strokeRoundedRect(-5e3,-5e3,1e4,1e4,0),this.socket.on("levels",(t=>this.levels=t));const p=t=>{if(!(this.enemies.filter((e=>e.id===t.id)).length>0)){var e={id:t.id,down:!1,playerObj:void 0,lastTick:Date.now(),sword:this.add.image(t.pos.x,t.pos.y,t.skin+"Sword").setScale(.25).setDepth(49),player:this.add.image(t.pos.x,t.pos.y,t.skin+"Player").setScale(.25).setDepth(49),bar:new o(this,t.pos.x,t.pos.y+55),nameTag:this.add.rexBBCodeText(t.pos.x,t.pos.y-90,`${t.name}`,{fontFamily:"serif",fill:t.verified?"mitblade"==t.name.toLowerCase()||"codergautam"==t.name.toLowerCase()?"#FF0000":"#0000FF":"#000000",fontSize:"25px"}).setDepth(69).setAlpha(t.verified?1:.5),swordAnim:{go:!1,added:0},toAngle:0,chatText:this.add.text(0,0,"",{fontFamily:"Georgia"}).setDepth(71).setOrigin(.5),chatTween:void 0},i=100/(100*t.scale)*1.5;e.sword.angle=180*Math.atan2(t.mousePos.y-t.mousePos.viewport.height/2,t.mousePos.x-t.mousePos.viewport.width/2)/Math.PI+45,e.sword.x=e.player.x+e.player.width/i*Math.cos(e.sword.angle*Math.PI/180),e.sword.y=e.player.y+e.player.width/i*Math.sin(e.sword.angle*Math.PI/180),e.bar.bar.setDepth(69),this.UICam.ignore([e.player,e.bar.bar,e.sword,e.nameTag,e.chatText,this.graphics]),this.enemies.push(e);var s=this.add.circle(0,0,10,16711680);this.cameras.main.ignore(s),s.setDepth(98),this.miniMap.people.push({id:t.id,circle:s}),Date.now()-t.joinTime<5e3&&(e.player.setAlpha(.5),e.sword.setAlpha(.5),e.bar.bar.setAlpha(.5),setTimeout((()=>{this.tweens.add({targets:[e.player,e.sword,e.bar.bar],alpha:1,duration:100,ease:"Linear",repeat:0,yoyo:!1})}),5e3-(Date.now()-t.joinTime)))}};this.removePlayer=t=>{try{var e=this.enemies.find((e=>e.id==t));this.tweens.add({targets:[e.player,e.nameTag,e.bar.bar,e.sword],alpha:0,duration:150,ease:"Sine2",onComplete:()=>{e.player.destroy(),this.enemies.splice(this.enemies.findIndex((e=>e.id==t)),1),e.bar.destroy(),e.nameTag.destroy(),e.sword.destroy(),this.spectating||(this.miniMap.people.find((e=>e.id===t)).circle.destroy(),this.miniMap.people=this.miniMap.people.filter((e=>e.id!=t)))}})}catch(t){console.log(t)}},this.socket.on("players",(t=>{t.forEach((t=>p(t))),this.ready=!0,this.ready||(this.ready=!0)})),this.socket.on("new",(t=>{p(t),this.ready||(this.ready=!0)})),this.socket.on("me",(t=>{if(this.loadrect.visible&&this.loadrect.destroy(),this.loadtext.visible&&this.loadtext.destroy(),this.levels.length>0)if(t.level>=this.levels.length-1)this.lvlState.setText("Max Level"),this.lvlBar.setLerpValue(100);else{var e=this.levels[t.level-1].coins-this.levels[t.level-1].start,i=t.coins-this.levels[t.level-1].start;this.lvlBar.setLerpValue(i/e*100),this.lvlState.setText("Level: "+t.level+" ("+Math.round(i/e*100)+"%)"),this.myObj&&t.level>this.myObj.level&&(this.lvlTextTween&&this.lvlTextTween.stop(),this.lvlText.data||this.lvlText.setData("x",0),this.lvlText.setData("x",this.lvlText.getData("x")+(t.level-this.myObj.level)),this.lvlText.setText("Level up!"+(this.lvlText.getData("x")>1?` x${this.lvlText.getData("x")}`:"")),this.lvlTextTween=this.tweens.add({targets:this.lvlText,alpha:1,y:this.canvas.height/4,completeDelay:1e3,duration:500,onComplete:()=>{this.lvlTextTween=this.tweens.add({targets:this.lvlText,alpha:0,y:this.canvas.height/5,onComplete:()=>this.lvlText.setData("x",0),duration:300,ease:"Power2"},this)},ease:"Power2"},this))}this.spectating||this.mePlayer.texture.key+"Player"==t.skin||(this.mePlayer.setTexture(t.skin+"Player"),this.meSword.setTexture(t.skin+"Sword")),this.myObj?this.tweens.add({targets:this.mePlayer,x:t.pos.x,y:t.pos.y,duration:300,ease:"Power2"}):(this.mePlayer.x=t.pos.x,this.mePlayer.y=t.pos.y),this.mePlayer.setScale(t.scale),this.meBar.maxValue=t.maxHealth,this.meBar.setHealth(t.health);var n=1e3;n+=this.mePlayer.width*this.mePlayer.scale*5;var r=Math.max(this.scale.width/n,this.scale.height/n);if(this.cameras.main.setZoom(r),this.meSword.setScale(t.scale),this.background.setTileScale(this.cameras.main.zoom,this.cameras.main.zoom),this.background.displayWidth=this.cameras.main.displayWidth,this.background.displayHeight=this.cameras.main.displayHeight,this.killCount.setText("[img=kill] "+t.kills+"\n[img=coin] "+t.coins),this.myObj=t,!this.miniMap.people.find((e=>e.id===t.id))){var o=this.add.circle(0,0,10,16777215);this.cameras.main.ignore(o),o.setDepth(99),this.miniMap.people.push({id:t.id,circle:o})}if(!this.spectating){var a=this.miniMap.people.find((e=>e.id===t.id));a.circle.x=this.miniGraphics.x+t.pos.x/5e3*this.miniMap.scaleFactor+this.miniMap.scaleFactor,a.circle.y=this.miniGraphics.y+t.pos.y/5e3*this.miniMap.scaleFactor+this.miniMap.scaleFactor,a.circle.radius=t.scale*s(1280,15,this.canvas.width)}this.bushes.filter((t=>function(t,e,i,s,n,r){var o,a;return o=t-s,a=e-n,i+r>Math.sqrt(o*o+a*a)&&i>r/2}(t.x,t.y,t.displayWidth/2,this.mePlayer.x,this.mePlayer.y,this.mePlayer.displayWidth/2))).length>0?this.meBar.bar.setAlpha(.3):1!=this.meBar.bar.alpha&&this.meBar.bar.setAlpha(1)})),this.socket.on("player",(t=>{if(this.ready)try{var e=this.enemies.find((e=>e.id==t.id));if(!e)return;e.lastTick=Date.now(),e.playerObj=t,e.bar.maxValue=t.maxHealth,e.bar.setHealth(t.health),this.tweens.add({targets:e.player,x:t.pos.x,y:t.pos.y,duration:300,ease:"Power2"});var i=t.mousePos;if(e.toAngle=180*Math.atan2(i.y-i.viewport.height/2,i.x-i.viewport.width/2)/Math.PI+45,e.player.setScale(t.scale),e.sword.setScale(t.scale),e.down=t.mouseDown,this.spectating)return;var n=this.miniMap.people.find((e=>e.id===t.id));n.circle.x=this.miniGraphics.x+t.pos.x/5e3*this.miniMap.scaleFactor+this.miniMap.scaleFactor,n.circle.y=this.miniGraphics.y+t.pos.y/5e3*this.miniMap.scaleFactor+this.miniMap.scaleFactor,n.circle.radius=s(1280,15,this.canvas.width)*t.scale}catch(t){console.log(t)}})),this.socket.on("chat",(t=>{if(this.myObj)if(t.id==this.myObj.id)this.meChat.setText(t.msg),this.meChat.setAlpha(0),this.meChatTween&&this.meChatTween.stop(),this.meChatTween=this.tweens.add({targets:this.meChat,duration:200,alpha:1,completeDelay:2e3,onComplete:()=>{this.meChatTween=this.tweens.add({targets:this.meChat,duration:200,alpha:0,onComplete:()=>{this.meChat.setText("")}})},ease:"Power2"});else{var e=this.enemies.find((e=>e.id==t.id));if(!e)return;e.chatText.setText(t.msg),e.chatText.setAlpha(0),e.chatTween&&e.chatTween.stop(),e.chatTween=this.tweens.add({targets:e.chatText,duration:200,alpha:1,completeDelay:2e3,onComplete:()=>{e.chatTween=this.tweens.add({targets:e.chatText,duration:200,alpha:0,onComplete:()=>{e.chatText.setText("")}})}})}})),this.socket.on("playerLeave",this.removePlayer),this.socket.on("playerDied",((t,e)=>{if(this.myObj&&this.myObj.id===e.killedBy.id){var i=this.enemies.find((e=>e.id==t));if(i&&i.playerObj){var n=s(1366,64,this.canvas.width);if(Date.now()-this.lastKill<2500){this.streak++;var r="[b]",o=["Double","Triple","Quadra","Quinta","Hexta","Hepta","Octa","Nona","Deca"];this.streak-1>o.length?r+=`x${this.streak}`:r+=o[this.streak-1],r+=" Kill![/b]",this.killtxts.forEach((t=>{t.destroy()})),this.killtxts=[]}else this.streak=0,r=`[b][color=#e82a1f]Stabbed [/color][color=#0000FF]${i.playerObj.name}[/color][/b]`;var a=this.add.rexBBCodeText(this.canvas.width/2,this.canvas.height,r).setOrigin(.5).setAlpha(0).setFontSize(n);a.setData("index",this.killtxts.length),this.killtxts.push(a);const t=t=>{this.tweens.add({targets:t,alpha:0,y:this.canvas.height,onComplete:()=>{this.killtxts.slice(t.getData("index"),1),t.destroy()},ease:"Power2",duration:250})};this.tweens.add({targets:a,alpha:1,y:this.canvas.height-this.canvas.height/6,completeDelay:250,duration:750,onComplete:()=>t(a),ease:"Bounce"},this),this.cameras.main.ignore(a)}this.lastKill=Date.now()}this.removePlayer(t)})),this.socket.on("dealHit",((t,e)=>{var i=this.enemies.find((e=>e.id==t));if(i){var s=this.add.particles("hitParticle"),n=s.createEmitter({maxParticles:5,scale:.01});n.setPosition(e?e.x:i.player.x,e?e.y:i.player.y),this.UICam.ignore(s),n.setSpeed(200),s.setDepth(105),n.setBlendMode(Phaser.BlendModes.ADD)}this.hit.play()})),this.socket.on("takeHit",((t,e)=>{this.damage.play();var i=this.add.particles("hitParticle"),s=i.createEmitter({maxParticles:5,scale:.01});s.setPosition(this.mePlayer.x,this.mePlayer.y),this.UICam.ignore(i),s.setSpeed(200),i.setDepth(105)}));const f=(t,e)=>{if(!this.dead){var i=!0;e||(e=[t.pos.x,t.pos.y],i=!1),this.coins.push({id:t.id,item:this.add.image(e[0],e[1],"coin").setScale(t.size/100).setDepth(20).setAlpha(i?0:1),state:{collected:!1,collectedBy:void 0,time:0}}),i&&this.tweens.add({targets:this.coins[this.coins.length-1].item,alpha:1,x:t.pos.x,y:t.pos.y,duration:250,ease:"Sine2"}),this.UICam.ignore(this.coins[this.coins.length-1].item)}},m=(t,e)=>{if(!this.dead){var i=!0;e||(e=[t.pos.x,t.pos.y],i=!1),this.chests.push({id:t.id,item:this.add.image(e[0],e[1],"chest").setScale(t.scale).setDepth(21).setAlpha(i?0:1).setOrigin(0)}),i&&this.tweens.add({targets:this.chests[this.chests.length-1].item,alpha:1,x:t.pos.x,y:t.pos.y,duration:250,ease:"Sine2"}),this.UICam.ignore(this.chests[this.chests.length-1].item)}};this.socket.on("coins",(t=>{t.forEach((t=>{0==this.coins.filter((e=>e.id==t.id)).length&&f(t)})),this.coins.filter((e=>0==t.filter((t=>e.id==t.id&&!e.state.collected)).length)).forEach((t=>{t.item.destroy()})),this.coins=this.coins.filter((e=>1==t.filter((t=>e.id==t.id&&!e.state.collected)).length))})),this.socket.on("coin",((t,e)=>{Array.isArray(t)?e?t.forEach((t=>{f(t,e)})):t.forEach((t=>{f(t)})):f(t)})),this.socket.on("chests",(t=>{t.forEach((t=>{0==this.chests.filter((e=>e.id==t.id)).length&&m(t)})),this.chests.filter((e=>0==t.filter((t=>e.id==t.id)).length)).forEach((t=>{t.item.destroy()})),this.chests=this.chests.filter((e=>1==t.filter((t=>e.id==t.id)).length))})),this.socket.on("chest",((t,e)=>{Array.isArray(t)?e?t.forEach((t=>{m(t,e)})):t.forEach((t=>{m(t)})):m(t)})),this.socket.on("youDied",(e=>{this.dtas={killedBy:e.killedBy,timeSurvived:e.timeSurvived},this.spectating=!0,this.mePlayer.destroy(),this.meBar.destroy(),this.meSword.destroy(),this.lvlBar.destroy(),this.lvlState.destroy(),this.killCount.destroy(),this.leaderboard.destroy(),this.miniGraphics.destroy(),this.playerCount.destroy(),this.chat.obj&&this.chat.obj.destroy(),this.mobile&&(this.joyStick.destroy(),this.chat.btn.destroy()),this.miniMap.people.forEach((t=>{t.circle.destroy()})),this.miniMap.people=[],this.time.delayedCall(1500,(()=>{this.deathRect=this.add.rectangle(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2,this.canvas.height/1.5,9498256).setAlpha(0),this.cameras.main.ignore(this.deathRect),this.tweens.add({targets:this.deathRect,alpha:1,duration:250,ease:"Sine2",onComplete:()=>{this.deadText=this.add.text(this.canvas.width/2,this.deathRect.y-this.deathRect.height/2,"You got stabbed",{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.cameras.main.ignore(this.deadText),this.deadText.setFontSize(Math.min(this.canvas.width/25,this.canvas.height/20)),this.deadText.y+=this.deadText.height;var i=["Nooooooooo","Rest in peace","You can do better!","Practice makes perfect!","Keep trying!"],s=i[Math.floor(Math.random()*i.length)];this.dataText=this.add.text(this.canvas.width/2,this.deadText.y,s,{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.dataText.setFontSize(Math.min(this.canvas.width/40,this.canvas.height/30)),this.dataText.y+=1.5*this.dataText.height,this.cameras.main.ignore(this.dataText),this.statsText=this.add.text(this.canvas.width/2,this.dataText.y,"Stabbed By: "+e.killedBy+"\nCoins: 0\nKills: 0\nSurvived: 0s",{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.statsText.setFontSize(Math.min(this.canvas.width/35,this.canvas.height/25)),this.statsText.y+=this.statsText.height,this.cameras.main.ignore(this.statsText),this.playAgain=new t(this,0,0,"playAgainBtn",(()=>{this.callback(),this.socket.disconnect(),this.scene.start("title")})),this.playAgain.btn.setScale(Math.min(this.canvas.width/6533.33333333,this.canvas.height/5532.33333333)),this.cameras.main.ignore(this.playAgain.btn),this.playAgain.btn.y=this.statsText.y+this.statsText.displayHeight,this.playAgain.btn.x=this.canvas.width/2,this.playAgain.btn.x-=this.playAgain.btn.displayWidth/2,this.tweens.addCounter({from:0,to:100,duration:1e3,onUpdate:t=>{var i=Math.round(this.myObj.coins*(t.getValue()/100)),s=Math.round(this.myObj.kills*(t.getValue()/100)),n=Math.round(e.timeSurvived*(t.getValue()/100));this.statsText.setText("Stabbed By: "+e.killedBy+"\nCoins: "+i+"\nKills: "+s+"\nSurvived: "+function(t){parseInt(t%1e3/100);var e=Math.floor(t/1e3%60),i=Math.floor(t/6e4%60),s=Math.floor(t/36e5%24);return("00"==s?"":s+"h ")+("00"==i?"":i+"m ")+e+"s"}(n))}})}})}))})),this.socket.on("youWon",(t=>{this.win(t)})),this.socket.on("collected",((t,e,i)=>{this.myObj&&this.myObj.id==e&&(i?this.coin:this.chestOpen).play(),this.coins.find((e=>e.id==t))?this.coins.find((e=>e.id==t)).state={collected:!0,collectedBy:e,time:0}:this.chests.find((e=>e.id==t))&&this.tweens.add({targets:this.chests.find((e=>e.id==t)).item,alpha:0,duration:500,ease:"Sine2",onComplete:t=>{t.targets[0].destroy()}})})),this.playerCount.x=this.miniGraphics.x+2*this.miniMap.scaleFactor,this.playerCount.y=this.canvas.height-2*this.miniMap.scaleFactor-17,setTimeout((()=>{this.tweens.add({targets:[this.mePlayer,this.meSword,this.meBar.bar],alpha:1,duration:100,ease:"Linear",repeat:0,yoyo:!1})}),5e3)}))}))}update(t,e){if(this.readyt){try{this.lvlBar.update()}catch(t){console.log("Failed to update level bar"),console.log(t)}var i={left:!1,up:!1,right:!1,down:!1},s=this.input.keyboard.addKey("W",!1),n=this.input.keyboard.addKey("A",!1),r=this.input.keyboard.addKey("S",!1),o=this.input.keyboard.addKey("D",!1);try{this.key=this.mobile&&this.joyStick?this.joyStick.createCursorKeys():this.cursors,(this.key.up.isDown||s.isDown)&&(i.up=!0),(this.key.down.isDown||r.isDown)&&(i.down=!0),(this.key.right.isDown||o.isDown)&&(i.right=!0),(this.key.left.isDown||n.isDown)&&(i.left=!0),this.socket.emit("move",i)}catch(t){console.log(t)}if(this.meSword)var a=this.meSword.angle;if(this.mobile)h=this.gamePoint;else var h=this.input;this.meSword.angle=180*Math.atan2(h.y-this.canvas.height/2,h.x-this.canvas.width/2)/Math.PI+45,this.mePlayer.angle=this.meSword.angle+45+180;var c=this.myObj?this.myObj.damageCooldown:120;this.mouseDown&&!this.swordAnim.go&&0==this.swordAnim.added?(this.swordAnim.go=!0,this.tweens.addCounter({from:0,to:50,duration:c,onUpdate:t=>{this.swordAnim.added=t.getValue()},onComplete:()=>{this.swordAnim.go=!1}})):!this.swordAnim.go&&!this.mouseDown&&this.swordAnim.added>0&&(this.swordAnim.go=!0,this.tweens.addCounter({from:50,to:0,duration:c,onUpdate:t=>{this.swordAnim.added=t.getValue()},onComplete:()=>{this.swordAnim.go=!1}})),this.meSword.angle-=this.swordAnim.added;var u={viewport:{width:this.canvas.width,height:this.canvas.height},x:h.x,y:h.y};this.socket&&a&&this.meSword.angle!=a&&this.socket.emit("mousePos",u);var l=this.sys.game.loop.actualFps;this.enemies.forEach((t=>{if(Date.now()-t.lastTick>1e4)return this.removePlayer(t);if(t.playerObj)var i=t.playerObj.scale;else i=.25;t.bar.width=t.player.height*i/.9375,t.bar.height=t.player.height*i*.15,t.bar.x=t.player.x-t.bar.width/2,t.bar.y=t.player.y-t.player.height*i/1.2,t.bar.draw();try{t.nameTag.setFontSize(100*i),t.nameTag.x=t.player.x-t.nameTag.width/2,t.nameTag.y=t.player.y-t.player.height*i-t.nameTag.height}catch(t){console.log(t)}try{t.playerObj&&t.chatText.setFontSize(100*t.playerObj.scale),t.chatText.x=t.player.x,t.chatText.y=t.nameTag.y-t.bar.height}catch(t){console.log(t)}if(t.playerObj)var s=100/(100*t.playerObj.scale)*1.5;else s=6;if(t.sword.angle=function(t,e,i){const s=function(t,e){return i=t-Math.floor(t/e)*e,s=e,Math.min(Math.max(i,0),s);var i,s}(e-t,360);return x(t,t+(s>180?s-360:s),.5)}(t.sword.angle,t.toAngle),t.player.angle=t.sword.angle+45+180,t.down?(t.swordAnim.added||(t.swordAnim.added=0),t.swordAnim.added<=0&&(t.swordAnim.go=!0)):t.swordAnim.added>=50&&(t.swordAnim.go=!1),t.swordAnim.go&&t.swordAnim.added<50){var n=50/t.playerObj.damageCooldown*e;t.swordAnim.added<50&&(t.swordAnim.added+=n)}!t.swordAnim.go&&t.swordAnim.added>0&&(t.swordAnim.added-=10),t.sword.angle-=t.swordAnim.added,t.sword.x=t.player.x+t.player.width/s*Math.cos(t.sword.angle*Math.PI/180),t.sword.y=t.player.y+t.player.width/s*Math.sin(t.sword.angle*Math.PI/180)}));var d=this.myObj;d||(d={scale:.25});try{if(this.meBar.width=this.mePlayer.height*d.scale/.9375,this.meBar.height=this.mePlayer.height*d.scale*.2,this.meBar.x=this.mePlayer.x-this.meBar.width/2,this.meBar.y=this.mePlayer.y-this.mePlayer.height*d.scale/1.2,this.myObj&&this.meChat.setFontSize(100*this.myObj.scale),this.meChat.x=this.mePlayer.x,this.meChat.y=this.meBar.y-this.meBar.height,this.meBar.draw(),this.myObj)var p=100/(100*this.myObj.scale)*1.5;else p=6;this.meSword.x=this.mePlayer.x+this.mePlayer.width/p*Math.cos(this.meSword.angle*Math.PI/180),this.meSword.y=this.mePlayer.y+this.mePlayer.width/p*Math.sin(this.meSword.angle*Math.PI/180)}catch(t){console.log(t)}if(this.myObj){var f=this.enemies.filter((t=>t.hasOwnProperty("playerObj")&&t.playerObj));f.push({playerObj:this.myObj});try{var m=f.sort(((t,e)=>t.playerObj.coins-e.playerObj.coins)).reverse(),y="",g=!1,v=this.mobile||this.canvas.height<550?5:10;if(m.slice(0,v).forEach(((t,e)=>{if(t.playerObj){if(!t.playerObj.hasOwnProperty("coins"))return console.log(t.playerObj);t.playerObj.id==this.myObj.id&&(g=!0);var i=t.playerObj;y+=`#${e+1}: ${i.verified?"mitblade"==i.name.toLowerCase()||"codergautam"==i.name.toLowerCase()?"[color=#FF0000]":"[color=#0000FF]":""}${i.name}${i.verified?"[/color]":""}- ${k(i.coins)}\n`}})),!g){var w=m.findIndex((t=>t.playerObj.id==this.myObj.id));y+=`...\n#${w+1}: ${this.myObj.verified?"mitblade"==this.myObj.name.toLowerCase()||"codergautam"==this.myObj.name.toLowerCase()?"[color=#FF0000]":"[color=#0000FF]":""}${this.myObj.name}${this.myObj.verified?"[/color]":""}- ${k(this.myObj.coins)}\n`}this.spectating||(this.leaderboard.setText(y),this.leaderboard.x=this.canvas.width-this.leaderboard.width-15)}catch(t){console.log(t)}try{this.spectating||this.playerCount.setText("Players: "+(Object.keys(this.enemies).length+1).toString()+(this.canvas.height<550?"":"\nFPS: "+Math.round(this.sys.game.loop.actualFps)+"\nTPS: "+this.tps+"\nPing: "+this.ping+" ms"))}catch(t){console.log(t)}if(this.myObj){this.coins.forEach((t=>{if(t.state.collected){if(t.state.collectedBy==this.myObj.id)var e=this.mePlayer.x,i=this.mePlayer.y;else try{var s=this.enemies.find((e=>e.id==t.state.collectedBy));if(!s)return t.item.destroy(),void(this.coins=this.coins.filter((e=>e.id!=t.id)));e=s.player.x,i=s.player.y}catch(t){return void console.log(t)}t.item.x=x(t.item.x,e,(6-(Math.log2(l)-Math.log2(1.875)))/10*2),t.item.y=x(t.item.y,i,(6-(Math.log2(l)-Math.log2(1.875)))/10),t.state.time+=1,n=t.item.x,r=t.item.y,o=e,a=i,(Math.hypot(o-n,a-r)<this.mePlayer.width*this.mePlayer.scale/3||t.state.time>7)&&(t.item.destroy(),this.coins=this.coins.filter((e=>e.id!=t.id)))}var n,r,o,a}));var b=this.mePlayer;this.background.setTilePosition(this.cameras.main.scrollX*this.cameras.main.zoom+(b.x-this.cameras.main.scrollX*this.cameras.main.zoom-this.canvas.width/2),this.cameras.main.scrollY*this.cameras.main.zoom+(b.y-this.cameras.main.scrollY*this.cameras.main.zoom-this.canvas.height/2)),this.background.x=b.x-this.cameras.main.displayWidth/2,this.background.y=b.y-this.cameras.main.displayHeight/2,!this.ready||this.dead||this.socket.connected||(document.write('<h1>You got disconnected</h1><br><button onclick="location.reload()"><h1>Refresh</h1></button>'),this.dead=!0)}}}function x(t,e,i){return(1-i)*t+i*e}function k(t){return t>999?parseFloat((t/1e3).toFixed(t<1e4?2:1))+"k":t}}}const un=cn;class ln extends Phaser.Scene{constructor(t){super(),this.callback=t}preload(){this.e=!0,this.background=this.add.rectangle(0,0,document.documentElement.clientWidth,document.documentElement.clientHeight,34816).setOrigin(0).setScrollFactor(0,0).setScale(2),this.loadText=this.add.text(0,0,"Loading").setOrigin(.5,.5),this.loadText.setFontSize(this.canvas.width/20),this.loadText.x=this.canvas.width/2,this.loadText.y=this.canvas.height/2,this.load.plugin("rexvirtualjoystickplugin","/joystick.js",!0),this.load.plugin("rexbbcodetextplugin","/textplus.js",!0),this.load.image("playerPlayer","/assets/images/player.png"),this.load.image("playerSword","/assets/images/sword.png"),this.load.image("codergautamytPlayer","/assets/images/codergautamytPlayer.png"),this.load.image("codergautamytSword","/assets/images/codergautamytSword.png"),this.load.image("devilPlayer","/assets/images/devilPlayer.png"),this.load.image("devilSword","/assets/images/devilSword.png"),this.load.image("winterPlayer","/assets/images/winterPlayer.png"),this.load.image("winterSword","/assets/images/winterSword.png"),this.load.image("chefPlayer","/assets/images/chefPlayer.png"),this.load.image("chefSword","/assets/images/chefSword.png"),this.load.image("medicPlayer","/assets/images/medicPlayer.png"),this.load.image("medicSword","/assets/images/medicSword.png"),this.load.image("indiaPlayer","/assets/images/indiaPlayer.png"),this.load.image("indiaSword","/assets/images/indiaSword.png"),this.load.image("shoePlayer","/assets/images/shoePlayer.png"),this.load.image("shoeSword","/assets/images/shoeSword.png"),this.load.image("foxPlayer","/assets/images/foxPlayer.png"),this.load.image("foxSword","/assets/images/devilSword.png"),this.load.image("springPlayer","/assets/images/springPlayer.png"),this.load.image("springSword","/assets/images/springSword.png"),this.load.image("scythePlayer","/assets/images/scythePlayer.png"),this.load.image("scytheSword","/assets/images/scytheSword.png"),this.load.image("neonPlayer","/assets/images/neonPlayer.png"),this.load.image("neonSword","/assets/images/neonSword.png"),this.load.image("background","/assets/images/background.jpeg"),this.load.image("coin","/assets/images/coin.png"),this.load.image("chest","/assets/images/chest.png"),this.load.image("kill","/assets/images/kill.png"),this.load.image("hitParticle","/assets/images/hitparticle.png"),this.load.image("bush","/assets/images/bush.png"),this.load.image("chatbtn","/assets/images/chat.png"),this.load.image("loginbtn","/assets/images/login.png"),this.load.image("signupbtn","/assets/images/signup.png"),this.load.image("playAgainBtn","/assets/images/playAgain.png"),this.load.image("settingsBtn","/assets/images/settingsBtn.png"),this.load.image("shopBtn","/assets/images/shop.png"),this.load.audio("coin","/assets/sound/coin.m4a"),this.load.audio("damage","/assets/sound/damage.mp3"),this.load.audio("hit","/assets/sound/hitenemy.wav"),this.load.audio("winSound","/assets/sound/win.m4a"),this.load.audio("loseSound","/assets/sound/lost.mp3"),this.load.audio("chestOpen","/assets/sound/chest.wav"),this.load.image("opening","/assets/images/opening.png"),this.load.html("title","/title.html"),this.load.html("promo","/promo.html"),this.load.html("login","/login.html"),this.load.html("shop","/shop"),this.load.html("signup","/signup.html"),this.load.html("dropdown","/dropdown.html"),this.load.html("footer","/footer.html"),this.load.html("settings","/settings.html"),this.load.html("chat","/chatbox.html"),this.load.audio("openingsound","/assets/sound/opening.mp3"),this.scale.fullscreenTarget=document.getElementById("game")}create(){this.scene.stop(),this.scene.start("title")}update(){}}const dn=ln;function pn(){navigator.onLine?document.write("<h1>You're back online! Refresh to play!</h1>"):document.write('<h1>You got disconnected</h1><br><button onclick="location.reload()"><h1>Refresh</h1></button>');try{screen.orientation.lock("landscape")}catch(t){console.log("failed to lock orientation",t)}}"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js"),window.addEventListener("online",pn),window.addEventListener("offline",pn),window.addEventListener("load",(()=>{navigator.onLine||pn();var t={type:Phaser.CANVAS,width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,parent:"game",dom:{createContainer:!0,autoCenter:Phaser.Scale.CENTER_BOTH},scale:{mode:Phaser.Scale.RESIZE}},e=window.matchMedia("(pointer: coarse)").matches,i=new Phaser.Game(t),s=new dn,n=function(t){try{var e=window.localStorage,i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return!1}}();if(n&&null===window.localStorage.getItem("lastAd")){window.localStorage.setItem("lastAd",0);var o=0}else if(n)o=Number(window.localStorage.getItem("lastAd"));else o=0;var a=3e5,h=new un((t=>{c.playPreroll=Date.now()-o>a})),c=new r(Date.now()-o>a,((t,e,i)=>{h.name=t,h.options=c.options,"auto"==h.options.server&&(h.options.server=c.optimalServer),h.openingBgm=e,h.secret=i,c.scene.start("game"),c.showPromo=!1,Date.now()-o>a&&(n?(window.localStorage.setItem("lastAd",Date.now()),o=Date.now()):o=Date.now())}));function u(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}c.mobile=e,h.mobile=e,e||(c.showPromo=!0),Object.defineProperty(c,"canvas",{get:u}),Object.defineProperty(h,"canvas",{get:u}),Object.defineProperty(s,"canvas",{get:u}),i.scene.add("title",c),i.scene.add("game",h),i.scene.add("open",s),i.scene.start("open"),document.addEventListener("contextmenu",(function(t){t.preventDefault()}))}))})()})();
//# sourceMappingURL=main.js.map
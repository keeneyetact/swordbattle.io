/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={669:(t,e,i)=>{t.exports=i(609)},448:(t,e,i)=>{"use strict";var s=i(867),n=i(26),r=i(372),o=i(327),a=i(97),h=i(109),c=i(985),u=i(61),l=i(655),d=i(263);t.exports=function(t){return new Promise((function(e,i){var p,f=t.data,m=t.headers,y=t.responseType;function g(){t.cancelToken&&t.cancelToken.unsubscribe(p),t.signal&&t.signal.removeEventListener("abort",p)}s.isFormData(f)&&delete m["Content-Type"];var v=new XMLHttpRequest;if(t.auth){var w=t.auth.username||"",x=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";m.Authorization="Basic "+btoa(w+":"+x)}var b=a(t.baseURL,t.url);function k(){if(v){var s="getAllResponseHeaders"in v?h(v.getAllResponseHeaders()):null,r={data:y&&"text"!==y&&"json"!==y?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:s,config:t,request:v};n((function(t){e(t),g()}),(function(t){i(t),g()}),r),v=null}}if(v.open(t.method.toUpperCase(),o(b,t.params,t.paramsSerializer),!0),v.timeout=t.timeout,"onloadend"in v?v.onloadend=k:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(k)},v.onabort=function(){v&&(i(u("Request aborted",t,"ECONNABORTED",v)),v=null)},v.onerror=function(){i(u("Network Error",t,null,v)),v=null},v.ontimeout=function(){var e=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded",s=t.transitional||l.transitional;t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),i(u(e,t,s.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",v)),v=null},s.isStandardBrowserEnv()){var S=(t.withCredentials||c(b))&&t.xsrfCookieName?r.read(t.xsrfCookieName):void 0;S&&(m[t.xsrfHeaderName]=S)}"setRequestHeader"in v&&s.forEach(m,(function(t,e){void 0===f&&"content-type"===e.toLowerCase()?delete m[e]:v.setRequestHeader(e,t)})),s.isUndefined(t.withCredentials)||(v.withCredentials=!!t.withCredentials),y&&"json"!==y&&(v.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&v.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&v.upload&&v.upload.addEventListener("progress",t.onUploadProgress),(t.cancelToken||t.signal)&&(p=function(t){v&&(i(!t||t&&t.type?new d("canceled"):t),v.abort(),v=null)},t.cancelToken&&t.cancelToken.subscribe(p),t.signal&&(t.signal.aborted?p():t.signal.addEventListener("abort",p))),f||(f=null),v.send(f)}))}},609:(t,e,i)=>{"use strict";var s=i(867),n=i(849),r=i(321),o=i(185),a=function t(e){var i=new r(e),a=n(r.prototype.request,i);return s.extend(a,r.prototype,i),s.extend(a,i),a.create=function(i){return t(o(e,i))},a}(i(655));a.Axios=r,a.Cancel=i(263),a.CancelToken=i(972),a.isCancel=i(502),a.VERSION=i(288).version,a.all=function(t){return Promise.all(t)},a.spread=i(713),a.isAxiosError=i(268),t.exports=a,t.exports.default=a},263:t=>{"use strict";function e(t){this.message=t}e.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},e.prototype.__CANCEL__=!0,t.exports=e},972:(t,e,i)=>{"use strict";var s=i(263);function n(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var i=this;this.promise.then((function(t){if(i._listeners){var e,s=i._listeners.length;for(e=0;e<s;e++)i._listeners[e](t);i._listeners=null}})),this.promise.then=function(t){var e,s=new Promise((function(t){i.subscribe(t),e=t})).then(t);return s.cancel=function(){i.unsubscribe(e)},s},t((function(t){i.reason||(i.reason=new s(t),e(i.reason))}))}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]},n.prototype.unsubscribe=function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}},n.source=function(){var t;return{token:new n((function(e){t=e})),cancel:t}},t.exports=n},502:t=>{"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},321:(t,e,i)=>{"use strict";var s=i(867),n=i(327),r=i(782),o=i(572),a=i(185),h=i(875),c=h.validators;function u(t){this.defaults=t,this.interceptors={request:new r,response:new r}}u.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=t.transitional;void 0!==e&&h.assertOptions(e,{silentJSONParsing:c.transitional(c.boolean),forcedJSONParsing:c.transitional(c.boolean),clarifyTimeoutError:c.transitional(c.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}));var n,r=[];if(this.interceptors.response.forEach((function(t){r.push(t.fulfilled,t.rejected)})),!s){var u=[o,void 0];for(Array.prototype.unshift.apply(u,i),u=u.concat(r),n=Promise.resolve(t);u.length;)n=n.then(u.shift(),u.shift());return n}for(var l=t;i.length;){var d=i.shift(),p=i.shift();try{l=d(l)}catch(t){p(t);break}}try{n=o(l)}catch(t){return Promise.reject(t)}for(;r.length;)n=n.then(r.shift(),r.shift());return n},u.prototype.getUri=function(t){return t=a(this.defaults,t),n(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},s.forEach(["delete","get","head","options"],(function(t){u.prototype[t]=function(e,i){return this.request(a(i||{},{method:t,url:e,data:(i||{}).data}))}})),s.forEach(["post","put","patch"],(function(t){u.prototype[t]=function(e,i,s){return this.request(a(s||{},{method:t,url:e,data:i}))}})),t.exports=u},782:(t,e,i)=>{"use strict";var s=i(867);function n(){this.handlers=[]}n.prototype.use=function(t,e,i){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1},n.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},n.prototype.forEach=function(t){s.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=n},97:(t,e,i)=>{"use strict";var s=i(793),n=i(303);t.exports=function(t,e){return t&&!s(e)?n(t,e):e}},61:(t,e,i)=>{"use strict";var s=i(481);t.exports=function(t,e,i,n,r){var o=new Error(t);return s(o,e,i,n,r)}},572:(t,e,i)=>{"use strict";var s=i(867),n=i(527),r=i(502),o=i(655),a=i(263);function h(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new a("canceled")}t.exports=function(t){return h(t),t.headers=t.headers||{},t.data=n.call(t,t.data,t.headers,t.transformRequest),t.headers=s.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),s.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||o.adapter)(t).then((function(e){return h(t),e.data=n.call(t,e.data,e.headers,t.transformResponse),e}),(function(e){return r(e)||(h(t),e&&e.response&&(e.response.data=n.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}},481:t=>{"use strict";t.exports=function(t,e,i,s,n){return t.config=e,i&&(t.code=i),t.request=s,t.response=n,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},t}},185:(t,e,i)=>{"use strict";var s=i(867);t.exports=function(t,e){e=e||{};var i={};function n(t,e){return s.isPlainObject(t)&&s.isPlainObject(e)?s.merge(t,e):s.isPlainObject(e)?s.merge({},e):s.isArray(e)?e.slice():e}function r(i){return s.isUndefined(e[i])?s.isUndefined(t[i])?void 0:n(void 0,t[i]):n(t[i],e[i])}function o(t){if(!s.isUndefined(e[t]))return n(void 0,e[t])}function a(i){return s.isUndefined(e[i])?s.isUndefined(t[i])?void 0:n(void 0,t[i]):n(void 0,e[i])}function h(i){return i in e?n(t[i],e[i]):i in t?n(void 0,t[i]):void 0}var c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:h};return s.forEach(Object.keys(t).concat(Object.keys(e)),(function(t){var e=c[t]||r,n=e(t);s.isUndefined(n)&&e!==h||(i[t]=n)})),i}},26:(t,e,i)=>{"use strict";var s=i(61);t.exports=function(t,e,i){var n=i.config.validateStatus;i.status&&n&&!n(i.status)?e(s("Request failed with status code "+i.status,i.config,null,i.request,i)):t(i)}},527:(t,e,i)=>{"use strict";var s=i(867),n=i(655);t.exports=function(t,e,i){var r=this||n;return s.forEach(i,(function(i){t=i.call(r,t,e)})),t}},655:(t,e,i)=>{"use strict";var s=i(867),n=i(16),r=i(481),o={"Content-Type":"application/x-www-form-urlencoded"};function a(t,e){!s.isUndefined(t)&&s.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var h,c={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(h=i(448)),h),transformRequest:[function(t,e){return n(e,"Accept"),n(e,"Content-Type"),s.isFormData(t)||s.isArrayBuffer(t)||s.isBuffer(t)||s.isStream(t)||s.isFile(t)||s.isBlob(t)?t:s.isArrayBufferView(t)?t.buffer:s.isURLSearchParams(t)?(a(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):s.isObject(t)||e&&"application/json"===e["Content-Type"]?(a(e,"application/json"),function(t,e,i){if(s.isString(t))try{return(0,JSON.parse)(t),s.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(0,JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||c.transitional,i=e&&e.silentJSONParsing,n=e&&e.forcedJSONParsing,o=!i&&"json"===this.responseType;if(o||n&&s.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(o){if("SyntaxError"===t.name)throw r(t,this,"E_JSON_PARSE");throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};s.forEach(["delete","get","head"],(function(t){c.headers[t]={}})),s.forEach(["post","put","patch"],(function(t){c.headers[t]=s.merge(o)})),t.exports=c},288:t=>{t.exports={version:"0.24.0"}},849:t=>{"use strict";t.exports=function(t,e){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return t.apply(e,i)}}},327:(t,e,i)=>{"use strict";var s=i(867);function n(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,i){if(!e)return t;var r;if(i)r=i(e);else if(s.isURLSearchParams(e))r=e.toString();else{var o=[];s.forEach(e,(function(t,e){null!=t&&(s.isArray(t)?e+="[]":t=[t],s.forEach(t,(function(t){s.isDate(t)?t=t.toISOString():s.isObject(t)&&(t=JSON.stringify(t)),o.push(n(e)+"="+n(t))})))})),r=o.join("&")}if(r){var a=t.indexOf("#");-1!==a&&(t=t.slice(0,a)),t+=(-1===t.indexOf("?")?"?":"&")+r}return t}},303:t=>{"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},372:(t,e,i)=>{"use strict";var s=i(867);t.exports=s.isStandardBrowserEnv()?{write:function(t,e,i,n,r,o){var a=[];a.push(t+"="+encodeURIComponent(e)),s.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),s.isString(n)&&a.push("path="+n),s.isString(r)&&a.push("domain="+r),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},793:t=>{"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},268:t=>{"use strict";t.exports=function(t){return"object"==typeof t&&!0===t.isAxiosError}},985:(t,e,i)=>{"use strict";var s=i(867);t.exports=s.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function n(t){var s=t;return e&&(i.setAttribute("href",s),s=i.href),i.setAttribute("href",s),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return t=n(window.location.href),function(e){var i=s.isString(e)?n(e):e;return i.protocol===t.protocol&&i.host===t.host}}():function(){return!0}},16:(t,e,i)=>{"use strict";var s=i(867);t.exports=function(t,e){s.forEach(t,(function(i,s){s!==e&&s.toUpperCase()===e.toUpperCase()&&(t[e]=i,delete t[s])}))}},109:(t,e,i)=>{"use strict";var s=i(867),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,i,r,o={};return t?(s.forEach(t.split("\n"),(function(t){if(r=t.indexOf(":"),e=s.trim(t.substr(0,r)).toLowerCase(),i=s.trim(t.substr(r+1)),e){if(o[e]&&n.indexOf(e)>=0)return;o[e]="set-cookie"===e?(o[e]?o[e]:[]).concat([i]):o[e]?o[e]+", "+i:i}})),o):o}},713:t=>{"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},875:(t,e,i)=>{"use strict";var s=i(288).version,n={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){n[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}}));var r={};n.transitional=function(t,e,i){function n(t,e){return"[Axios v"+s+"] Transitional option '"+t+"'"+e+(i?". "+i:"")}return function(i,s,o){if(!1===t)throw new Error(n(s," has been removed"+(e?" in "+e:"")));return e&&!r[s]&&(r[s]=!0,console.warn(n(s," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,s,o)}},t.exports={assertOptions:function(t,e,i){if("object"!=typeof t)throw new TypeError("options must be an object");for(var s=Object.keys(t),n=s.length;n-- >0;){var r=s[n],o=e[r];if(o){var a=t[r],h=void 0===a||o(a,r,t);if(!0!==h)throw new TypeError("option "+r+" must be "+h)}else if(!0!==i)throw Error("Unknown option "+r)}},validators:n}},867:(t,e,i)=>{"use strict";var s=i(849),n=Object.prototype.toString;function r(t){return"[object Array]"===n.call(t)}function o(t){return void 0===t}function a(t){return null!==t&&"object"==typeof t}function h(t){if("[object Object]"!==n.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function c(t){return"[object Function]"===n.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),r(t))for(var i=0,s=t.length;i<s;i++)e.call(null,t[i],i,t);else for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.call(null,t[n],n,t)}t.exports={isArray:r,isArrayBuffer:function(t){return"[object ArrayBuffer]"===n.call(t)},isBuffer:function(t){return null!==t&&!o(t)&&null!==t.constructor&&!o(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:a,isPlainObject:h,isUndefined:o,isDate:function(t){return"[object Date]"===n.call(t)},isFile:function(t){return"[object File]"===n.call(t)},isBlob:function(t){return"[object Blob]"===n.call(t)},isFunction:c,isStream:function(t){return a(t)&&c(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function t(){var e={};function i(i,s){h(e[s])&&h(i)?e[s]=t(e[s],i):h(i)?e[s]=t({},i):r(i)?e[s]=i.slice():e[s]=i}for(var s=0,n=arguments.length;s<n;s++)u(arguments[s],i);return e},extend:function(t,e,i){return u(e,(function(e,n){t[n]=i&&"function"==typeof e?s(e,i):e})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";class t extends Phaser.GameObjects.Container{constructor(t,e,i,s,n){super(t),this.scene=t,this.x=e,this.y=i,this.btn=t.add.image(e,i,s).setOrigin(0),this.btn.setInteractive().on("pointerdown",n)}get width(){return this.btn.width}get height(){return this.btn.height}update(t,e){t&&(this.x=t,this.btn.x=t),e&&(this.y=e,this.btn.y=e)}destroy(){this.btn.destroy()}}var e=i(669),s=i.n(e);const n=JSON.parse('{"i":"6LdVxgYdAAAAAPtvjrXLAzSd2ANyzIkiSqk_yFpt","c":false}');class r extends Phaser.Scene{constructor(t,e){super(),this.playPreroll=t,this.callback=e}preload(){try{document.getElementsByClassName("grecaptcha-badge")[0].style.opacity=100}catch(t){console.log("captcha hasnt loaded yet")}}create(){this.optimalServer="us2";const e=(t=!0)=>{var e={us1:"https://us2.swordbattle.io",us2:"https://sword-io-game.herokuapp.com",eu1:"https://swordbattle.herokuapp.com"},i=t=>new Promise(((i,s)=>{var n=Date.now(),r={error:!1,ping:0,info:{}};fetch(e[t]+"/api/serverinfo?t="+Date.now()).then((t=>{200==t.status?(r.ping=Date.now()-n,t.json().then((t=>{r.info=t,i(r)})).catch((t=>{r.error=!0,i(r)}))):(r.error=!0,i(r))})).catch((t=>{r.error=!0,i(r)}))})),s=[],n=["us1","us2","eu1"],r=["USA","USA 2","Europe"];i("us1").then((e=>{s.push(e),i("us2").then((e=>{s.push(e),i("eu1").then((e=>{if(s.push(e),s.filter((t=>t.error)).length==s.length)alert("Could not find an available server. Please try again later.");else{var i=s.map((t=>2*t.ping-(t.info.actualPlayercount?30*t.info.actualPlayercount:0)+("No lag"==t.info.lag?0:"Moderate lag"==t.info.lag?250:1e3)+(t.info.playerCount>15?100*Math.abs(15-t.info.playerCount):0))).map((t=>t||1/0)),o=n[i.indexOf(Math.min(...i))];console.log("optimal server found: "+o+" with score: "+Math.min(...i)),this.optimalServer=o,console.log(t),t&&(n.forEach(((t,e)=>{document.getElementById(t).innerHTML=r[e]+(s[e].error?" (OFFLINE)":` (${s[e].ping}ms, ${s[e].info.playerCount} players)`)})),document.getElementById("auto").innerHTML="Auto ("+r[i.indexOf(Math.min(...i))]+")")}}))}))}))};var i=(t,e,i)=>t<e?e:t>i?i:t;this.footerdone=!1,this.redirect=!1;var r=!0;try{window.localStorage}catch(t){r=!1}r?window.localStorage.getItem("options")?this.options=JSON.parse(window.localStorage.getItem("options")):(this.options={movementMode:"mouse",sound:"normal",server:"auto"},window.localStorage.setItem("options",JSON.stringify(this.options))):this.options={movementMode:"mouse",sound:"normal",server:"auto"};try{this.music=this.sound.add("openingsound",{mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!0,delay:0}),this.music.play()}catch(t){return}this.background=this.add.image(0,0,"opening").setOrigin(0).setScrollFactor(0,0).setScale(2),this.footer=this.add.dom(this.canvas.width/2,this.canvas.height).createFromCache("footer").setOrigin(.5).setScale(this.mobile?1:2),this.nameBox=this.add.dom(this.canvas.width/2,0).createFromCache("title"),this.showPromo&&(this.promo=this.add.dom(0,0).createFromCache("promo"),this.promo.x=this.canvas.width/2,this.promo.y=this.canvas.height/2,this.promo.getChildByName("close").onclick=()=>{this.promo.destroy()},e(!1)),this.nameBox.getChildByName("name").value=r&&window.localStorage.getItem("oldName")?window.localStorage.getItem("oldName"):"",this.done=!1,this.text=this.add.text(this.canvas.width/2,0,"Swordbattle.io",{fontSize:"64px",fill:"#000000"}).setOrigin(.5),"normal"==this.options.sound?this.music.volume=.5:"high"==this.options.sound?this.music.volume=1:"low"==this.options.sound?this.music.volume=.2:"off"==this.options.sound?this.music.volume=0:(this.options.sound="normal",this.music.volume=.5,r&&window.localStorage.setItem("options",JSON.stringify(this.options))),this.options.hasOwnProperty("server")||(this.options.server="auto",r&&window.localStorage.setItem("options",JSON.stringify(this.options))),this.settingsBtn=new t(this,0,0,"settingsBtn",(()=>{if(!(this.promo&&this.promo.visible||this.login&&this.login.visible||this.signup&&this.signup.visible)){if(this.settings&&this.settings.visible)return this.settings.destroy();this.settings=this.add.dom(0,0).createFromCache("settings"),this.settings.x=this.canvas.width/2,this.settings.y=this.canvas.height/2,this.settings.getChildByName("close").onclick=()=>{this.settings.destroy()},document.getElementById("movement").value=this.options.movementMode,document.getElementById("sound").value=this.options.sound,document.getElementById("server").value=this.options.server,e(),document.getElementById("movement").onchange=()=>{this.options.movementMode=document.getElementById("movement").value,r&&window.localStorage.setItem("options",JSON.stringify(this.options))},document.getElementById("sound").onchange=()=>{this.options.sound=document.getElementById("sound").value,r&&window.localStorage.setItem("options",JSON.stringify(this.options)),"normal"==this.options.sound?this.music.volume=.6:"high"==this.options.sound?this.music.volume=1.2:"low"==this.options.sound?this.music.volume=.2:"off"==this.options.sound&&(this.music.volume=0)},document.getElementById("server").onchange=()=>{this.options.server=document.getElementById("server").value,r&&window.localStorage.setItem("options",JSON.stringify(this.options))}}}));const o=()=>{let t=this.nameBox.getChildByName("name");if(t&&""!=t.value&&!this.done){this.done=!0,r&&window.localStorage.setItem("oldName",t.value);var e=t.value;this.playPreroll&&void 0!==aiptag.adplayer?(this.nameBox.getChildByName("btn").innerHTML="Connecting..",this.nameBox.getChildByName("btn").style.backgroundColor="grey",this.music.stop(),aiptag.cmd.player.push((()=>{aiptag.adplayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!0,AD_CENTERPLAYER:!1,LOADING_TEXT:"loading advertisement",PREROLL_ELEM:function(){return document.getElementById("preroll")},AIP_COMPLETE:t=>{this.nameBox.destroy(),document.getElementById("game").focus(),this.callback(e,this.music,this.secret),console.log("Preroll Ad Completed: "+t)}})})),aiptag.cmd.player.push((()=>{aiptag.adplayer.startPreRoll()}))):(this.nameBox.destroy(),this.callback(e,this.music,this.secret))}};var a=()=>{this.promo&&this.promo.visible?this.promo.destroy():this.login&&this.login.visible?this.login.getChildByName("login").click():this.signup&&this.signup.visible?this.signup.getChildByName("signup").click():this.nameBox.getChildByName("btn").disabled||(this.settings&&this.settings.visible?this.settings.destroy():o())};this.nameBox.getChildByName("btn").onclick=()=>{a()},this.returnKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER,!1),this.returnKey.on("down",(t=>{a()}));var h=!1;this.secret=void 0;const c=t=>{this.nameBox.getChildByName("btn").innerHTML="Connecting..",this.nameBox.getChildByName("btn").disabled=!0,console.log("Attempting to login"),grecaptcha.ready((()=>{grecaptcha.execute(n.i,{action:"relogin"}).then((e=>{s().post("/api/loginsecret",{secret:t,captcha:e}).then((e=>{if(e.data.error){alert("Login Error: "+e.data.error);try{window.localStorage.getItem("secret")&&window.localStorage.removeItem("secret")}catch(t){}return l(),void console.log(e)}try{window.localStorage.setItem("secret",t)}catch(t){console.log("Failed to save secret"),console.log(t)}h=!0,this.secret=t,console.log("Logged in"),this.loginButton&&this.loginButton.destroy(),this.signupButton&&this.signupButton.destroy(),this.nameBox&&this.nameBox.visible&&(this.nameBox.getChildByName("name").value=e.data.username,this.nameBox.getChildByName("name").disabled=!0,this.nameBox.getChildByName("name").classList.add("loggedin"),this.nameBox.getChildByName("btn").innerHTML="Play!",this.nameBox.getChildByName("btn").disabled=!1,this.accountData=e.data,u())})).catch((t=>{console.log("Login Error: "),console.log(t),alert("Failed to login automatically.");try{window.localStorage.getItem("secret")&&window.localStorage.removeItem("secret")}catch(t){}l(),console.log(res)}))}))}))};var u=()=>{this.dropdown=this.add.dom(0,0).createFromCache("dropdown").setOrigin(0),document.getElementById("username").innerHTML=this.accountData.username,document.getElementById("profile").setAttribute("onclick",`location.href='/${this.accountData.username}'`),this.nameBox.getChildByName("name").classList.add("loggedin"),this.nameBox.getChildByName("name").disabled=!0,document.getElementById("username").style.fontSize="30px",this.dropdown.x=this.canvas.width/1.2-document.getElementById("username").getBoundingClientRect().width,this.dropdown.y=-20,document.getElementById("logout").onclick=()=>{this.dropdown.destroy();try{window.localStorage.removeItem("secret")}catch(t){console.log("failed to clear local storage")}this.secret=void 0,this.accountData=void 0,h=!1,this.nameBox.getChildByName("name").disabled=!1,this.nameBox.getChildByName("name").classList.remove("loggedin"),this.nameBox.getChildByName("name").value="";try{window.localStorage.removeItem("oldName")}catch(t){console.log("failed to clear local storage oldname")}l(),p()}};this.shopBtn=new t(this,10,10,"shopBtn",(()=>{document.getElementById("shopFrame").contentWindow.location.replace("/shop?secret="+this.secret),document.getElementById("shopFrame").onload=()=>{var t=document.getElementById("shopFrame").contentWindow.document;document.getElementById("shopFrame").style.display="",t.getElementById("closeShop").onclick=()=>{document.getElementById("shopFrame").style.display="none"}}})),this.shopBtn.btn.setScale(this.canvas.width/6e3),this.shopBtn.btn.setScale(4*this.shopBtn.btn.scale);var l=()=>{h||(this.loginButton=new t(this,this.canvas.width-(this.canvas.width>610?300:100),0,"loginbtn",(()=>{this.promo&&this.promo.visible||this.signup&&this.signup.visible||this.settings&&this.settings.visible||this.login&&this.login.visible||(this.login=this.add.dom(0,0).createFromCache("login"),this.login.x=this.canvas.width/2,this.login.y=this.canvas.height/2,this.login.getChildByName("close").onclick=()=>{this.login.destroy()},this.login.getChildByName("login").onclick=()=>{grecaptcha.ready((()=>{grecaptcha.execute(n.i,{action:"login"}).then((t=>{try{var e=this.login.getChildByName("username").value,i=this.login.getChildByName("password").value;if(""==e.trim()||""==i)return;this.login.getChildByName("login").innerHTML="Logging in..",this.login.getChildByName("login").disabled=!0,this.login.getChildByName("close").disabled=!0,s().post("/api/login",{username:e,password:i,captcha:t}).then((t=>{if(t.data.error)alert(t.data.error),this.login.getChildByName("login").disabled=!1,this.login.getChildByName("close").disabled=!1,this.login.getChildByName("login").innerHTML="Login";else{this.login.getChildByName("login").disabled=!1,this.login.getChildByName("close").disabled=!1,this.login.getChildByName("login").innerHTML="Login",this.login.destroy();try{c(t.data.secret)}catch(t){console.log("Failed to login"),console.log(t)}}})).catch((t=>{alert("Unexpected error, please try again later"),console.log(t),this.login.getChildByName("login").disabled=!1,this.login.getChildByName("close").disabled=!1,this.login.getChildByName("login").innerHTML="Login"}))}catch(t){console.log(t)}}))}))})})),this.signupButton=new t(this,this.canvas.width-(this.canvas.width>610?300:100),0,"signupbtn",(()=>{this.promo&&this.promo.visible||this.signup&&this.signup.visible||this.settings&&this.settings.visible||this.login&&this.login.visible||(this.signup=this.add.dom(0,0).createFromCache("signup"),this.signup.x=this.canvas.width/2,this.signup.y=this.canvas.height/2,this.signup.getChildByName("close").onclick=()=>{this.signup.destroy()},this.signup.getChildByName("signup").onclick=()=>{grecaptcha.ready((()=>{grecaptcha.execute(n.i,{action:"signup"}).then((t=>{try{var e=this.signup.getChildByName("username").value,i=this.signup.getChildByName("password").value,n=this.signup.getChildByName("email").value;if(""==e.trim()||""==i)return;this.signup.getChildByName("signup").innerHTML="Signing up..",this.signup.getChildByName("signup").disabled=!0,this.signup.getChildByName("close").disabled=!0,s().post("/api/signup",{username:e,password:i,email:n,captcha:t}).then((t=>{if(t.data.error)alert(t.data.error),this.signup.getChildByName("signup").disabled=!1,this.signup.getChildByName("close").disabled=!1,this.signup.getChildByName("signup").innerHTML="Sign Up";else{this.signup.getChildByName("signup").disabled=!1,this.signup.getChildByName("close").disabled=!1,this.signup.getChildByName("signup").innerHTML="Sign Up",this.signup.destroy();try{c(t.data.secret)}catch(t){console.log("Failed to login"),console.log(t)}}})).catch((t=>{alert("Unexpected error, please try again later"),console.log(t),this.login.getChildByName("login").disabled=!1,this.login.getChildByName("close").disabled=!1,this.login.getChildByName("login").innerHTML="Login"}))}catch(t){console.log(t)}}))}))})})),this.loginButton.btn.setScale(.25),this.signupButton.btn.setScale(.25))};try{var d=window.localStorage.getItem("secret");d&&!this.accountData?c(d):d&&this.accountData?(this.secret=this.accountData.secret,u()):l()}catch(t){console.log("failed to autologin"),console.log(t)}const p=(t=!1)=>{this.game.scale.resize(this.canvas.width,this.canvas.height);try{const t=this.cameras.main.width,e=this.cameras.main.height;this.shopBtn.btn.setScale(i(this.canvas.width/6e3,.05,.2)),this.shopBtn.btn.setScale(4*this.shopBtn.btn.scale),this.background.setScale(Math.max(t/this.background.width,e/this.background.height)),this.background.x=0-(this.background.displayWidth-t)/2}catch(t){}this.nameBox.x=this.canvas.width/2,this.text.x=this.canvas.width/2,this.settingsBtn.btn.setScale(i(this.canvas.width/1e4,.08,.4)),this.settingsBtn.btn.y=this.canvas.height-this.settingsBtn.btn.displayHeight,this.settings&&this.settings.visible&&(this.settings.x=this.canvas.width/2,this.settings.y=this.canvas.height/2);var e=.17;this.canvas.width<950&&(e-=.035),this.canvas.width<870&&(e-=.025),this.canvas.width<750&&(e-=.015),this.canvas.width<610&&(e-=.015),this.canvas.width<500&&(e-=.0035),this.loginButton&&this.loginButton.btn.setScale(e),this.signupButton&&this.signupButton.btn.setScale(e),this.loginButton&&this.loginButton.update(this.canvas.width-this.loginButton.btn.displayWidth,0),this.signupButton&&this.signupButton.update(this.canvas.width-this.signupButton.btn.displayWidth,this.loginButton.btn.displayHeight+10),this.dropdown&&this.dropdown.visible&&(this.dropdown.x=this.canvas.width/1.2-document.getElementById("username").getBoundingClientRect().width),this.scene.isActive("title")&&(this.promo&&this.promo.visible||this.signup&&this.signup.visible||this.login&&this.login.visible||this.settings&&this.settings.visible||(this.footer.destroy(),this.footer=this.add.dom(this.canvas.width/2,this.canvas.height).createFromCache("footer").setOrigin(.5).setScale(this.mobile?1:2)));var s=this.canvas.height-this.footer.height;this.canvas.height<384&&(s=this.canvas.height-this.footer.height/2),this.footerdone&&(this.text.y=this.canvas.height/4),this.footerdone&&(this.footer.y=s);try{this.text.setFontSize(this.canvas.width/13)}catch(t){}this.footer.x=this.canvas.width/2,this.promo&&this.promo.visible&&(this.promo.x=this.canvas.width/2,this.promo.y=this.canvas.height/2),this.login&&this.login.visible&&(this.login.x=this.canvas.width/2,this.login.y=this.canvas.height/2),this.signup&&this.signup.visible&&(this.signup.x=this.canvas.width/2,this.signup.y=this.canvas.height/2)};var f;window.addEventListener("resize",(function(){clearTimeout(f),f=setTimeout(p,100)})),p(!0);var m=this.canvas.height-this.footer.height;this.canvas.height<384&&(m=this.canvas.height-this.footer.height/2),this.tweens.add({targets:this.footer,y:m,onComplete:()=>{this.footerdone=!0},duration:1e3,ease:"Power2"}),this.tweens.add({targets:this.text,y:this.canvas.height/4,duration:1e3,ease:"Power2"})}update(t){this.nameBox.y=this.mobile?this.text.y+this.text.height/2:this.text.y+this.text.height;var e=this.canvas.height-this.footer.height;this.canvas.height<384&&(e=this.canvas.height-this.footer.height/2),this.footerdone&&this.footer.y!=e&&(this.footer.y=e)}}const o=r,a=class{constructor(t,e,i,s,n,r=!1){this.custom=r,this.bar=new Phaser.GameObjects.Graphics(t).setDepth(99),this.x=e,this.y=i,this.maxValue=100,this.value=0,this.toLerp=0,this.height=n,this.width=s,t.add.existing(this.bar)}setHealth(t){var e,i;return this.value=(e=t,0,i=this.maxValue,Math.min(Math.max(e,0),i)),this.draw(),0===this.value}setLerpValue(t){this.toLerp=t}draw(){this.bar.clear(),this.bar.fillStyle(0),this.bar.fillRect(this.x,this.y,this.width,this.height),this.bar.fillStyle(16777215),this.bar.fillRect(this.x+2,this.y+2,this.width-4,this.height-4),this.custom?this.bar.fillStyle(65535):this.value/this.maxValue<.3?this.bar.fillStyle(16711680):this.value/this.maxValue<.5?this.bar.fillStyle(16776960):this.bar.fillStyle(65280);var t=Math.floor((this.width-4)*(this.value/this.maxValue));this.bar.fillRect(this.x+2,this.y+2,t,this.height-4)}update(){this.setHealth((1-.25)*this.value+.25*this.toLerp)}destroy(){this.bar.destroy()}};function h(t,e){for(var i=e.length,s=new Array(i+1),n=0;n<i;++n)s[n]=e[n];return s[i]=t,s}function c(t,e,i){for(var s=e,n=0,r=i.length;n<r;++n)s=t(s,i[n],n);return s}function u(t,e){for(var i=e.length,s=new Array(i),n=0,r=void 0,o=0;o<i;++o)t(r=e[o])||(s[n]=r,++n);return s.length=n,s}function l(t,e){for(var i=0,s=e.length;i<s;++i)if(t===e[i])return i;return-1}var d=function(t){return t},p=function(t,e){return t(e)};function f(t){return function e(i,s){switch(arguments.length){case 0:return e;case 1:return function(e){return t(i,e)};default:return t(i,s)}}}function m(t){return function e(i,s,n){switch(arguments.length){case 0:return e;case 1:return f((function(e,s){return t(i,e,s)}));case 2:return function(e){return t(i,s,e)};default:return t(i,s,n)}}}var y=function(){function t(t,e,i,s,n){this.time=t,this.localOffset=e,this.period=i,this.task=s,this.scheduler=n,this.active=!0}return t.prototype.run=function(){return this.task.run(this.time-this.localOffset)},t.prototype.error=function(t){return this.task.error(this.time-this.localOffset,t)},t.prototype.dispose=function(){return this.active=!1,this.scheduler.cancel(this),this.task.dispose()},t}(),g=function(){function t(t,e){this.origin=t,this.scheduler=e}return t.prototype.currentTime=function(){return this.scheduler.currentTime()-this.origin},t.prototype.scheduleTask=function(t,e,i,s){return this.scheduler.scheduleTask(t+this.origin,e,i,s)},t.prototype.relative=function(e){return new t(e+this.origin,this.scheduler)},t.prototype.cancel=function(t){return this.scheduler.cancel(t)},t.prototype.cancelAll=function(t){return this.scheduler.cancelAll(t)},t}();function v(t){try{return t.run()}catch(e){return t.error(e)}}var w=function(){function t(t,e){var i=this;this._runReadyTasksBound=function(){return i._runReadyTasks()},this.timer=t,this.timeline=e,this._timer=null,this._nextArrival=1/0}return t.prototype.currentTime=function(){return this.timer.now()},t.prototype.scheduleTask=function(t,e,i,s){var n=this.currentTime()+Math.max(0,e),r=new y(n,t,i,s,this);return this.timeline.add(r),this._scheduleNextRun(),r},t.prototype.relative=function(t){return new g(t,this)},t.prototype.cancel=function(t){t.active=!1,this.timeline.remove(t)&&this._reschedule()},t.prototype.cancelAll=function(t){this.timeline.removeAll(t),this._reschedule()},t.prototype._reschedule=function(){this.timeline.isEmpty()?this._unschedule():this._scheduleNextRun()},t.prototype._unschedule=function(){this.timer.clearTimer(this._timer),this._timer=null},t.prototype._scheduleNextRun=function(){if(!this.timeline.isEmpty()){var t=this.timeline.nextArrival();null===this._timer?this._scheduleNextArrival(t):t<this._nextArrival&&(this._unschedule(),this._scheduleNextArrival(t))}},t.prototype._scheduleNextArrival=function(t){this._nextArrival=t;var e=Math.max(0,t-this.currentTime());this._timer=this.timer.setTimer(this._runReadyTasksBound,e)},t.prototype._runReadyTasks=function(){this._timer=null,this.timeline.runTasks(this.currentTime(),v),this._scheduleNextRun()},t}(),x=function(){function t(){this.tasks=[]}return t.prototype.nextArrival=function(){return this.isEmpty()?1/0:this.tasks[0].time},t.prototype.isEmpty=function(){return 0===this.tasks.length},t.prototype.add=function(t){k(t,this.tasks)},t.prototype.remove=function(t){var e=B(S(t),this.tasks);if(e>=0&&e<this.tasks.length){var i=this.tasks[e].events,s=l(t,i);if(s>=0)return i.splice(s,1),0===i.length&&this.tasks.splice(e,1),!0}return!1},t.prototype.removeAll=function(t){for(var e=0;e<this.tasks.length;++e)T(t,this.tasks[e])},t.prototype.runTasks=function(t,e){for(var i=this.tasks,s=i.length,n=0;n<s&&i[n].time<=t;)++n;this.tasks=i.slice(n);for(var r=0;r<n;++r)this.tasks=b(e,i[r].events,this.tasks)},t}();function b(t,e,i){for(var s=0;s<e.length;++s){var n=e[s];n.active&&(t(n),n.period>=0&&n.active&&(n.time=n.time+n.period,k(n,i)))}return i}function k(t,e){var i=e.length,s=S(t);if(0!==i){var n=B(s,e);n>=i?e.push(A(s,[t])):function(t,e,i,s){var n=e[s];i===n.time?function(t,e){0===e.length||t.time>=e[e.length-1].time?e.push(t):function(t,e){for(var i=0;i<e.length;i++)if(t.time<e[i].time){e.splice(i,0,t);break}}(t,e)}(t,n.events):e.splice(s,0,A(i,[t]))}(t,e,s,n)}else e.push(A(s,[t]))}function S(t){return Math.floor(t.time)}function T(t,e){e.events=u(t,e.events)}function B(t,e){for(var i,s,n=0,r=e.length;n<r;){if(t===(s=e[i=Math.floor((n+r)/2)]).time)return i;t<s.time?r=i:n=i+1}return r}var A=function(t,e){return{time:t,events:e}},C=function(){function t(t){this._clock=t}return t.prototype.now=function(){return this._clock.now()},t.prototype.setTimer=function(t,e){return e<=0?function(t){var e=new O(t);return function(t){Promise.resolve(t).then(v)}(e),e}(t):setTimeout(t,e)},t.prototype.clearTimer=function(t){return t instanceof O?t.cancel():clearTimeout(t)},t}(),O=function(){function t(t){this.f=t,this.active=!0}return t.prototype.run=function(){if(this.active)return this.f()},t.prototype.error=function(t){throw t},t.prototype.cancel=function(){this.active=!1},t}(),E=function(){function t(t,e){this.origin=e,this.clock=t}return t.prototype.now=function(){return this.clock.now()-this.origin},t}(),P=function(){function t(t,e){this.origin=e,this.hrtime=t}return t.prototype.now=function(){var t=this.hrtime(this.origin);return(1e9*t[0]+t[1])/1e6},t}(),j=function(t){return new E(t,t.now())},M=function(t){return t.currentTime()},_=f((function(t,e){return e.scheduleTask(0,0,-1,t)})),N=m((function(t,e,i){return i.scheduleTask(0,t,-1,e)})),D=(m((function(t,e,i){return i.scheduleTask(0,0,t,e)})),function(t){return t.dispose()}),F=(f((function(t,e){return console.warn("DEPRECATED cancelAllTasks to be removed in 2.0.0"),e.cancelAll(t)})),f((function(t,e){return new g(t,e)}))),I=(f((function(t,e){return new w(t,e)})),function(){return new w(R(),new x)}),R=function(){return new C("undefined"!=typeof performance&&"function"==typeof performance.now?j(performance):"undefined"!=typeof process&&"function"==typeof process.hrtime?new P(process.hrtime,process.hrtime()):j(Date))},L=function(){return H},H=new(function(){function t(){}return t.prototype.dispose=function(){},t}()),z=function(t){return new U(t)},U=function(){function t(t){this.disposed=!1,this.disposable=t}return t.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposable&&(this.disposable.dispose(),this.disposable=void 0))},t}(),q=(f((function(t,e){return z(new q(t,e))})),function(){function t(t,e){this._dispose=t,this._resource=e}return t.prototype.dispose=function(){this._dispose(this._resource)},t}()),G=function(t){var e=c(W,[],t);return 0===e.length?L():new K(e)},V=f((function(t,e){return G([t,e])})),W=function(t,e){return function(t){return t===H}(e)?t:e instanceof K?function(t,e){var i=t.length,s=e.length,n=new Array(i+s),r=0;for(r=0;r<i;r++)n[r]=t[r];for(var o=0;o<s;o++)n[r++]=e[o];return n}(t,e.disposables):h(e,t)},K=function(){function t(t){this.disposables=t}return t.prototype.dispose=function(){Y(J(this.disposables))},t}(),J=function(t){return c($,[],t)},$=function(t,e){try{e.dispose()}catch(e){t.push(e)}return t},Y=function(t){if(t.length>0)throw new X(t.length+" errors",t)},X=function t(e,i){this.name="DisposeAllError",this.message=e,this.errors=i,Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,t),this.stack=""+this.stack+Z(this.errors)};X.prototype=Object.create(Error.prototype);var Z=function(t){return c(Q,"",t)},Q=function(t,e,i){return t+"\n["+(i+1)+"] "+e.stack},tt=m((function(t,e,i){try{e.dispose()}catch(e){i.error(t,e)}})),et=function(t,e){return et=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},et(t,e)};function it(t,e){function i(){this.constructor=t}et(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function st(t){setTimeout(nt,0,t)}function nt(t){throw t}var rt=function(t,e,i){return new ut(t,e,i)},ot=function(t,e){return new lt(t,e)},at=function(t){return new dt(t)},ht=function(t,e){return new pt(t,e)},ct=function(){function t(t){this.sink=t,this.active=!0}return t.prototype.dispose=function(){this.active=!1},t.prototype.run=function(t){this.active&&this.runIfActive(t)},t.prototype.error=function(t,e){if(!this.active)return st(e);this.sink.error(t,e)},t}(),ut=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.runEvent=e,n.value=i,n}return it(e,t),e.prototype.runIfActive=function(t){this.runEvent(t,this.value,this.sink)},e}(ct),lt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.value=e,s}return it(e,t),e.prototype.runIfActive=function(t){this.sink.event(t,this.value)},e}(ct),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return it(e,t),e.prototype.runIfActive=function(t){this.sink.end(t)},e}(ct),pt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.value=e,s}return it(e,t),e.prototype.runIfActive=function(t){this.sink.error(t,this.value)},e}(ct),ft=function(){return gt},mt=function(t){return t===gt},yt=function(t){return t.some(mt)},gt=new(function(){function t(){}return t.prototype.run=function(t,e){return _(at(t),e)},t}()),vt=(new(function(){function t(){}return t.prototype.run=function(){return L()},t}()),function(t,e){return new wt(t,e)}),wt=function(){function t(t,e){this.time=t,this.value=e}return t.prototype.run=function(t,e){return N(this.time,rt(xt,this.value,t),e)},t}();function xt(t,e,i){i.event(t,e),i.end(t)}var bt=function(t){return vt(0,t)},kt=function(){function t(){this.disposable=void 0,this.disposed=!1}return t.prototype.setDisposable=function(t){if(void 0!==this.disposable)throw new Error("setDisposable called more than once");this.disposable=t,this.disposed&&t.dispose()},t.prototype.dispose=function(){this.disposed||(this.disposed=!0,void 0!==this.disposable&&this.disposable.dispose())},t}(),St=f((function(t,e){return new Promise((function(i,s){return function(t,e,i,s){var n=new kt,r=new Tt(i,s,n);n.setDisposable(t.run(r,e))}(t,e,i,s)}))})),Tt=function(){function t(t,e,i){this._end=t,this._error=e,this._disposable=i,this.active=!0}return t.prototype.event=function(){},t.prototype.end=function(){this.active&&this.dispose(this._error,this._end,void 0)},t.prototype.error=function(t,e){this.dispose(this._error,this._error,e)},t.prototype.dispose=function(t,e,i){this.active=!1,function(t,e,i,s){try{s.dispose()}catch(e){return void t(e)}e(i)}(t,e,i,this._disposable)},t}(),Bt=function(t,e,i){return i.run(t,e)},At=function(){function t(t,e){this.sink=e,this.offset=t}return t.prototype.event=function(t,e){this.sink.event(t+this.offset,e)},t.prototype.error=function(t,e){this.sink.error(t+this.offset,e)},t.prototype.end=function(t){this.sink.end(t+this.offset)},t}(),Ct=function(t,e){return new Ot(t,e)},Ot=function(){function t(t,e){this.origin=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(Et(this.origin,t),F(this.origin,e))},t}(),Et=function(t,e){return e instanceof At?new At(t+e.offset,e.sink):new At(t,e)},Pt=function(){function t(t){this.sink=t}return t.prototype.end=function(t){return this.sink.end(t)},t.prototype.error=function(t,e){return this.sink.error(t,e)},t}(),jt=function(){function t(t,e,i){this.step=t,this.seed=e,this.source=i}return t.prototype.run=function(t,e){return this.source.run(new Mt(this.step,this.seed,t),e)},t}(),Mt=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.step=e,n.seed=i,n}return it(e,t),e.prototype.event=function(t,e){var i=this.step(this.seed,e);this.seed=i.seed,this.sink.event(t,i.value)},e}(Pt),_t=function(){function t(t,e,i){this.source=i,this.f=t,this.value=e}return t.prototype.run=function(t,e){var i=_(ot(this.value,t),e),s=this.source.run(new Nt(this.f,this.value,t),e);return V(i,s)},t}(),Nt=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.f=e,n.value=i,n}return it(e,t),e.prototype.event=function(t,e){var i=this.f;this.value=i(this.value,e),this.sink.event(t,this.value)},e}(Pt),Dt=function(t,e){return new Ft(t,e)},Ft=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return new It(this.f,this.source,t,e)},t}(),It=function(t){function e(e,i,s,n){var r=t.call(this,s)||this;return r.f=e,r.scheduler=n,r.active=!0,r.disposable=z(i.run(r,n)),r}return it(e,t),e.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},e.prototype.end=function(t){this.active&&(tt(t,this.disposable,this.sink),this.startNext(t,this.sink))},e.prototype.startNext=function(t,e){try{this.disposable=this.continue(this.f,t,e)}catch(i){e.error(t,i)}},e.prototype.continue=function(t,e,i){return Bt(i,this.scheduler,Ct(e,t()))},e.prototype.dispose=function(){return this.active=!1,this.disposable.dispose()},e}(Pt),Rt=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new Lt(this.p,t),e)},t.create=function(e,i){return mt(i)?i:i instanceof t?new t(Ht(i.p,e),i.source):new t(e,i)},t}(),Lt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.p=e,s}return it(e,t),e.prototype.event=function(t,e){(0,this.p)(e)&&this.sink.event(t,e)},e}(Pt),Ht=function(t,e){return function(i){return t(i)&&e(i)}},zt=function(){function t(t,e,i){this.p=t,this.f=e,this.source=i}return t.prototype.run=function(t,e){return this.source.run(new Ut(this.p,this.f,t),e)},t}(),Ut=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.p=e,n.f=i,n}return it(e,t),e.prototype.event=function(t,e){var i=this.f;(0,this.p)(e)&&this.sink.event(t,i(e))},e}(Pt),qt=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new Gt(this.f,t),e)},t.create=function(e,i){return mt(i)?ft():i instanceof t?new t(function(t,e){return function(i){return t(e(i))}}(e,i.f),i.source):i instanceof Rt?new zt(i.p,e,i.source):new t(e,i)},t}(),Gt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.f=e,s}return it(e,t),e.prototype.event=function(t,e){var i=this.f;this.sink.event(t,i(e))},e}(Pt),Vt=function(t,e){return qt.create(t,e)},Wt=function(){function t(t,e){this.source=e,this.f=t}return t.prototype.run=function(t,e){return this.source.run(new Kt(this.f,t),e)},t}(),Kt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.f=e,s}return it(e,t),e.prototype.event=function(t,e){(0,this.f)(e),this.sink.event(t,e)},e}(Pt),Jt=function(t){function e(e,i){var s=t.call(this,i)||this;return s.index=e,s.active=!0,s.value=void 0,s}return it(e,t),e.prototype.event=function(t,e){this.active&&(this.value=e,this.sink.event(t,this))},e.prototype.end=function(t){this.active&&(this.active=!1,this.sink.event(t,this))},e}(Pt);function $t(t,e){switch(e.length){case 0:return t();case 1:return t(e[0]);case 2:return t(e[0],e[1]);case 3:return t(e[0],e[1],e[2]);case 4:return t(e[0],e[1],e[2],e[3]);case 5:return t(e[0],e[1],e[2],e[3],e[4]);default:return t.apply(void 0,e)}}var Yt=function(t,e,i){return Xt(t,[e,i])},Xt=function(t,e){return 0===e.length||yt(e)?ft():1===e.length?Vt(t,e[0]):new Zt(t,e)},Zt=function(){function t(t,e){this.f=t,this.sources=e}return t.prototype.run=function(t,e){for(var i=this.sources.length,s=new Array(i),n=new Array(i),r=new Qt(s,n.length,t,this.f),o=void 0,a=0;a<i;++a)o=n[a]=new Jt(a,r),s[a]=this.sources[a].run(o,e);return G(s)},t}(),Qt=function(t){function e(e,i,s,n){var r=t.call(this,s)||this;return r.disposables=e,r.f=n,r.awaiting=i,r.values=new Array(i),r.hasValue=new Array(i).fill(!1),r.activeCount=i,r}return it(e,t),e.prototype.event=function(t,e){if(e.active){var i=e.index,s=this.updateReady(i);this.values[i]=e.value,0===s&&this.sink.event(t,$t(this.f,this.values))}else this.dispose(t,e.index)},e.prototype.updateReady=function(t){return this.awaiting>0&&(this.hasValue[t]||(this.hasValue[t]=!0,this.awaiting-=1)),this.awaiting},e.prototype.dispose=function(t,e){tt(t,this.disposables[e],this.sink),0==--this.activeCount&&this.sink.end(t)},e}(Pt),te=function(t,e){return ee(d,t,e)},ee=function(t,e,i){return mt(i)?ft():new ie(t,e,i)},ie=function(){function t(t,e,i){this.f=t,this.concurrency=e,this.source=i}return t.prototype.run=function(t,e){return new se(this.f,this.concurrency,this.source,t,e)},t}(),se=function(){function t(t,e,i,s,n){this.f=t,this.concurrency=e,this.sink=s,this.scheduler=n,this.pending=[],this.current=[],this.disposable=z(i.run(this,n)),this.active=!0}return t.prototype.event=function(t,e){this.addInner(t,e)},t.prototype.addInner=function(t,e){this.current.length<this.concurrency?this.startInner(t,e):this.pending.push(e)},t.prototype.startInner=function(t,e){try{this.initInner(t,e)}catch(e){this.error(t,e)}},t.prototype.initInner=function(t,e){var i=new re(t,this,this.sink);i.disposable=ne(this.f,t,e,i,this.scheduler),this.current.push(i)},t.prototype.end=function(t){this.active=!1,tt(t,this.disposable,this.sink),this.checkEnd(t)},t.prototype.error=function(t,e){this.active=!1,this.sink.error(t,e)},t.prototype.dispose=function(){this.active=!1,this.pending.length=0,this.disposable.dispose(),G(this.current).dispose()},t.prototype.endInner=function(t,e){var i=this.current.indexOf(e);i>=0&&this.current.splice(i,1),tt(t,e,this);var s=this.pending;s.length>0?this.startInner(t,s.shift()):this.checkEnd(t)},t.prototype.checkEnd=function(t){this.active||0!==this.current.length||this.sink.end(t)},t}(),ne=function(t,e,i,s,n){return t(i).run(s,F(e,n))},re=function(){function t(t,e,i){this.time=t,this.outer=e,this.sink=i,this.disposable=L()}return t.prototype.event=function(t,e){this.sink.event(t+this.time,e)},t.prototype.end=function(t){this.outer.endInner(t+this.time,this)},t.prototype.error=function(t,e){this.outer.error(t+this.time,e)},t.prototype.dispose=function(){return this.disposable.dispose()},t}(),oe=function(t){return te(1/0,t)},ae=function(t){return he(ce(t))},he=function(t){return 0===t.length?ft():1===t.length?t[0]:new de(c(le,[],t))},ce=function(t){return t.filter(ue)},ue=function(t){return!mt(t)},le=function(t,e){return t.concat(e instanceof de?e.sources:e)},de=function(){function t(t){this.sources=t}return t.prototype.run=function(t,e){for(var i=this.sources.length,s=new Array(i),n=new Array(i),r=new pe(s,n,t),o=void 0,a=0;a<i;++a)o=n[a]=new Jt(a,r),s[a]=this.sources[a].run(o,e);return G(s)},t}(),pe=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.disposables=e,n.activeCount=i.length,n}return it(e,t),e.prototype.event=function(t,e){e.active?this.sink.event(t,e.value):this.dispose(t,e.index)},e.prototype.dispose=function(t,e){tt(t,this.disposables[e],this.sink),0==--this.activeCount&&this.sink.end(t)},e}(Pt),fe=function(t,e,i){return mt(i)||mt(e)?ft():new me(t,e,i)},me=function(){function t(t,e,i){this.f=t,this.values=e,this.sampler=i}return t.prototype.run=function(t,e){var i=new ye(this.f,t),s=this.values.run(i.latest,e),n=this.sampler.run(i,e);return V(n,s)},t}(),ye=function(t){function e(e,i){var s=t.call(this,i)||this;return s.f=e,s.latest=new ge(s),s}return it(e,t),e.prototype.event=function(t,e){if(this.latest.hasValue){var i=this.f;this.sink.event(t,i(this.latest.value,e))}},e}(Pt),ge=function(t){function e(e){var i=t.call(this,e)||this;return i.hasValue=!1,i}return it(e,t),e.prototype.event=function(t,e){this.value=e,this.hasValue=!0},e.prototype.end=function(){},e}(Pt),ve=function(t,e){var i=Math.max(0,t);return{min:i,max:Math.max(i,e)}},we=function(t,e){return xe(0,t,e)},xe=function(t,e,i){return be(ve(t,e),i)},be=function(t,e){return ke(t,e)?ft():e instanceof qt?Te(t,e):e instanceof Ae?Be(t,e):Se(t,e)},ke=function(t,e){return mt(e)||(i=t).min>=i.max;var i},Se=function(t,e){return(i=t).min<=0&&i.max===1/0?e:new Ae(t,e);var i},Te=function(t,e){return qt.create(e.f,be(t,e.source))},Be=function(t,e){return be((i=e.bounds,s=t,ve(i.min+s.min,Math.min(i.max,i.min+s.max))),e.source);var i,s},Ae=function(){function t(t,e){this.source=e,this.bounds=t}return t.prototype.run=function(t,e){var i=new kt,s=new Ce(this.bounds.min,this.bounds.max-this.bounds.min,t,i);return i.setDisposable(this.source.run(s,e)),i},t}(),Ce=function(t){function e(e,i,s,n){var r=t.call(this,s)||this;return r.skip=e,r.take=i,r.disposable=n,r}return it(e,t),e.prototype.event=function(t,e){this.skip>0?this.skip-=1:0!==this.take&&(this.take-=1,this.sink.event(t,e),0===this.take&&(this.disposable.dispose(),this.sink.end(t)))},e}(Pt),Oe=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){var i=new kt,s=new Ee(this.p,t,i);return i.setDisposable(this.source.run(s,e)),i},t}(),Ee=function(t){function e(e,i,s){var n=t.call(this,i)||this;return n.p=e,n.active=!0,n.disposable=s,n}return it(e,t),e.prototype.event=function(t,e){if(this.active){var i=this.p;this.active=i(e),this.active?this.sink.event(t,e):(this.disposable.dispose(),this.sink.end(t))}},e}(Pt),Pe=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new je(this.p,t),e)},t}(),je=function(t){function e(e,i){var s=t.call(this,i)||this;return s.p=e,s.skipping=!0,s}return it(e,t),e.prototype.event=function(t,e){if(this.skipping){var i=this.p;if(this.skipping=i(e),this.skipping)return}this.sink.event(t,e)},e}(Pt),Me=function(){function t(t,e){this.p=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new _e(this.p,t),e)},t}(),_e=function(t){function e(e,i){var s=t.call(this,i)||this;return s.p=e,s.skipping=!1,s}return it(e,t),e.prototype.event=function(t,e){if(!this.skipping){var i=this.p;this.skipping=i(e),this.sink.event(t,e),this.skipping&&this.sink.end(t)}},e}(Pt),Ne=function(t,e,i){return mt(i)||0===e.length?ft():new Fe(t,e,we(e.length,i))},De=function(t){return t},Fe=function(){function t(t,e,i){this.f=t,this.items=e,this.source=i}return t.prototype.run=function(t,e){return this.source.run(new Ie(this.f,this.items,t),e)},t}(),Ie=function(t){function e(e,i,s){var n=t.call(this,s)||this;return n.f=e,n.items=i,n.index=0,n}return it(e,t),e.prototype.event=function(t,e){var i=this.f;this.sink.event(t,i(this.items[this.index],e)),this.index+=1},e}(Pt),Re=function(){function t(){this.head=0,this.tail=0,this.capacityMask=3,this.list=new Array(4)}return t.prototype.push=function(t){var e=this.tail;return this.list[e]=t,this.tail=e+1&this.capacityMask,this.tail===this.head&&this.growArray(),this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.shift=function(){var t=this.head;if(t!==this.tail){var e=this.list[t];return this.list[t]=void 0,this.head=t+1&this.capacityMask,t<2&&this.tail>1e4&&this.tail<=this.list.length>>>2&&this.shrinkArray(),e}},t.prototype.isEmpty=function(){return this.head===this.tail},t.prototype.length=function(){return this.head===this.tail?0:this.head<this.tail?this.tail-this.head:this.capacityMask+1-(this.head-this.tail)},t.prototype.growArray=function(){this.head&&(this.list=this.copyArray(),this.head=0),this.tail=this.list.length,this.list.length*=2,this.capacityMask=this.capacityMask<<1|1},t.prototype.shrinkArray=function(){this.list.length>>>=1,this.capacityMask>>>=1},t.prototype.copyArray=function(){var t,e=[],i=this.list,s=i.length;for(t=this.head;t<s;t++)e.push(i[t]);for(t=0;t<this.tail;t++)e.push(i[t]);return e},t}(),Le=function(t,e){return 0===e.length||yt(e)?ft():1===e.length?Vt(t,e[0]):new He(t,e)},He=function(){function t(t,e){this.f=t,this.sources=e}return t.prototype.run=function(t,e){for(var i=this.sources.length,s=new Array(i),n=new Array(i),r=new Array(i),o=new ze(this.f,r,n,t),a=void 0,h=0;h<i;++h)r[h]=new Re,a=n[h]=new Jt(h,o),s[h]=this.sources[h].run(a,e);return G(s)},t}(),ze=function(t){function e(e,i,s,n){var r=t.call(this,n)||this;return r.f=e,r.sinks=s,r.buffers=i,r}return it(e,t),e.prototype.event=function(t,e){if(e.active){var i=this.buffers,s=i[e.index];if(s.push(e.value),1===s.length()){if(!function(t){for(var e=0,i=t.length;e<i;++e)if(t[e].isEmpty())return!1;return!0}(i))return;Ue(this.f,t,i,this.sink),function(t,e){for(var i=0,s=t.length;i<s;++i)if(t[i].isEmpty()&&!e[i].active)return!0;return!1}(this.buffers,this.sinks)&&this.sink.end(t)}}else this.dispose(t,e.index)},e.prototype.dispose=function(t,e){this.buffers[e].isEmpty()&&this.sink.end(t)},e}(Pt),Ue=function(t,e,i,s){return s.event(e,$t(t,function(t,e){for(var i=e.length,s=new Array(i),n=0;n<i;++n)s[n]=t(e[n]);return s}(qe,i)))},qe=function(t){return t.shift()},Ge=function(t){return mt(t)?ft():new Ve(t)},Ve=function(){function t(t){this.source=t}return t.prototype.run=function(t,e){var i=new We(t,e);return V(i,this.source.run(i,e))},t}(),We=function(){function t(t,e){this.sink=t,this.scheduler=e,this.current=null,this.ended=!1}return t.prototype.event=function(t,e){this.disposeCurrent(t),this.current=new Ke(e,t,1/0,this,this.sink,this.scheduler)},t.prototype.end=function(t){this.ended=!0,this.checkEnd(t)},t.prototype.error=function(t,e){this.ended=!0,this.sink.error(t,e)},t.prototype.dispose=function(){return this.disposeCurrent(M(this.scheduler))},t.prototype.disposeCurrent=function(t){if(null!==this.current)return this.current.dispose(t)},t.prototype.disposeInner=function(t,e){e.dispose(t),e===this.current&&(this.current=null)},t.prototype.checkEnd=function(t){this.ended&&null===this.current&&this.sink.end(t)},t.prototype.endInner=function(t,e){this.disposeInner(t,e),this.checkEnd(t)},t.prototype.errorInner=function(t,e,i){this.disposeInner(t,i),this.sink.error(t,e)},t}(),Ke=function(){function t(t,e,i,s,n,r){this.min=e,this.max=i,this.outer=s,this.sink=n,this.disposable=t.run(this,F(e,r))}return t.prototype.event=function(t,e){var i=Math.max(0,t+this.min);i<this.max&&this.sink.event(i,e)},t.prototype.end=function(t){this.outer.endInner(t+this.min,this)},t.prototype.error=function(t,e){this.outer.errorInner(t+this.min,e,this)},t.prototype.dispose=function(t){tt(t,this.disposable,this.sink)},t}(),Je=function(t){return $e(Ze,t)},$e=function(t,e){return mt(e)?ft():new Ye(t,e)},Ye=function(){function t(t,e){this.equals=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new Xe(this.equals,t),e)},t}(),Xe=function(t){function e(e,i){var s=t.call(this,i)||this;return s.equals=e,s.value=void 0,s.init=!0,s}return it(e,t),e.prototype.event=function(t,e){this.init?(this.init=!1,this.value=e,this.sink.event(t,e)):this.equals(this.value,e)||(this.value=e,this.sink.event(t,e))},e}(Pt);function Ze(t,e){return t===e}var Qe=function(t,e){return new ei(t,e)},ti=function(t,e){return new ii(t,e)},ei=function(){function t(t,e){this.maxSignal=t,this.source=e}return t.prototype.run=function(t,e){var i=new kt,s=this.source.run(t,e),n=this.maxSignal.run(new ri(t,i),e);return i.setDisposable(V(s,n)),i},t}(),ii=function(){function t(t,e){this.minSignal=t,this.source=e}return t.prototype.run=function(t,e){var i=new ni(this.minSignal,t,e),s=this.source.run(new si(i,t),e);return V(i,s)},t}(),si=function(t){function e(e,i){var s=t.call(this,i)||this;return s.min=e,s}return it(e,t),e.prototype.event=function(t,e){this.min.allow&&this.sink.event(t,e)},e}(Pt),ni=function(t){function e(e,i,s){var n=t.call(this,i)||this;return n.allow=!1,n.disposable=e.run(n,s),n}return it(e,t),e.prototype.event=function(){this.allow=!0,this.dispose()},e.prototype.end=function(){},e.prototype.dispose=function(){this.disposable.dispose()},e}(Pt),ri=function(t){function e(e,i){var s=t.call(this,e)||this;return s.disposable=i,s}return it(e,t),e.prototype.event=function(t){this.disposable.dispose(),this.sink.end(t)},e.prototype.end=function(){},e}(Pt),oi=function(){function t(t,e){this.dt=t,this.source=e}return t.prototype.run=function(t,e){var i=new ai(this.dt,t,e);return V(i,this.source.run(i,e))},t}(),ai=function(t){function e(e,i,s){var n=t.call(this,i)||this;return n.dt=e,n.scheduler=s,n.tasks=[],n}return it(e,t),e.prototype.dispose=function(){this.tasks.forEach(D)},e.prototype.event=function(t,e){this.tasks.push(N(this.dt,ot(e,this.sink),this.scheduler))},e.prototype.end=function(){this.tasks.push(N(this.dt,at(this.sink),this.scheduler))},e}(Pt),hi=function(t,e){return mt(e)?ft():e instanceof qt?ci(t,e):e instanceof li?ui(t,e):new li(t,e)},ci=function(t,e){return qt.create(e.f,hi(t,e.source))},ui=function(t,e){return new li(Math.max(t,e.period),e.source)},li=function(){function t(t,e){this.period=t,this.source=e}return t.prototype.run=function(t,e){return this.source.run(new di(this.period,t),e)},t}(),di=function(t){function e(e,i){var s=t.call(this,i)||this;return s.time=0,s.period=e,s}return it(e,t),e.prototype.event=function(t,e){t>=this.time&&(this.time=t+this.period,this.sink.event(t,e))},e}(Pt),pi=function(){function t(t,e){this.dt=t,this.source=e}return t.prototype.run=function(t,e){return new fi(this.dt,this.source,t,e)},t}(),fi=function(){function t(t,e,i,s){this.dt=t,this.sink=i,this.scheduler=s,this.timer=null,this.disposable=e.run(this,s)}return t.prototype.event=function(t,e){this.clearTimer(),this.value=e,this.timer=N(this.dt,new mi(this,e),this.scheduler)},t.prototype.handleEventFromTask=function(t,e){this.clearTimer(),this.sink.event(t,e)},t.prototype.end=function(t){this.clearTimer()&&(this.sink.event(t,this.value),this.value=void 0),this.sink.end(t)},t.prototype.error=function(t,e){this.clearTimer(),this.sink.error(t,e)},t.prototype.dispose=function(){this.clearTimer(),this.disposable.dispose()},t.prototype.clearTimer=function(){return null!==this.timer&&(this.timer.dispose(),this.timer=null,!0)},t}(),mi=function(){function t(t,e){this.sink=t,this.value=e}return t.prototype.run=function(t){this.sink.handleEventFromTask(t,this.value)},t.prototype.error=function(t,e){this.sink.error(t,e)},t.prototype.dispose=function(){},t}(),yi=(function(){function t(t,e){var i=this;this.eventBound=function(t){return i.sink.event(M(i.scheduler),t)},this.endBound=function(){return i.sink.end(M(i.scheduler))},this.errorBound=function(t){return i.sink.error(M(i.scheduler),t)},this.sink=t,this.scheduler=e,this.queue=Promise.resolve()}t.prototype.event=function(t,e){var i=this;this.queue=this.queue.then((function(){return i.handlePromise(e)})).catch(this.errorBound)},t.prototype.end=function(){this.queue=this.queue.then(this.endBound).catch(this.errorBound)},t.prototype.error=function(t,e){var i=this;this.queue=this.queue.then((function(){return i.errorBound(e)})).catch(st)},t.prototype.handlePromise=function(t){return t.then(this.eventBound)}}(),function(){function t(t){this.sink=t,this.active=!0}return t.prototype.event=function(t,e){this.active&&this.sink.event(t,e)},t.prototype.end=function(t){this.active&&(this.disable(),this.sink.end(t))},t.prototype.error=function(t,e){this.disable(),this.sink.error(t,e)},t.prototype.disable=function(){return this.active=!1,this.sink},t}());function gi(t,e,i){try{i.event(t,e)}catch(e){i.error(t,e)}}function vi(t,e){try{e.end(t)}catch(i){e.error(t,i)}}var wi=function(){function t(t,e){this.f=t,this.source=e}return t.prototype.run=function(t,e){return new xi(this.f,this.source,t,e)},t}(),xi=function(){function t(t,e,i,s){this.f=t,this.sink=new yi(i),this.scheduler=s,this.disposable=e.run(this,s)}return t.prototype.event=function(t,e){gi(t,e,this.sink)},t.prototype.end=function(t){vi(t,this.sink)},t.prototype.error=function(t,e){var i=this.sink.disable();tt(t,this.disposable,this.sink),this._startNext(t,e,i)},t.prototype._startNext=function(t,e,i){try{this.disposable=this._continue(this.f,t,e,i)}catch(e){i.error(t,e)}},t.prototype._continue=function(t,e,i,s){return Bt(s,this.scheduler,Ct(e,t(i)))},t.prototype.dispose=function(){return this.disposable.dispose()},t}(),bi=function(t){return t instanceof ki||mt(t)?t:new ki(t)},ki=function(){function t(t){this.source=new Si(t)}return t.prototype.run=function(t,e){return this.source.run(t,e)},t}(),Si=function(){function t(t){this.source=t,this.sinks=[],this.disposable=L()}return t.prototype.run=function(t,e){return 1===this.add(t)&&(this.disposable=this.source.run(this,e)),z(new Ti(this,t))},t.prototype.dispose=function(){var t=this.disposable;return this.disposable=L(),t.dispose()},t.prototype.add=function(t){return this.sinks=h(t,this.sinks),this.sinks.length},t.prototype.remove=function(t){var e=l(t,this.sinks);return e>=0&&(this.sinks=function(t,e){if(t<0)throw new TypeError("i must be >= 0");var i=e.length;return 0===i||t>=i?e:1===i?[]:function(t,e,i){var s,n=new Array(i);for(s=0;s<t;++s)n[s]=e[s];for(s=t;s<i;++s)n[s]=e[s+1];return n}(t,e,i-1)}(e,this.sinks)),this.sinks.length},t.prototype.event=function(t,e){var i=this.sinks;if(1===i.length)return i[0].event(t,e);for(var s=0;s<i.length;++s)gi(t,e,i[s])},t.prototype.end=function(t){for(var e=this.sinks,i=0;i<e.length;++i)vi(t,e[i])},t.prototype.error=function(t,e){for(var i=this.sinks,s=0;s<i.length;++s)i[s].error(t,e)},t}(),Ti=function(){function t(t,e){this.source=t,this.sink=e}return t.prototype.dispose=function(){0===this.source.remove(this.sink)&&this.source.dispose()},t}(),Bi=(m(Bt),f(Ct),m((function(t,e,i){return mt(i)?ft():new jt(t,e,i)})),m((function(t,e,i){return new _t(t,e,i)}))),Ai=f((function(t,e){return Dt((function(){return e}),bt(t))})),Ci=f(Vt),Oi=(f((function(t,e){return Vt((function(){return t}),e)})),f((function(t,e){return new Wt(t,e)}))),Ei=(f((function(t,e){return Yt(p,t,e)})),f((function(t,e){return ee(t,1/0,e)})),f(Dt),f((function(t,e){return ee(t,1,e)})),f(te),m(ee),f((function(t,e){return ae([t,e])}))),Pi=(m(Yt),f(Xt),f((function(t,e){return fe((function(t){return t}),t,e)})),m(fe)),ji=(m(Ne),f((function(t,e){return Ne(De,t,e)})),m((function(t,e,i){return Le(t,[e,i])})),f(Le),f((function(t,e){return Rt.create(t,e)}))),Mi=(f($e),f(we),f((function(t,e){return xe(t,1/0,e)})),m(xe),f((function(t,e){return mt(e)?ft():new Oe(t,e)})),f((function(t,e){return mt(e)?ft():new Pe(t,e)})),f((function(t,e){return mt(e)?ft():new Me(t,e)}))),_i=f(Qe),Ni=(f(ti),f((function(t,e){return Qe(oe(t),ti(t,e))})),f((function(t,e){return t<=0?e:new oi(t,e)}))),Di=(f(hi),f((function(t,e){return mt(e)?ft():new pi(t,e)}))),Fi=(f((function(t,e){return mt(e)?ft():new wi(t,e)})),m(rt),f(ot),f(ht),function(t,e,i,s,n){this.time=t,this.localOffset=e,this.period=i,this.task=s,this.scheduler=n,this.active=!0});Fi.prototype.run=function(){return this.task.run(this.time-this.localOffset)},Fi.prototype.error=function(t){return this.task.error(this.time-this.localOffset,t)},Fi.prototype.dispose=function(){return this.scheduler.cancel(this),this.task.dispose()};var Ii=function(t,e){this.origin=t,this.scheduler=e};function Ri(t){try{return t.run()}catch(e){return t.error(e)}}Ii.prototype.currentTime=function(){return this.scheduler.currentTime()-this.origin},Ii.prototype.scheduleTask=function(t,e,i,s){return this.scheduler.scheduleTask(t+this.origin,e,i,s)},Ii.prototype.relative=function(t){return new Ii(t+this.origin,this.scheduler)},Ii.prototype.cancel=function(t){return this.scheduler.cancel(t)},Ii.prototype.cancelAll=function(t){return this.scheduler.cancelAll(t)};var Li=function(t,e){var i=this;this.timer=t,this.timeline=e,this._timer=null,this._nextArrival=1/0,this._runReadyTasksBound=function(){return i._runReadyTasks(i.currentTime())}};Li.prototype.currentTime=function(){return this.timer.now()},Li.prototype.scheduleTask=function(t,e,i,s){var n=this.currentTime()+Math.max(0,e),r=new Fi(n,t,i,s,this);return this.timeline.add(r),this._scheduleNextRun(),r},Li.prototype.relative=function(t){return new Ii(t,this)},Li.prototype.cancel=function(t){t.active=!1,this.timeline.remove(t)&&this._reschedule()},Li.prototype.cancelAll=function(t){this.timeline.removeAll(t),this._reschedule()},Li.prototype._reschedule=function(){this.timeline.isEmpty()?this._unschedule():this._scheduleNextRun(this.currentTime())},Li.prototype._unschedule=function(){this.timer.clearTimer(this._timer),this._timer=null},Li.prototype._scheduleNextRun=function(){if(!this.timeline.isEmpty()){var t=this.timeline.nextArrival();null===this._timer?this._scheduleNextArrival(t):t<this._nextArrival&&(this._unschedule(),this._scheduleNextArrival(t))}},Li.prototype._scheduleNextArrival=function(t){this._nextArrival=t;var e=Math.max(0,t-this.currentTime());this._timer=this.timer.setTimer(this._runReadyTasksBound,e)},Li.prototype._runReadyTasks=function(){this._timer=null,this.timeline.runTasks(this.currentTime(),Ri),this._scheduleNextRun()};var Hi=function(){this.tasks=[]};function zi(t,e,i){for(var s=0;s<e.length;++s){var n=e[s];n.active&&(t(n),n.period>=0&&n.active&&(n.time=n.time+n.period,Ui(n,i)))}return i}function Ui(t,e){var i=e.length,s=qi(t);if(0!==i){var n=Vi(s,e);n>=i?e.push(Wi(s,[t])):function(t,e,i,s){var n=e[s];i===n.time?function(t,e){0===e.length||t.time>=e[e.length-1].time?e.push(t):function(t,e){for(var i=0;i<e.length;i++)if(t.time<e[i].time){e.splice(i,0,t);break}}(t,e)}(t,n.events):e.splice(s,0,Wi(i,[t]))}(t,e,s,n)}else e.push(Wi(s,[t]))}function qi(t){return Math.floor(t.time)}function Gi(t,e){e.events=u(t,e.events)}function Vi(t,e){for(var i,s,n=0,r=e.length;n<r;){if(t===(s=e[i=Math.floor((n+r)/2)]).time)return i;t<s.time?r=i:n=i+1}return r}Hi.prototype.nextArrival=function(){return this.isEmpty()?1/0:this.tasks[0].time},Hi.prototype.isEmpty=function(){return 0===this.tasks.length},Hi.prototype.add=function(t){Ui(t,this.tasks)},Hi.prototype.remove=function(t){var e=Vi(qi(t),this.tasks);if(e>=0&&e<this.tasks.length){var i=l(t,this.tasks[e].events);if(i>=0)return this.tasks[e].events.splice(i,1),!0}return!1},Hi.prototype.removeAll=function(t){for(var e=0;e<this.tasks.length;++e)Gi(t,this.tasks[e])},Hi.prototype.runTasks=function(t,e){for(var i=this.tasks,s=i.length,n=0;n<s&&i[n].time<=t;)++n;this.tasks=i.slice(n);for(var r=0;r<n;++r)this.tasks=zi(e,i[r].events,this.tasks)};var Wi=function(t,e){return{time:t,events:e}},Ki=function(t){this._clock=t};Ki.prototype.now=function(){return this._clock.now()},Ki.prototype.setTimer=function(t,e){return e<=0?function(t){var e=new Ji(t);return function(t){Promise.resolve(t).then(Ri)}(e),e}(t):setTimeout(t,e)},Ki.prototype.clearTimer=function(t){return t instanceof Ji?t.cancel():clearTimeout(t)};var Ji=function(t){this.f=t,this.active=!0};Ji.prototype.run=function(){return this.active&&this.f()},Ji.prototype.error=function(t){throw t},Ji.prototype.cancel=function(){this.active=!1};f((function(t,e){return e.scheduleTask(0,0,-1,t)})),m((function(t,e,i){return i.scheduleTask(0,t,-1,e)})),m((function(t,e,i){return i.scheduleTask(0,0,t,e)})),f((function(t,e){return e.cancelAll(t)})),f((function(t,e){return new Ii(t,e)})),f((function(t,e){return new Li(t,e)}));var $i=function(t,e,i){return void 0===i&&(i=!1),new Zi(t,e,i)},Yi=function(t,e){return void 0===e&&(e=!1),$i("resize",t,e)},Xi=function(t,e){return void 0===e&&(e=!1),$i("scroll",t,e)},Zi=function(t,e,i){this.event=t,this.node=e,this.capture=i};Zi.prototype.run=function(t,e){var i=this,s=function(i){return function(t,e,i){try{i.event(t,e)}catch(e){i.error(t,e)}}(e.currentTime(),i,t)};return this.node.addEventListener(this.event,s,this.capture),{dispose:function(){return i.node.removeEventListener(i.event,s,i.capture)}}};var Qi=function(){var t=[];return[function(e){return ts(t,e)},new es(t)]},ts=function(t,e){return t.forEach((function(t){var i=t.sink;return function(t,e,i){try{i.event(t,e)}catch(e){i.error(t,e)}}(t.scheduler.currentTime(),e,i)}))},es=function(){function t(t){this.sinks=t}return t.prototype.run=function(t,e){var i={sink:t,scheduler:e};return this.sinks.push(i),new is(i,this.sinks)},t}(),is=function(){function t(t,e){this.sink=t,this.sinks=e}return t.prototype.dispose=function(){var t=this.sinks.indexOf(this.sink);t>=0&&this.sinks.splice(t,1)},t}();function ss(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function ns(t){return function e(i){return 0===arguments.length||ss(i)?e:t.apply(this,arguments)}}function rs(t,e){switch(t){case 0:return function(){return e.apply(this,arguments)};case 1:return function(t){return e.apply(this,arguments)};case 2:return function(t,i){return e.apply(this,arguments)};case 3:return function(t,i,s){return e.apply(this,arguments)};case 4:return function(t,i,s,n){return e.apply(this,arguments)};case 5:return function(t,i,s,n,r){return e.apply(this,arguments)};case 6:return function(t,i,s,n,r,o){return e.apply(this,arguments)};case 7:return function(t,i,s,n,r,o,a){return e.apply(this,arguments)};case 8:return function(t,i,s,n,r,o,a,h){return e.apply(this,arguments)};case 9:return function(t,i,s,n,r,o,a,h,c){return e.apply(this,arguments)};case 10:return function(t,i,s,n,r,o,a,h,c,u){return e.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}}function os(t){return function e(i,s){switch(arguments.length){case 0:return e;case 1:return ss(i)?e:ns((function(e){return t(i,e)}));default:return ss(i)&&ss(s)?e:ss(i)?ns((function(e){return t(e,s)})):ss(s)?ns((function(e){return t(i,e)})):t(i,s)}}}function as(t,e,i){return function(){for(var s=[],n=0,r=t,o=0;o<e.length||n<arguments.length;){var a;o<e.length&&(!ss(e[o])||n>=arguments.length)?a=e[o]:(a=arguments[n],n+=1),s[o]=a,ss(a)||(r-=1),o+=1}return r<=0?i.apply(this,s):rs(r,as(t,s,i))}}const hs=os((function(t,e){return 1===t?ns(e):rs(t,as(t,[],e))})),cs=ns((function(t){return hs(t.length,t)}));function us(t,e){return function(){return e.call(this,t.apply(this,arguments))}}function ls(t){return function e(i,s,n){switch(arguments.length){case 0:return e;case 1:return ss(i)?e:os((function(e,s){return t(i,e,s)}));case 2:return ss(i)&&ss(s)?e:ss(i)?os((function(e,i){return t(e,s,i)})):ss(s)?os((function(e,s){return t(i,e,s)})):ns((function(e){return t(i,s,e)}));default:return ss(i)&&ss(s)&&ss(n)?e:ss(i)&&ss(s)?os((function(e,i){return t(e,i,n)})):ss(i)&&ss(n)?os((function(e,i){return t(e,s,i)})):ss(s)&&ss(n)?os((function(e,s){return t(i,e,s)})):ss(i)?ns((function(e){return t(e,s,n)})):ss(s)?ns((function(e){return t(i,e,n)})):ss(n)?ns((function(e){return t(i,s,e)})):t(i,s,n)}}}const ds=Array.isArray||function(t){return null!=t&&t.length>=0&&"[object Array]"===Object.prototype.toString.call(t)};function ps(t){return"[object String]"===Object.prototype.toString.call(t)}const fs=ns((function(t){return!!ds(t)||!!t&&"object"==typeof t&&!ps(t)&&(1===t.nodeType?!!t.length:0===t.length||t.length>0&&t.hasOwnProperty(0)&&t.hasOwnProperty(t.length-1))}));var ms=function(){function t(t){this.f=t}return t.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")},t.prototype["@@transducer/result"]=function(t){return t},t.prototype["@@transducer/step"]=function(t,e){return this.f(t,e)},t}();const ys=os((function(t,e){return rs(t.length,(function(){return t.apply(e,arguments)}))}));function gs(t,e,i){for(var s=i.next();!s.done;){if((e=t["@@transducer/step"](e,s.value))&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}s=i.next()}return t["@@transducer/result"](e)}function vs(t,e,i,s){return t["@@transducer/result"](i[s](ys(t["@@transducer/step"],t),e))}var ws="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator";function xs(t,e,i){if("function"==typeof t&&(t=function(t){return new ms(t)}(t)),fs(i))return function(t,e,i){for(var s=0,n=i.length;s<n;){if((e=t["@@transducer/step"](e,i[s]))&&e["@@transducer/reduced"]){e=e["@@transducer/value"];break}s+=1}return t["@@transducer/result"](e)}(t,e,i);if("function"==typeof i["fantasy-land/reduce"])return vs(t,e,i,"fantasy-land/reduce");if(null!=i[ws])return gs(t,e,i[ws]());if("function"==typeof i.next)return gs(t,e,i);if("function"==typeof i.reduce)return vs(t,e,i,"reduce");throw new TypeError("reduce: list must be array or iterable")}const bs=ls(xs);function ks(t,e){return function(){var i=arguments.length;if(0===i)return e();var s=arguments[i-1];return ds(s)||"function"!=typeof s[t]?e.apply(this,arguments):s[t].apply(s,Array.prototype.slice.call(arguments,0,i-1))}}const Ss=ns(ks("tail",ls(ks("slice",(function(t,e,i){return Array.prototype.slice.call(i,t,e)})))(1,1/0)));function Ts(){if(0===arguments.length)throw new Error("pipe requires at least one argument");return rs(arguments[0].length,bs(us,arguments[0],Ss(arguments)))}const Bs=ns((function(t){return ps(t)?t.split("").reverse().join(""):Array.prototype.slice.call(t,0).reverse()}));function As(){if(0===arguments.length)throw new Error("compose requires at least one argument");return Ts.apply(this,Bs(arguments))}const Cs=os((function(t,e){return e(t)})),Os="function"==typeof Object.is?Object.is:function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e},Es=os(Os);function Ps(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}function js(t,e,i){for(var s=0,n=i.length;s<n;){if(t(e,i[s]))return!0;s+=1}return!1}function Ms(t,e){return Object.prototype.hasOwnProperty.call(e,t)}var _s=Object.prototype.toString;const Ns=function(){return"[object Arguments]"===_s.call(arguments)?function(t){return"[object Arguments]"===_s.call(t)}:function(t){return Ms("callee",t)}}();var Ds=!{toString:null}.propertyIsEnumerable("toString"),Fs=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Is=function(){return arguments.propertyIsEnumerable("length")}(),Rs=function(t,e){for(var i=0;i<t.length;){if(t[i]===e)return!0;i+=1}return!1};const Ls="function"!=typeof Object.keys||Is?ns((function(t){if(Object(t)!==t)return[];var e,i,s=[],n=Is&&Ns(t);for(e in t)!Ms(e,t)||n&&"length"===e||(s[s.length]=e);if(Ds)for(i=Fs.length-1;i>=0;)Ms(e=Fs[i],t)&&!Rs(s,e)&&(s[s.length]=e),i-=1;return s})):ns((function(t){return Object(t)!==t?[]:Object.keys(t)})),Hs=ns((function(t){return null===t?"Null":void 0===t?"Undefined":Object.prototype.toString.call(t).slice(8,-1)}));function zs(t,e,i,s){var n=Ps(t);function r(t,e){return Us(t,e,i.slice(),s.slice())}return!js((function(t,e){return!js(r,e,t)}),Ps(e),n)}function Us(t,e,i,s){if(Os(t,e))return!0;var n,r,o=Hs(t);if(o!==Hs(e))return!1;if(null==t||null==e)return!1;if("function"==typeof t["fantasy-land/equals"]||"function"==typeof e["fantasy-land/equals"])return"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e)&&"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t);if("function"==typeof t.equals||"function"==typeof e.equals)return"function"==typeof t.equals&&t.equals(e)&&"function"==typeof e.equals&&e.equals(t);switch(o){case"Arguments":case"Array":case"Object":if("function"==typeof t.constructor&&"Promise"===(n=t.constructor,null==(r=String(n).match(/^function (\w*)/))?"":r[1]))return t===e;break;case"Boolean":case"Number":case"String":if(typeof t!=typeof e||!Os(t.valueOf(),e.valueOf()))return!1;break;case"Date":if(!Os(t.valueOf(),e.valueOf()))return!1;break;case"Error":return t.name===e.name&&t.message===e.message;case"RegExp":if(t.source!==e.source||t.global!==e.global||t.ignoreCase!==e.ignoreCase||t.multiline!==e.multiline||t.sticky!==e.sticky||t.unicode!==e.unicode)return!1}for(var a=i.length-1;a>=0;){if(i[a]===t)return s[a]===e;a-=1}switch(o){case"Map":return t.size===e.size&&zs(t.entries(),e.entries(),i.concat([t]),s.concat([e]));case"Set":return t.size===e.size&&zs(t.values(),e.values(),i.concat([t]),s.concat([e]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var h=Ls(t);if(h.length!==Ls(e).length)return!1;var c=i.concat([t]),u=s.concat([e]);for(a=h.length-1;a>=0;){var l=h[a];if(!Ms(l,e)||!Us(e[l],t[l],c,u))return!1;a-=1}return!0}const qs=os((function(t,e){return Us(t,e,[],[])})),Gs=ls((function(t,e,i){var s={};for(var n in i)s[n]=i[n];return s[t]=e,s})),Vs=ns((function(t){return null!=t&&"function"==typeof t["fantasy-land/empty"]?t["fantasy-land/empty"]():null!=t&&null!=t.constructor&&"function"==typeof t.constructor["fantasy-land/empty"]?t.constructor["fantasy-land/empty"]():null!=t&&"function"==typeof t.empty?t.empty():null!=t&&null!=t.constructor&&"function"==typeof t.constructor.empty?t.constructor.empty():ds(t)?[]:ps(t)?"":function(t){return"[object Object]"===Object.prototype.toString.call(t)}(t)?{}:Ns(t)?function(){return arguments}():void 0})),Ws=ns((function(t){return null!=t&&qs(t,Vs(t))}));function Ks(t,e){return function(t,e,i){var s,n;if("function"==typeof t.indexOf)switch(typeof e){case"number":if(0===e){for(s=1/e;i<t.length;){if(0===(n=t[i])&&1/n===s)return i;i+=1}return-1}if(e!=e){for(;i<t.length;){if("number"==typeof(n=t[i])&&n!=n)return i;i+=1}return-1}return t.indexOf(e,i);case"string":case"boolean":case"function":case"undefined":return t.indexOf(e,i);case"object":if(null===e)return t.indexOf(e,i)}for(;i<t.length;){if(qs(t[i],e))return i;i+=1}return-1}(e,t,0)>=0}function Js(t,e,i){var s,n=typeof t;switch(n){case"string":case"number":return 0===t&&1/t==-1/0?!!i._items["-0"]||(e&&(i._items["-0"]=!0),!1):null!==i._nativeSet?e?(s=i._nativeSet.size,i._nativeSet.add(t),i._nativeSet.size===s):i._nativeSet.has(t):n in i._items?t in i._items[n]||(e&&(i._items[n][t]=!0),!1):(e&&(i._items[n]={},i._items[n][t]=!0),!1);case"boolean":if(n in i._items){var r=t?1:0;return!!i._items[n][r]||(e&&(i._items[n][r]=!0),!1)}return e&&(i._items[n]=t?[!1,!0]:[!0,!1]),!1;case"function":return null!==i._nativeSet?e?(s=i._nativeSet.size,i._nativeSet.add(t),i._nativeSet.size===s):i._nativeSet.has(t):n in i._items?!!Ks(t,i._items[n])||(e&&i._items[n].push(t),!1):(e&&(i._items[n]=[t]),!1);case"undefined":return!!i._items[n]||(e&&(i._items[n]=!0),!1);case"object":if(null===t)return!!i._items.null||(e&&(i._items.null=!0),!1);default:return(n=Object.prototype.toString.call(t))in i._items?!!Ks(t,i._items[n])||(e&&i._items[n].push(t),!1):(e&&(i._items[n]=[t]),!1)}}const $s=function(){function t(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}return t.prototype.add=function(t){return!Js(t,!0,this)},t.prototype.has=function(t){return Js(t,!1,this)},t}(),Ys=os((function(t,e){for(var i=[],s=0,n=t.length,r=e.length,o=new $s,a=0;a<r;a+=1)o.add(e[a]);for(;s<n;)o.add(t[s])&&(i[i.length]=t[s]),s+=1;return i})),Xs=ls((function(t,e,i){return qs(e,i[t])})),Zs=ns((function(t){return function(){return t}})),Qs="visualViewport"in window;function tn(){return Qs}const en=navigator.userAgent,sn="ontouchend"in document,nn=/\b(\w*Macintosh\w*)\b/.test(en)&&sn,rn=/\b(\w*iPhone\w*)\b/.test(en)&&/\b(\w*Mobile\w*)\b/.test(en)&&sn,on=nn||rn,an=()=>screen.orientation.type.startsWith("portrait")?"portrait":"landscape",hn=cs(As(oe,Pi(((t,e)=>t?ft():bt(e)))));function cn(t){if(on)return function(t){if(!tn())return console.warn("On-Screen-Keyboard detection not supported on this version of iOS"),()=>{};const[e,i]=Qi(),s=I(),n=Ts((()=>ae([Xi(visualViewport),Yi(visualViewport),Xi(window)])),Di(800),Oi((()=>{console.log(visualViewport.height*visualViewport.scale/document.documentElement.clientHeight)})),Ci((()=>visualViewport.height*visualViewport.scale/document.documentElement.clientHeight<.85)),Je,Ci((t=>t?"visible":"hidden")),_i(i))();return St(Oi(t,n),s),e}(t);const e=Math.max(700,700)-500+200,[i,s]=Qi(),n=I(),r=window.innerHeight,o=screen.availHeight-window.innerHeight,a=Ei((m=document.documentElement,void 0===y&&(y=!1),$i("focusin",m,y)),function(t,e){return void 0===e&&(e=!1),$i("focusout",t,e)}(document.documentElement)),h=Cs($i("visibilitychange",document))(Ts(Ci((()=>document.visibilityState)),Ai(document.visibilityState))),c=Cs(a)(Ts(Ci((t=>"focusin"===t.type?bt(!1):vt(700,!0))),Ge,Ai(!(document.activeElement&&document.activeElement!==document.body)),Je,bi)),u=Cs(function(t,e){return void 0===e&&(e=!1),$i("change",t,e)}(screen.orientation))(Ts(Pi((t=>t||window.innerHeight===r),c),Di(700),Ci((t=>({screenOrientation:an(),height:t?window.innerHeight:screen.availHeight-o}))))),l=Cs(c)(Ts(ji(Es(!0)),Ci((()=>({screenOrientation:an(),height:window.innerHeight}))))),d=Cs(ae([l,u]))(Ts(Ni(1e3),hn(Ci(qs("hidden"),h)),Bi(((t,{screenOrientation:e,height:i})=>Gs(e,i,t)),{[an()]:window.innerHeight}),Mi(As(Ws,Ys(["portrait","landscape"]),Ls)))),p=Cs(Yi(window))(Ts(Di(500),Ci((t=>({width:t.target.innerWidth,height:t.target.innerHeight}))),Bi(((t,e)=>({...e,isJustHeightResize:t.width===e.width,dH:e.height-t.height})),{width:window.innerWidth,height:window.innerHeight,isJustHeightResize:!1,dH:0}),ji(Xs("isJustHeightResize",!0)))),f=Cs(p)(Ts(Ni(e),Pi(((t,{height:e,dH:i})=>{const s=t[an()];return s?e<.9*s&&i<0?bt("visible"):e===s&&i>0?bt("hidden"):ft():i>.1*screen.availHeight?bt("hidden"):i<-.1*screen.availHeight?bt("visible"):ft()}),d),oe,Ei(Cs(c)(Ts(ji(Es(!0)),Ci(Zs("hidden"))))),_i(s),Je));var m,y;return St(Oi(t,f),n),i}const un=JSON.parse('{"K":[{"x":-173,"y":3069,"scale":5.555146876107115},{"x":-3192,"y":-2797,"scale":1.649324984442478},{"x":1892,"y":-2465,"scale":5.4981463575140825},{"x":706,"y":-2053,"scale":2.065796807526529},{"x":-4409,"y":2863,"scale":1.2242583609537605},{"x":-2601,"y":-3392,"scale":0.9828037676609006},{"x":2967,"y":1387,"scale":1.6312835805031674},{"x":-870,"y":-2722,"scale":5.146354436984091},{"x":-3882,"y":-2113,"scale":1.4242028252671703},{"x":1760,"y":3035,"scale":3.078200463219831},{"x":-2536,"y":-2751,"scale":4.146822960950315},{"x":-1112,"y":4987,"scale":4.168431600738158},{"x":4089,"y":-1460,"scale":5.6968769382943},{"x":4538,"y":-2160,"scale":4.665268444073858},{"x":3481,"y":104,"scale":5.786239830509306},{"x":-4814,"y":-3473,"scale":2.0891359186819582},{"x":2420,"y":1788,"scale":4.76209653668534},{"x":-1336,"y":3439,"scale":2.5056955997239814},{"x":4148,"y":-2969,"scale":1.7006105212584117},{"x":-1877,"y":-2978,"scale":3.214194244312747},{"x":2957,"y":2743,"scale":5.242094098955434},{"x":-3665,"y":-1796,"scale":5.870903175396019},{"x":-3155,"y":-4103,"scale":4.7040859317396535},{"x":-275,"y":1143,"scale":0.9345727192672809},{"x":-2591,"y":-179,"scale":4.521963769865862},{"x":-1891,"y":4147,"scale":2.4216556466105827},{"x":4709,"y":-4660,"scale":2.0395420126678783},{"x":-4517,"y":3267,"scale":4.403447900659968},{"x":3180,"y":-3330,"scale":0.633100443913136},{"x":420,"y":2413,"scale":1.461954962788971},{"x":4439,"y":3786,"scale":3.279427956977667},{"x":-4474,"y":-2886,"scale":0.949853482533609},{"x":4152,"y":-3788,"scale":2.989201354033233},{"x":-3678,"y":4823,"scale":4.7631378910428825},{"x":34,"y":3726,"scale":2.4354564690458336},{"x":-542,"y":4756,"scale":5.292967059590144},{"x":2181,"y":2580,"scale":1.7060021966786183},{"x":-4050,"y":521,"scale":4.094720671332104},{"x":1464,"y":2629,"scale":3.944719882324202},{"x":-4999,"y":-3866,"scale":2.4075219630815727},{"x":690,"y":2927,"scale":5.77448991003374},{"x":-1731,"y":-3392,"scale":1.4812607613931497},{"x":3627,"y":-3730,"scale":4.550544754403616},{"x":716,"y":-1453,"scale":5.519934322128027},{"x":514,"y":-1718,"scale":4.779325264076828},{"x":-3032,"y":2841,"scale":1.4429520363092623},{"x":2527,"y":1173,"scale":0.8241652554616087},{"x":178,"y":-3021,"scale":1.8793541535327245},{"x":-4948,"y":-4703,"scale":5.245293043267495},{"x":-3491,"y":-2716,"scale":2.34559244789861},{"x":1546,"y":3618,"scale":5.87708738782078},{"x":1146,"y":-1183,"scale":2.363853890404907},{"x":732,"y":-1027,"scale":4.097212222563908},{"x":1859,"y":4272,"scale":2.8856718520464595},{"x":2005,"y":166,"scale":5.5744580874535234},{"x":-4484,"y":2723,"scale":5.543307630430695},{"x":2704,"y":-1963,"scale":5.791174796026748},{"x":35,"y":2890,"scale":4.528610731610717},{"x":368,"y":527,"scale":2.886635815977665},{"x":4815,"y":4612,"scale":4.234960132858208},{"x":1485,"y":-3207,"scale":4.24927333636527},{"x":115,"y":-3895,"scale":1.1562080686275507},{"x":2540,"y":-4753,"scale":4.111490415449373},{"x":-4454,"y":2664,"scale":5.960267031328298},{"x":4401,"y":-2928,"scale":5.3395063630290105},{"x":-3502,"y":-3041,"scale":5.4355637066728955},{"x":4610,"y":2808,"scale":4.629825556573753},{"x":-575,"y":174,"scale":2.7924582275842447},{"x":4902,"y":4136,"scale":0.6888610254385916},{"x":430,"y":3355,"scale":1.7947747849857607},{"x":-2527,"y":360,"scale":2.6663222344369686},{"x":729,"y":402,"scale":3.6688151954786425},{"x":-2626,"y":-4699,"scale":4.933755906406752},{"x":-983,"y":686,"scale":2.1650159358192056},{"x":3551,"y":3777,"scale":5.239340419649068},{"x":-964,"y":-3256,"scale":0.5963723908302623},{"x":2148,"y":-2335,"scale":1.921606755371145},{"x":-1826,"y":-2831,"scale":1.0502882880761668},{"x":2028,"y":-2825,"scale":0.9646150632108395},{"x":1268,"y":-3600,"scale":5.768529897685461},{"x":1764,"y":946,"scale":4.578098349465565},{"x":-3332,"y":-467,"scale":2.7311172166693893},{"x":746,"y":-2693,"scale":4.540028980947774},{"x":-1738,"y":-1516,"scale":0.9924386271496705},{"x":492,"y":4174,"scale":1.9428101543801122},{"x":-2504,"y":-2879,"scale":1.9845209441625427},{"x":-1247,"y":-3663,"scale":4.322809068821481},{"x":2449,"y":4613,"scale":5.750032193676873},{"x":272,"y":2125,"scale":2.36276140144028},{"x":1648,"y":-248,"scale":4.481632327305464},{"x":-1688,"y":-4109,"scale":4.466186211392431},{"x":-1407,"y":-271,"scale":4.222650240277734},{"x":-114,"y":4384,"scale":5.41321745730461},{"x":-4400,"y":2204,"scale":5.754873210501298},{"x":723,"y":-1669,"scale":4.229815099880819},{"x":4687,"y":2894,"scale":4.068449002562071},{"x":-52,"y":-4329,"scale":4.394241535681663},{"x":-2295,"y":-621,"scale":3.2213148035975494},{"x":1263,"y":-4304,"scale":2.495167207655329},{"x":-2594,"y":3279,"scale":5.734307961581981},{"x":2353,"y":14,"scale":2.6307331976392248},{"x":4297,"y":-3835,"scale":1.342504337046277},{"x":-1674,"y":4001,"scale":1.8847613007462658},{"x":3397,"y":-1593,"scale":5.884677189761501},{"x":-1465,"y":946,"scale":2.7828863990758337},{"x":-3551,"y":-1005,"scale":4.830689904960013},{"x":2516,"y":-1015,"scale":2.8871141957839503},{"x":-1983,"y":-1244,"scale":3.1025429736289034},{"x":-2408,"y":-997,"scale":3.0840129834687455},{"x":7,"y":-4100,"scale":1.261739179425124},{"x":2000,"y":4932,"scale":5.523989205525323},{"x":1726,"y":-3275,"scale":5.292224233360073},{"x":3799,"y":-148,"scale":5.609381726301383},{"x":4727,"y":2222,"scale":5.275064039526677},{"x":2062,"y":4702,"scale":5.94734380304151},{"x":3612,"y":3670,"scale":3.066751725226636},{"x":-2801,"y":-249,"scale":2.1642260875068824},{"x":363,"y":1691,"scale":2.3623306759197367},{"x":4906,"y":1010,"scale":3.4590175881744574},{"x":-3638,"y":537,"scale":4.845476052556885},{"x":-3006,"y":-73,"scale":4.074339575616278},{"x":1991,"y":3299,"scale":1.2062577022961962},{"x":-3234,"y":1155,"scale":1.2635873749413138},{"x":4597,"y":-226,"scale":2.944943244926828},{"x":4893,"y":-1061,"scale":5.986194217969594},{"x":-1461,"y":3628,"scale":3.2415984711784107},{"x":-1004,"y":3048,"scale":2.912989335425282},{"x":3799,"y":2555,"scale":5.732645040882218},{"x":4933,"y":-3884,"scale":5.047786899017882},{"x":3485,"y":4992,"scale":0.6040807645243129},{"x":4190,"y":-2438,"scale":1.592166932447345},{"x":-2213,"y":3737,"scale":5.648998148927161},{"x":-4157,"y":-4411,"scale":4.592406039771235},{"x":-4532,"y":-4687,"scale":5.872871860178833},{"x":2799,"y":-2396,"scale":3.3880545583666617},{"x":-1908,"y":-580,"scale":0.7372960018030585},{"x":4165,"y":1712,"scale":4.708527005621685},{"x":-1622,"y":-2064,"scale":1.0679558105101628},{"x":-4943,"y":210,"scale":4.18273592190283},{"x":3319,"y":214,"scale":2.1884839138456984},{"x":1577,"y":-1538,"scale":5.7253654700481516},{"x":-2629,"y":-797,"scale":4.9912358977392},{"x":-2490,"y":2372,"scale":0.8292259854081757},{"x":-3668,"y":4706,"scale":3.6050942671128743},{"x":-3306,"y":-3063,"scale":1.2856858779074845},{"x":-1595,"y":1760,"scale":4.084640145034314},{"x":4548,"y":2451,"scale":5.301588382575768},{"x":-1799,"y":-1758,"scale":4.384158839617258},{"x":-2620,"y":3889,"scale":2.9869709264400814},{"x":-4063,"y":-551,"scale":4.011322779054609}]}');class ln extends Phaser.Scene{constructor(t){super(),this.callback=t}preload(){window.onbeforeunload=function(t){return t.preventDefault(),"You are in game.. Do you really want to leave?"};try{document.getElementsByClassName("grecaptcha-badge")[0].style.opacity=0}catch(t){console.log(t)}this.ready=!1,this.loadrect=this.add.image(0,0,"opening").setOrigin(0).setScrollFactor(0,0).setScale(2).setDepth(200);const t=this.cameras.main.width,e=this.cameras.main.height;this.loadrect.setScale(Math.max(t/this.loadrect.width,e/this.loadrect.height)),this.loadrect.x=0-(this.loadrect.displayWidth-t)/2,this.loadtext=this.add.text(this.canvas.width/2,this.canvas.height/2,"Connecting...",{fontFamily:"Arial",fontSize:"32px",color:"#ffffff"}).setOrigin(.5).setScrollFactor(0,0).setDepth(200),this.ping=0}create(){this.levels=[],grecaptcha.ready((()=>{grecaptcha.execute(n.i,{action:"join"}).then((e=>{this.readyt=!0,this.openingBgm.stop();var i={mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!1,delay:0};"normal"==this.options.sound?i.volume=.5:"high"==this.options.sound?i.volume=1:"low"==this.options.sound?i.volume=.2:"off"==this.options.sound?i.volume=0:i.volume=.5,this.coin=this.sound.add("coin",i),this.chestOpen=this.sound.add("chestOpen",i),this.damage=this.sound.add("damage",i),this.hit=this.sound.add("hit",i),this.winSound=this.sound.add("winSound",i),this.loseSound=this.sound.add("loseSound",i),this.tps=0,this.background=this.add.tileSprite(0,0,this.canvas.width,this.canvas.height,"background").setOrigin(0).setDepth(2),this.background.fixedToCamera=!0,this.meSword=this.add.image(400,100,"sword").setScale(.25).setDepth(50).setAlpha(.5),this.mePlayer=this.add.image(400,100,"player").setScale(.25).setDepth(51).setAlpha(.5),this.meChat=this.add.text(0,0,"",{fontFamily:"Georgia"}).setOrigin(.5).setDepth(71),this.meChatTween=void 0,this.swordAnim={go:!1,added:0},this.myObj=void 0;try{this.killCount=this.add.rexBBCodeText(15,10,"Stabs: 0",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'}).setFontSize(40).setDepth(101),this.killCount.addImage("coin",{key:"coin",width:45,height:45}),this.killCount.addImage("kill",{key:"kill",width:45,height:45}),this.killCount.setScrollFactor(0),this.playerCount=this.add.text(0,0,"Players: 0"+(this.mobile?"":"\nFPS: 0\nTPS: 0\nPing: 0 ms"),{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif',align:"right"}).setFontSize(20).setDepth(101).setOrigin(1),this.playerCount.setScrollFactor(1),this.leaderboard=this.add.rexBBCodeText(0,10,"",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'}).setFontSize(20).setDepth(101),this.leaderboard.setScrollFactor(0)}catch(t){console.log(t)}const s=(t,e,i)=>i*e/t;this.miniMap={people:[],scaleFactor:s(1189,96,this.canvas.width),square:void 0},this.miniGraphics=this.add.graphics().setDepth(100);var r=13;this.miniMap.scaleFactor=s(1189,96,this.canvas.width),this.miniGraphics.x=this.canvas.width-(2*this.miniMap.scaleFactor+r),this.miniGraphics.y=this.canvas.height-(2*this.miniMap.scaleFactor+r),this.miniGraphics.lineStyle(5,16776960,1),this.miniGraphics.strokeRoundedRect(0,0,2*this.miniMap.scaleFactor,2*this.miniMap.scaleFactor,0),this.cameras.main.ignore(this.miniGraphics),this.mobile&&"keys"==this.options.movementMode&&(this.joyStick=this.plugins.get("rexvirtualjoystickplugin").add(this,{x:this.canvas.width/6,y:this.canvas.height-this.canvas.height/2.5,radius:s(2360,250,this.canvas.width),base:this.add.circle(0,0,s(2360,250,this.canvas.width),8947848),thumb:this.add.circle(0,0,s(2360,100,this.canvas.width),13421772)}),this.cameras.main.ignore(this.joyStick.base),this.cameras.main.ignore(this.joyStick.thumb)),this.meBar=new a(this,0,0,16,80),this.meBar.bar.setAlpha(.5),this.meBar.bar.setDepth(71),this.lvlBar=new a(this,0,0,0,0,!0),r=this.canvas.width/2,this.lvlBar.x=r/2,this.lastKill=Date.now(),this.streak=0,this.killtxts=[],this.lvlBar.width=this.canvas.width-r,this.lvlBar.height=this.canvas.height/30,this.lvlBar.y=this.canvas.height-this.lvlBar.height-this.canvas.height/40,this.lvlBar.draw(),this.chat={obj:null,toggled:!1,btn:new t(this,0,0,"chatbtn",(()=>{if(!this.loadtext.visible&&(this.chat.toggled=!this.chat.toggled,this.spectating&&this.deadText.visible&&(this.callback(),this.socket.disconnect(),this.scene.start("title")),!this.spectating))if(this.chat.toggled){if(this.chat.obj=this.add.dom(this.canvas.width/2,this.canvas.height/2-this.canvas.height/5).createFromCache("chat"),this.chat.obj.getChildByID("chat").focus(),on?tn():sn){const t=cn((e=>{"hidden"===e&&(this.chat.toggled=!1,this.chat.obj.destroy(),t())}))}}else if(this.chat.obj){var t=this.chat.obj.getChildByID("chat").value.trim();t.length>0&&this.socket.emit("chat",t),this.chat.obj.destroy()}}))},this.chat.btn.btn.setScale(Math.min(this.canvas.height/1e3,this.canvas.width/1500)),this.chat.btn.btn.x=this.killCount.width,this.mobile?this.cameras.main.ignore(this.chat.btn.btn):this.chat.btn.destroy(),this.coins=[],this.chests=[],this.enemies=[],this.dead=!1,this.spectating=!1;var o=Phaser.Input.Keyboard.KeyCodes;this.cursors=this.input.keyboard.addKeys({up:o.UP,down:o.DOWN,left:o.LEFT,right:o.RIGHT,enter:o.ENTER,esc:o.ESC},!1),this.cursors.esc.on("down",(()=>{this.chat.toggled&&(this.chat.obj.destroy(),this.chat.toggled=!1)})),this.cursors.enter.on("down",(()=>{if(!this.loadtext.visible&&(this.chat.toggled=!this.chat.toggled,this.spectating&&this.deadText.visible&&(this.callback(),this.socket.disconnect(),this.scene.start("title")),!this.spectating))if(this.chat.toggled)this.chat.obj=this.add.dom(this.canvas.width/2,this.canvas.height/2-this.canvas.height/5).createFromCache("chat"),this.chat.obj.getChildByID("chat").focus();else if(this.chat.obj){var t=this.chat.obj.getChildByID("chat").value.trim();t.length>0&&this.socket.emit("chat",t),this.chat.obj.destroy()}}));try{this.lvlText=this.add.text(this.canvas.width/2,this.canvas.height/5,"",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'}).setFontSize(s(1366,75,this.canvas.width)).setDepth(75).setAlpha(0).setOrigin(.5),this.lvlTextTween=void 0,this.lvlState=this.add.text(this.canvas.width/2,this.lvlBar.y-this.lvlBar.height,"",{fontFamily:'Georgia, "Goudy Bookletter 1911", Times, serif'}).setFontSize(s(1366,50,this.canvas.width)).setDepth(75).setAlpha(1).setOrigin(.5),this.lvlState.y=this.lvlBar.y-this.lvlState.height/2}catch(t){console.log(t)}this.cameras.main.setZoom(1),this.UICam=this.cameras.add(this.cameras.main.x,this.cameras.main.y,this.canvas.width,this.canvas.height),this.cameras.main.ignore([this.killCount,this.playerCount,this.leaderboard,this.lvlBar.bar,this.lvlText,this.lvlState]),this.UICam.ignore([this.mePlayer,this.meBar.bar,this.meSword,this.background,this.meChat]),this.cameras.main.startFollow(this.mePlayer,!0),this.bushes=[],un.K.forEach(((t,e)=>{e%2!=0&&(this.bushes.push(this.add.image(t.x,t.y,"bush").setScale(t.scale).setDepth(70)),this.UICam.ignore(this.bushes[this.bushes.length-1]))})),this.input.addPointer(3);const h=()=>{if(this.scene.isActive("game"))try{this.game.scale.resize(this.canvas.width,this.canvas.height),this.lvlText.y=this.canvas.height/5,this.lvlText.x=this.canvas.width/2,this.mobile&&"keys"==this.options.movementMode&&(this.joyStick.x=this.canvas.width/8,this.joyStick.y=this.canvas.height-this.canvas.height/2.5,this.joyStick.base.radius=s(2360,250,this.canvas.width),this.joyStick.thumb.radius=s(2360,100,this.canvas.width),this.joyStick.radius=s(2360,250,this.canvas.width)),this.UICam.x=this.cameras.main.x,this.UICam.y=this.cameras.main.y,this.chat.btn.btn.setScale(Math.min(this.canvas.height/1e3,this.canvas.width/1500)),this.chat.btn.btn.x=this.killCount.width,this.miniGraphics.clear();var e=13;if(this.miniMap.scaleFactor=s(1189,96,this.canvas.width),this.miniGraphics.x=this.canvas.width-(2*this.miniMap.scaleFactor+e),this.miniGraphics.y=this.canvas.height-(2*this.miniMap.scaleFactor+e),this.miniGraphics.lineStyle(5,16776960,1),this.miniGraphics.strokeRoundedRect(0,0,2*this.miniMap.scaleFactor,2*this.miniMap.scaleFactor,0),this.background.width=this.canvas.width,this.background.height=this.canvas.height,e=this.canvas.width/2,this.spectating){function r(t){parseInt(t%1e3/100);var e=Math.floor(t/1e3%60),i=Math.floor(t/6e4%60),s=Math.floor(t/36e5%24);return("00"==s?"":s+"h ")+("00"==i?"":i+"m ")+e+"s"}this.deathRect.destroy(),this.deathRect=this.add.rectangle(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2,this.canvas.height/1.5,9498256),this.deadText.destroy(),this.deadText=this.add.text(this.canvas.width/2,this.deathRect.y-this.deathRect.height/2,"You got stabbed",{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.deadText.setFontSize(Math.min(this.canvas.width/25,this.canvas.height/20)),this.deadText.y+=this.deadText.height;var i=["Nooooooooo","Rest in peace","You can do better!","Practice makes perfect!","Keep trying!"],n=i[Math.floor(Math.random()*i.length)];this.dataText.destroy(),this.dataText=this.add.text(this.canvas.width/2,this.deadText.y,n,{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.dataText.setFontSize(Math.min(this.canvas.width/40,this.canvas.height/30)),this.dataText.y+=1.5*this.dataText.height,this.statsText.destroy(),this.statsText=this.add.text(this.canvas.width/2,this.dataText.y,"Stabbed By: "+this.dtas.killedBy+"\nCoins: "+this.myObj.coins+"\nKills: "+this.myObj.kills+"\nSurvived: "+r(this.dtas.timeSurvived),{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.statsText.setFontSize(Math.min(this.canvas.width/35,this.canvas.height/25)),this.statsText.y+=this.statsText.height,this.playAgain.destroy(),this.playAgain=new t(this,0,0,"playAgainBtn",(()=>{this.callback(),this.socket.disconnect(),this.scene.start("title")})),this.playAgain.btn.setScale(Math.min(this.canvas.width/6533.33333333,this.canvas.height/5532.33333333)),this.playAgain.btn.y=this.statsText.y+this.statsText.displayHeight,this.playAgain.btn.x=this.canvas.width/2,this.playAgain.btn.x-=this.playAgain.btn.displayWidth/2}if(this.spectating)return;this.lvlBar.x=e/2,this.lvlBar.width=this.canvas.width-e,this.lvlBar.height=this.canvas.height/30,this.lvlBar.y=this.canvas.height-this.lvlBar.height-this.canvas.height/40,this.lvlBar.draw(),this.lvlState.x=this.canvas.width/2,this.lvlState.setFontSize(s(1366,50,this.canvas.width)),this.lvlState.y=this.lvlBar.y-this.lvlState.height/2,this.playerCount.x=this.miniGraphics.x+2*this.miniMap.scaleFactor,this.playerCount.y=this.canvas.height-2*this.miniMap.scaleFactor-17,this.lvlText.setFontSize(s(1366,75,this.canvas.width))}catch(o){console.log(o)}};var c;window.addEventListener("resize",(function(){clearTimeout(c),c=setTimeout(h,100)}));var u="us1"==this.options.server?"https://us2.swordbattle.io":"us2"==this.options.server?"https://sword-io-game.herokuapp.com":"https://swordbattle.herokuapp.com";this.socket=io(n.c?void 0:u,{closeOnBeforeunload:!1,transports:["websocket"]});var l=!1;function d(t){l||(console.log(t),document.write('<b>Failed to contact the server, try a different server from settings (bottom left)</b><br><br><button onclick="location.reload()"><h1>Refresh</h1></button>'),l=!0)}this.socket.on("connect_error",d),this.socket.on("connect_failed",d),this.secret?this.socket.emit("go",this.secret,e,!0,this.options):this.socket.emit("go",this.name,e,!1,this.options);const p=t=>{this.mobile&&this.joyStick&&this.joyStick.pointer&&this.joyStick.pointer.id==t.id||this.mouseDown||(t&&(this.gamePoint={x:t.x,y:t.y}),this.mouseDown=!0,this.socket.emit("mouseDown",!0))},f=t=>{this.mobile&&this.joyStick&&this.joyStick.pointer&&this.joyStick.pointer.id==t.id||this.mouseDown&&(t&&(this.gamePoint={x:t.x,y:t.y}),this.mouseDown=!1,this.socket.emit("mouseDown",!1))};this.input.keyboard.on("keydown-SPACE",(()=>{this.chat.toggled||p()}),this),this.input.keyboard.on("keyup-SPACE",(()=>{f()}),this),this.input.on("pointerdown",(function(t){p(t)}),this),this.input.on("pointerup",(function(t){f(t)}),this),this.mobile&&(this.gamePoint={x:0,y:0},this.input.on("pointermove",(t=>{this.joyStick.pointer&&this.joyStick.pointer.id==t.id||(this.gamePoint={x:t.x,y:t.y})}))),this.socket.on("tps",(t=>{this.tps=t;var e=Date.now();this.socket.emit("ping",(()=>{this.ping=Date.now()-e}))})),this.socket.on("ban",(t=>{l=!0,document.write(t)})),this.graphics=this.add.graphics().setDepth(4);this.graphics.lineStyle(5e3,25600,1),this.graphics.strokeRoundedRect(-7500,-7500,15e3,15e3,0),this.graphics.lineStyle(10,16776960,1),this.graphics.strokeRoundedRect(-5e3,-5e3,1e4,1e4,0),this.socket.on("levels",(t=>this.levels=t));const m=t=>{if(!(this.enemies.filter((e=>e.id===t.id)).length>0)){var e={id:t.id,down:!1,playerObj:void 0,lastTick:Date.now(),sword:this.add.image(t.pos.x,t.pos.y,t.skin+"Sword").setScale(.25).setDepth(49),player:this.add.image(t.pos.x,t.pos.y,t.skin+"Player").setScale(.25).setDepth(49),bar:new a(this,t.pos.x,t.pos.y+55),nameTag:this.add.rexBBCodeText(t.pos.x,t.pos.y-90,`${t.name}`,{fontFamily:"serif",fill:t.verified?"mitblade"==t.name.toLowerCase()||"codergautam"==t.name.toLowerCase()?"#FF0000":"#0000FF":"#000000",fontSize:"25px"}).setDepth(69).setAlpha(t.verified?1:.5),swordAnim:{go:!1,added:0},toAngle:0,chatText:this.add.text(0,0,"",{fontFamily:"Georgia"}).setDepth(71).setOrigin(.5),chatTween:void 0},i=100/(100*t.scale)*1.5;e.sword.angle=180*Math.atan2(t.mousePos.y-t.mousePos.viewport.height/2,t.mousePos.x-t.mousePos.viewport.width/2)/Math.PI+45,e.sword.x=e.player.x+e.player.width/i*Math.cos(e.sword.angle*Math.PI/180),e.sword.y=e.player.y+e.player.width/i*Math.sin(e.sword.angle*Math.PI/180),e.bar.bar.setDepth(69),this.UICam.ignore([e.player,e.bar.bar,e.sword,e.nameTag,e.chatText,this.graphics]),this.enemies.push(e);var s=this.add.circle(0,0,10,16711680);this.cameras.main.ignore(s),s.setDepth(98),this.miniMap.people.push({id:t.id,circle:s}),Date.now()-t.joinTime<5e3&&(e.player.setAlpha(.5),e.sword.setAlpha(.5),e.bar.bar.setAlpha(.5),setTimeout((()=>{this.tweens.add({targets:[e.player,e.sword,e.bar.bar],alpha:1,duration:100,ease:"Linear",repeat:0,yoyo:!1})}),5e3-(Date.now()-t.joinTime)))}};this.removePlayer=t=>{try{var e=this.enemies.find((e=>e.id==t));this.tweens.add({targets:[e.player,e.nameTag,e.bar.bar,e.sword],alpha:0,duration:150,ease:"Sine2",onComplete:()=>{e.player.destroy(),this.enemies.splice(this.enemies.findIndex((e=>e.id==t)),1),e.bar.destroy(),e.nameTag.destroy(),e.sword.destroy(),this.spectating||(this.miniMap.people.find((e=>e.id===t)).circle.destroy(),this.miniMap.people=this.miniMap.people.filter((e=>e.id!=t)))}})}catch(t){console.log(t)}},this.socket.on("players",(t=>{t.forEach((t=>m(t))),this.ready=!0,this.ready||(this.ready=!0)})),this.socket.on("new",(t=>{m(t),this.ready||(this.ready=!0)})),this.socket.on("me",(t=>{if(this.loadrect.visible&&this.loadrect.destroy(),this.loadtext.visible&&this.loadtext.destroy(),this.levels.length>0)if(t.level>=this.levels.length-1)this.lvlState.setText("Max Level"),this.lvlBar.setLerpValue(100);else{var e=this.levels[t.level-1].coins-this.levels[t.level-1].start,i=t.coins-this.levels[t.level-1].start;this.lvlBar.setLerpValue(i/e*100),this.lvlState.setText("Level: "+t.level+" ("+Math.round(i/e*100)+"%)"),this.myObj&&t.level>this.myObj.level&&(this.lvlTextTween&&this.lvlTextTween.stop(),this.lvlText.data||this.lvlText.setData("x",0),this.lvlText.setData("x",this.lvlText.getData("x")+(t.level-this.myObj.level)),this.lvlText.setText("Level up!"+(this.lvlText.getData("x")>1?` x${this.lvlText.getData("x")}`:"")),this.lvlTextTween=this.tweens.add({targets:this.lvlText,alpha:1,y:this.canvas.height/4,completeDelay:1e3,duration:500,onComplete:()=>{this.lvlTextTween=this.tweens.add({targets:this.lvlText,alpha:0,y:this.canvas.height/5,onComplete:()=>this.lvlText.setData("x",0),duration:300,ease:"Power2"},this)},ease:"Power2"},this))}this.spectating||this.mePlayer.texture.key+"Player"==t.skin||(this.mePlayer.setTexture(t.skin+"Player"),this.meSword.setTexture(t.skin+"Sword")),this.myObj?this.tweens.add({targets:this.mePlayer,x:t.pos.x,y:t.pos.y,duration:300,ease:"Power2"}):(this.mePlayer.x=t.pos.x,this.mePlayer.y=t.pos.y),this.mePlayer.setScale(t.scale),this.meBar.maxValue=t.maxHealth,this.meBar.setHealth(t.health);var n=1e3;n+=this.mePlayer.width*this.mePlayer.scale*5;var r=Math.max(this.scale.width/n,this.scale.height/n);if(this.cameras.main.setZoom(r),this.meSword.setScale(t.scale),this.background.setTileScale(this.cameras.main.zoom,this.cameras.main.zoom),this.background.displayWidth=this.cameras.main.displayWidth,this.background.displayHeight=this.cameras.main.displayHeight,this.killCount.setText("[img=kill] "+t.kills+"\n[img=coin] "+t.coins),this.myObj=t,!this.miniMap.people.find((e=>e.id===t.id))){var o=this.add.circle(0,0,10,16777215);this.cameras.main.ignore(o),o.setDepth(99),this.miniMap.people.push({id:t.id,circle:o})}if(!this.spectating){var a=this.miniMap.people.find((e=>e.id===t.id));a.circle.x=this.miniGraphics.x+t.pos.x/5e3*this.miniMap.scaleFactor+this.miniMap.scaleFactor,a.circle.y=this.miniGraphics.y+t.pos.y/5e3*this.miniMap.scaleFactor+this.miniMap.scaleFactor,a.circle.radius=t.scale*(s(1280,15,this.canvas.width)/1)}})),this.socket.on("player",(t=>{if(this.ready)try{var e=this.enemies.find((e=>e.id==t.id));if(!e)return;e.lastTick=Date.now(),e.playerObj=t,e.bar.maxValue=t.maxHealth,e.bar.setHealth(t.health),this.tweens.add({targets:e.player,x:t.pos.x,y:t.pos.y,duration:300,ease:"Power2"});var i=t.mousePos;if(e.toAngle=180*Math.atan2(i.y-i.viewport.height/2,i.x-i.viewport.width/2)/Math.PI+45,e.player.setScale(t.scale),e.sword.setScale(t.scale),e.down=t.mouseDown,this.spectating)return;var n=this.miniMap.people.find((e=>e.id===t.id));n.circle.x=this.miniGraphics.x+t.pos.x/5e3*this.miniMap.scaleFactor+this.miniMap.scaleFactor,n.circle.y=this.miniGraphics.y+t.pos.y/5e3*this.miniMap.scaleFactor+this.miniMap.scaleFactor,n.circle.radius=t.scale*(s(1280,15,this.canvas.width)/1)}catch(t){console.log(t)}})),this.socket.on("chat",(t=>{if(this.myObj)if(t.id==this.myObj.id)this.meChat.setText(t.msg),this.meChat.setAlpha(0),this.meChatTween&&this.meChatTween.stop(),this.meChatTween=this.tweens.add({targets:this.meChat,duration:200,alpha:1,completeDelay:2e3,onComplete:()=>{this.meChatTween=this.tweens.add({targets:this.meChat,duration:200,alpha:0,onComplete:()=>{this.meChat.setText("")}})},ease:"Power2"});else{var e=this.enemies.find((e=>e.id==t.id));if(!e)return;e.chatText.setText(t.msg),e.chatText.setAlpha(0),e.chatTween&&e.chatTween.stop(),e.chatTween=this.tweens.add({targets:e.chatText,duration:200,alpha:1,completeDelay:2e3,onComplete:()=>{e.chatTween=this.tweens.add({targets:e.chatText,duration:200,alpha:0,onComplete:()=>{e.chatText.setText("")}})}})}})),this.socket.on("playerLeave",this.removePlayer),this.socket.on("playerDied",((t,e)=>{if(this.myObj&&this.myObj.id===e.killedBy.id){var i=this.enemies.find((e=>e.id==t));if(i&&i.playerObj){var n=s(1366,64,this.canvas.width);if(Date.now()-this.lastKill<2500){this.streak++;var r="[b]",o=["Double","Triple","Quadra","Quinta","Hexta","Hepta","Octa","Nona","Deca"];this.streak-1>o.length?r+=`x${this.streak}`:r+=o[this.streak-1],r+=" Kill![/b]",this.killtxts.forEach((t=>{t.destroy()})),this.killtxts=[]}else this.streak=0,r=`[b][color=#e82a1f]Stabbed [/color][color=#0000FF]${i.playerObj.name}[/color][/b]`;var a=this.add.rexBBCodeText(this.canvas.width/2,this.canvas.height,r).setOrigin(.5).setAlpha(0).setFontSize(n);a.setData("index",this.killtxts.length),this.killtxts.push(a);const t=t=>{this.tweens.add({targets:t,alpha:0,y:this.canvas.height,onComplete:()=>{this.killtxts.slice(t.getData("index"),1),t.destroy()},ease:"Power2",duration:250})};this.tweens.add({targets:a,alpha:1,y:this.canvas.height-this.canvas.height/6,completeDelay:250,duration:750,onComplete:()=>t(a),ease:"Bounce"},this),this.cameras.main.ignore(a)}this.lastKill=Date.now()}this.removePlayer(t)})),this.socket.on("dealHit",((t,e)=>{var i=this.enemies.find((e=>e.id==t));if(i&&this.sys.game.loop.actualFps>=30){var s=this.add.particles("hitParticle"),n=s.createEmitter({maxParticles:5,scale:.01});n.setPosition(e?e.x:i.player.x,e?e.y:i.player.y),this.UICam.ignore(s),n.setSpeed(200),s.setDepth(105),n.setBlendMode(Phaser.BlendModes.ADD)}this.hit.play()})),this.socket.on("takeHit",((t,e)=>{if(!(this.sys.game.loop.actualFps<30)){this.damage.play();var i=this.add.particles("hitParticle"),s=i.createEmitter({maxParticles:5,scale:.01});s.setPosition(this.mePlayer.x,this.mePlayer.y),this.UICam.ignore(i),s.setSpeed(200),i.setDepth(105)}}));const y=(t,e)=>{if(!this.dead){var i=!0;e||(e=[t.pos.x,t.pos.y],i=!1),this.coins.push({id:t.id,item:this.add.image(e[0],e[1],"coin").setScale(t.size/100).setDepth(20).setAlpha(i?0:1),state:{collected:!1,collectedBy:void 0,time:0}}),i&&this.tweens.add({targets:this.coins[this.coins.length-1].item,alpha:1,x:t.pos.x,y:t.pos.y,duration:250,ease:"Sine2"}),this.UICam.ignore(this.coins[this.coins.length-1].item)}},g=(t,e)=>{if(!this.dead){var i=!0;e||(e=[t.pos.x,t.pos.y],i=!1),this.chests.push({id:t.id,item:this.add.image(e[0],e[1],"chest").setScale(t.scale).setDepth(21).setAlpha(i?0:1).setOrigin(0)}),i&&this.tweens.add({targets:this.chests[this.chests.length-1].item,alpha:1,x:t.pos.x,y:t.pos.y,duration:250,ease:"Sine2"}),this.UICam.ignore(this.chests[this.chests.length-1].item)}};this.socket.on("coins",(t=>{t.forEach((t=>{0==this.coins.filter((e=>e.id==t.id)).length&&y(t)})),this.coins.filter((e=>0==t.filter((t=>e.id==t.id&&!e.state.collected)).length)).forEach((t=>{t.item.destroy()})),this.coins=this.coins.filter((e=>1==t.filter((t=>e.id==t.id&&!e.state.collected)).length))})),this.socket.on("coin",((t,e)=>{Array.isArray(t)?e?t.forEach((t=>{y(t,e)})):t.forEach((t=>{y(t)})):y(t)})),this.socket.on("chests",(t=>{t.forEach((t=>{0==this.chests.filter((e=>e.id==t.id)).length&&g(t)})),this.chests.filter((e=>0==t.filter((t=>e.id==t.id)).length)).forEach((t=>{t.item.destroy()})),this.chests=this.chests.filter((e=>1==t.filter((t=>e.id==t.id)).length))})),this.socket.on("chest",((t,e)=>{Array.isArray(t)?e?t.forEach((t=>{g(t,e)})):t.forEach((t=>{g(t)})):g(t)})),this.socket.on("youDied",(e=>{this.dtas={killedBy:e.killedBy,timeSurvived:e.timeSurvived},this.spectating=!0,this.mePlayer.destroy(),this.meBar.destroy(),this.meSword.destroy(),this.lvlBar.destroy(),this.lvlState.destroy(),this.killCount.destroy(),this.leaderboard.destroy(),this.miniGraphics.destroy(),this.playerCount.destroy(),this.chat.obj&&this.chat.obj.destroy(),this.mobile&&(this.joyStick.destroy(),this.chat.btn.destroy()),this.miniMap.people.forEach((t=>{t.circle.destroy()})),this.miniMap.people=[],this.time.delayedCall(1500,(()=>{this.deathRect=this.add.rectangle(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2,this.canvas.height/1.5,9498256).setAlpha(0),this.cameras.main.ignore(this.deathRect),this.tweens.add({targets:this.deathRect,alpha:1,duration:250,ease:"Sine2",onComplete:()=>{window.onbeforeunload=()=>{},this.deadText=this.add.text(this.canvas.width/2,this.deathRect.y-this.deathRect.height/2,"You got stabbed",{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.cameras.main.ignore(this.deadText),this.deadText.setFontSize(Math.min(this.canvas.width/25,this.canvas.height/20)),this.deadText.y+=this.deadText.height;var i=["Nooooooooo","Rest in peace","You can do better!","Practice makes perfect!","Keep trying!"],s=i[Math.floor(Math.random()*i.length)];this.dataText=this.add.text(this.canvas.width/2,this.deadText.y,s,{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.dataText.setFontSize(Math.min(this.canvas.width/40,this.canvas.height/30)),this.dataText.y+=1.5*this.dataText.height,this.cameras.main.ignore(this.dataText),this.statsText=this.add.text(this.canvas.width/2,this.dataText.y,"Stabbed By: "+e.killedBy+"\nCoins: 0\nKills: 0\nSurvived: 0s",{fontFamily:"Arial",fontSize:"32px",color:"#000000"}).setOrigin(.5),this.statsText.setFontSize(Math.min(this.canvas.width/35,this.canvas.height/25)),this.statsText.y+=this.statsText.height,this.cameras.main.ignore(this.statsText),this.playAgain=new t(this,0,0,"playAgainBtn",(()=>{this.callback(),this.socket.disconnect(),this.scene.start("title")})),this.playAgain.btn.setScale(Math.min(this.canvas.width/6533.33333333,this.canvas.height/5532.33333333)),this.cameras.main.ignore(this.playAgain.btn),this.playAgain.btn.y=this.statsText.y+this.statsText.displayHeight,this.playAgain.btn.x=this.canvas.width/2,this.playAgain.btn.x-=this.playAgain.btn.displayWidth/2,this.tweens.addCounter({from:0,to:100,duration:1e3,onUpdate:t=>{var i=Math.round(this.myObj.coins*(t.getValue()/100)),s=Math.round(this.myObj.kills*(t.getValue()/100)),n=Math.round(e.timeSurvived*(t.getValue()/100));this.statsText.setText("Stabbed By: "+e.killedBy+"\nCoins: "+i+"\nKills: "+s+"\nSurvived: "+function(t){parseInt(t%1e3/100);var e=Math.floor(t/1e3%60),i=Math.floor(t/6e4%60),s=Math.floor(t/36e5%24);return("00"==s?"":s+"h ")+("00"==i?"":i+"m ")+e+"s"}(n))}})}})}))})),this.socket.on("youWon",(t=>{this.win(t)})),this.socket.on("collected",((t,e,i)=>{this.myObj&&this.myObj.id==e&&(i?this.coin:this.chestOpen).play(),this.coins.find((e=>e.id==t))?this.coins.find((e=>e.id==t)).state={collected:!0,collectedBy:e,time:0}:this.chests.find((e=>e.id==t))&&(this.sys.game.loop.actualFps<30?this.chests.find((e=>e.id==t)).item.destroy():this.tweens.add({targets:this.chests.find((e=>e.id==t)).item,alpha:0,duration:500,ease:"Sine2",onComplete:t=>{t.targets[0].destroy()}}))})),this.playerCount.x=this.miniGraphics.x+2*this.miniMap.scaleFactor,this.playerCount.y=this.canvas.height-2*this.miniMap.scaleFactor-17,setTimeout((()=>{this.tweens.add({targets:[this.mePlayer,this.meSword,this.meBar.bar],alpha:1,duration:100,ease:"Linear",repeat:0,yoyo:!1})}),5e3)})).catch((t=>{console.log(t)}))}))}update(t,e){if(this.readyt){try{this.lvlBar.update()}catch(t){console.log("Failed to update level bar"),console.log(t)}var i={left:!1,up:!1,right:!1,down:!1},s=this.input.keyboard.addKey("W",!1),n=this.input.keyboard.addKey("A",!1),r=this.input.keyboard.addKey("S",!1),o=this.input.keyboard.addKey("D",!1);try{this.key=this.mobile&&this.joyStick?this.joyStick.createCursorKeys():this.cursors,(this.key.up.isDown||s.isDown)&&(i.up=!0),(this.key.down.isDown||r.isDown)&&(i.down=!0),(this.key.right.isDown||o.isDown)&&(i.right=!0),(this.key.left.isDown||n.isDown)&&(i.left=!0),this.socket.emit("move",i)}catch(t){console.log(t)}if(this.meSword)var a=this.meSword.angle;if(this.mobile)h=this.gamePoint;else var h=this.input;this.meSword.angle=180*Math.atan2(h.y-this.canvas.height/2,h.x-this.canvas.width/2)/Math.PI+45,this.mePlayer.angle=this.meSword.angle+45+180;var c=this.myObj?this.myObj.damageCooldown:120;this.mouseDown&&!this.swordAnim.go&&0==this.swordAnim.added?(this.swordAnim.go=!0,this.tweens.addCounter({from:0,to:50,duration:c/2,onUpdate:t=>{this.swordAnim.added=t.getValue()},onComplete:()=>{this.swordAnim.go=!1}})):!this.swordAnim.go&&!this.mouseDown&&this.swordAnim.added>0&&(this.swordAnim.go=!0,this.tweens.addCounter({from:50,to:0,duration:c/2,onUpdate:t=>{this.swordAnim.added=t.getValue()},onComplete:()=>{this.swordAnim.go=!1}})),this.meSword.angle-=this.swordAnim.added;var u={viewport:{width:this.canvas.width,height:this.canvas.height},x:h.x,y:h.y};this.socket&&a&&this.meSword.angle!=a&&this.socket.emit("mousePos",u);var l=this.sys.game.loop.actualFps;this.enemies.forEach((t=>{if(Date.now()-t.lastTick>1e4)return this.removePlayer(t);if(t.playerObj)var i=t.playerObj.scale;else i=.25;t.bar.width=t.player.height*i/.9375,t.bar.height=t.player.height*i*.15,t.bar.x=t.player.x-t.bar.width/2,t.bar.y=t.player.y-t.player.height*i/1.2,t.bar.draw();try{t.nameTag.setFontSize(100*i),t.nameTag.x=t.player.x-t.nameTag.width/2,t.nameTag.y=t.player.y-t.player.height*i-t.nameTag.height}catch(t){console.log(t)}try{t.playerObj&&t.chatText.setFontSize(100*t.playerObj.scale),t.chatText.x=t.player.x,t.chatText.y=t.nameTag.y-t.bar.height}catch(t){console.log(t)}if(t.playerObj)var s=100/(100*t.playerObj.scale)*1.5;else s=6;if(t.sword.angle=function(t,e,i){const s=function(t,e){return i=t-Math.floor(t/e)*e,s=e,Math.min(Math.max(i,0),s);var i,s}(e-t,360);return b(t,t+(s>180?s-360:s),.5)}(t.sword.angle,t.toAngle),t.player.angle=t.sword.angle+45+180,t.down?(t.swordAnim.added||(t.swordAnim.added=0),t.swordAnim.added<=0&&(t.swordAnim.go=!0)):t.swordAnim.added>=50&&(t.swordAnim.go=!1),t.swordAnim.go&&t.swordAnim.added<50){var n=50/t.playerObj.damageCooldown*e*2;t.swordAnim.added<50&&(t.swordAnim.added+=n)}!t.swordAnim.go&&t.swordAnim.added>0&&(t.swordAnim.added-=10),t.sword.angle-=t.swordAnim.added,t.sword.x=t.player.x+t.player.width/s*Math.cos(t.sword.angle*Math.PI/180),t.sword.y=t.player.y+t.player.width/s*Math.sin(t.sword.angle*Math.PI/180)}));var d=this.myObj;d||(d={scale:.25});try{if(this.meBar.width=this.mePlayer.height*d.scale/.9375,this.meBar.height=this.mePlayer.height*d.scale*.2,this.meBar.x=this.mePlayer.x-this.meBar.width/2,this.meBar.y=this.mePlayer.y-this.mePlayer.height*d.scale/1.2,this.myObj&&this.meChat.setFontSize(100*this.myObj.scale),this.meChat.x=this.mePlayer.x,this.meChat.y=this.meBar.y-this.meBar.height,this.meBar.draw(),this.myObj)var p=100/(100*this.myObj.scale)*1.5;else p=6;this.meSword.x=this.mePlayer.x+this.mePlayer.width/p*Math.cos(this.meSword.angle*Math.PI/180),this.meSword.y=this.mePlayer.y+this.mePlayer.width/p*Math.sin(this.meSword.angle*Math.PI/180)}catch(t){console.log(t)}if(this.myObj){var f=this.enemies.filter((t=>t.hasOwnProperty("playerObj")&&t.playerObj));f.push({playerObj:this.myObj});try{var m=f.sort(((t,e)=>t.playerObj.coins-e.playerObj.coins)).reverse(),y="",g=!1,v=this.mobile||this.canvas.height<550?5:10;if(m.slice(0,v).forEach(((t,e)=>{if(t.playerObj){if(!t.playerObj.hasOwnProperty("coins"))return console.log(t.playerObj);t.playerObj.id==this.myObj.id&&(g=!0);var i=t.playerObj;y+=`#${e+1}: ${i.verified?"mitblade"==i.name.toLowerCase()||"codergautam"==i.name.toLowerCase()?"[color=#FF0000]":"[color=#0000FF]":""}${i.name}${i.verified?"[/color]":""}- ${k(i.coins)}\n`}})),!g){var w=m.findIndex((t=>t.playerObj.id==this.myObj.id));y+=`...\n#${w+1}: ${this.myObj.verified?"mitblade"==this.myObj.name.toLowerCase()||"codergautam"==this.myObj.name.toLowerCase()?"[color=#FF0000]":"[color=#0000FF]":""}${this.myObj.name}${this.myObj.verified?"[/color]":""}- ${k(this.myObj.coins)}\n`}this.spectating||(this.leaderboard.setText(y),this.leaderboard.x=this.canvas.width-this.leaderboard.width-15)}catch(t){console.log(t)}try{this.spectating||this.playerCount.setText("Players: "+(Object.keys(this.enemies).length+1).toString()+(this.canvas.height<550?"":"\nFPS: "+Math.round(this.sys.game.loop.actualFps)+"\nTPS: "+this.tps+"\nPing: "+this.ping+" ms"))}catch(t){console.log(t)}if(this.myObj){this.coins.forEach((t=>{if(t.state.collected){if(t.state.collectedBy==this.myObj.id)var e=this.mePlayer.x,i=this.mePlayer.y;else try{var s=this.enemies.find((e=>e.id==t.state.collectedBy));if(!s)return t.item.destroy(),void(this.coins=this.coins.filter((e=>e.id!=t.id)));e=s.player.x,i=s.player.y}catch(t){return void console.log(t)}t.item.x=b(t.item.x,e,(6-(Math.log2(l)-Math.log2(1.875)))/10*2),t.item.y=b(t.item.y,i,(6-(Math.log2(l)-Math.log2(1.875)))/10),t.state.time+=1,n=t.item.x,r=t.item.y,o=e,a=i,(Math.hypot(o-n,a-r)<this.mePlayer.width*this.mePlayer.scale/3||t.state.time>7)&&(t.item.destroy(),this.coins=this.coins.filter((e=>e.id!=t.id)))}var n,r,o,a}));var x=this.mePlayer;this.background.setTilePosition(this.cameras.main.scrollX*this.cameras.main.zoom+(x.x-this.cameras.main.scrollX*this.cameras.main.zoom-this.canvas.width/2),this.cameras.main.scrollY*this.cameras.main.zoom+(x.y-this.cameras.main.scrollY*this.cameras.main.zoom-this.canvas.height/2)),this.background.x=x.x-this.cameras.main.displayWidth/2,this.background.y=x.y-this.cameras.main.displayHeight/2,!this.ready||this.dead||this.socket.connected||(document.write('<h1>You got disconnected</h1><br><button onclick="location.reload()"><h1>Refresh</h1></button>'),this.dead=!0)}}}function b(t,e,i){return(1-i)*t+i*e}function k(t){return t>999?parseFloat((t/1e3).toFixed(t<1e4?2:1))+"k":t}}}const dn=ln;class pn extends Phaser.Scene{constructor(t){super(),this.callback=t}preload(){this.e=!0,this.background=this.add.rectangle(0,0,document.documentElement.clientWidth,document.documentElement.clientHeight,34816).setOrigin(0).setScrollFactor(0,0).setScale(2),this.loadText=this.add.text(0,0,"Loading").setOrigin(.5,.5),this.loadText.setFontSize(this.canvas.width/20),this.loadText.x=this.canvas.width/2,this.loadText.y=this.canvas.height/2,this.load.plugin("rexvirtualjoystickplugin","/joystick.js",!0),this.load.plugin("rexbbcodetextplugin","/textplus.js",!0),this.load.image("playerPlayer","/assets/images/player.png"),this.load.image("playerSword","/assets/images/sword.png"),this.load.image("codergautamytPlayer","/assets/images/codergautamytPlayer.png"),this.load.image("codergautamytSword","/assets/images/codergautamytSword.png"),this.load.image("devilPlayer","/assets/images/devilPlayer.png"),this.load.image("devilSword","/assets/images/devilSword.png"),this.load.image("winterPlayer","/assets/images/winterPlayer.png"),this.load.image("winterSword","/assets/images/winterSword.png"),this.load.image("chefPlayer","/assets/images/chefPlayer.png"),this.load.image("chefSword","/assets/images/chefSword.png"),this.load.image("medicPlayer","/assets/images/medicPlayer.png"),this.load.image("medicSword","/assets/images/medicSword.png"),this.load.image("foxPlayer","/assets/images/foxPlayer.png"),this.load.image("foxSword","/assets/images/devilSword.png"),this.load.image("springPlayer","/assets/images/springPlayer.png"),this.load.image("springSword","/assets/images/springSword.png"),this.load.image("scythePlayer","/assets/images/scythePlayer.png"),this.load.image("scytheSword","/assets/images/scytheSword.png"),this.load.image("angelPlayer","/assets/images/angelPlayer.png"),this.load.image("angelSword","/assets/images/sword.png"),this.load.image("neonPlayer","/assets/images/neonPlayer.png"),this.load.image("neonSword","/assets/images/neonSword.png"),this.load.image("background","/assets/images/background.jpeg"),this.load.image("coin","/assets/images/coin.png"),this.load.image("chest","/assets/images/chest.png"),this.load.image("kill","/assets/images/kill.png"),this.load.image("hitParticle","/assets/images/hitparticle.png"),this.load.image("bush","/assets/images/bush.png"),this.load.image("chatbtn","/assets/images/chat.png"),this.load.image("loginbtn","/assets/images/login.png"),this.load.image("signupbtn","/assets/images/signup.png"),this.load.image("playAgainBtn","/assets/images/playAgain.png"),this.load.image("settingsBtn","/assets/images/settingsBtn.png"),this.load.image("shopBtn","/assets/images/shop.png"),this.load.audio("coin","/assets/sound/coin.m4a"),this.load.audio("damage","/assets/sound/damage.mp3"),this.load.audio("hit","/assets/sound/hitenemy.wav"),this.load.audio("winSound","/assets/sound/win.m4a"),this.load.audio("loseSound","/assets/sound/lost.mp3"),this.load.audio("chestOpen","/assets/sound/chest.wav"),this.load.image("opening","/assets/images/opening.png"),this.load.html("title","/title.html"),this.load.html("promo","/promo.html"),this.load.html("login","/login.html"),this.load.html("shop","/shop"),this.load.html("signup","/signup.html"),this.load.html("dropdown","/dropdown.html"),this.load.html("footer","/footer.html"),this.load.html("settings","/settings.html"),this.load.html("chat","/chatbox.html"),this.load.audio("openingsound","/assets/sound/opening.mp3"),this.scale.fullscreenTarget=document.getElementById("game")}create(){this.scene.stop(),this.scene.start("title")}update(){}}const fn=pn;function mn(){navigator.onLine?document.write("<h1>You're back online! Refresh to play!</h1>"):document.write('<h1>You got disconnected</h1><br><button onclick="location.reload()"><h1>Refresh</h1></button>');try{screen.orientation.lock("landscape")}catch(t){console.log("failed to lock orientation",t)}}"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js"),window.addEventListener("online",mn),window.addEventListener("offline",mn),window.addEventListener("load",(()=>{navigator.onLine||mn();var t={type:Phaser.CANVAS,width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,parent:"game",dom:{createContainer:!0,autoCenter:Phaser.Scale.CENTER_BOTH},scale:{mode:Phaser.Scale.RESIZE}},e=window.matchMedia("(pointer: coarse)").matches,i=new Phaser.Game(t),s=new fn,n=function(t){try{var e=window.localStorage,i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(t){return!1}}();if(n&&null===window.localStorage.getItem("lastAd")){window.localStorage.setItem("lastAd",Date.now());var r=Date.now()}else if(n)r=Number(window.localStorage.getItem("lastAd"));else r=Date.now();document.body.style.webkitTransform=document.body.style.msTransform=document.body.style.transform="scale(1)";var a=3e5,h=new dn((t=>{c.playPreroll=Date.now()-r>a})),c=new o(Date.now()-r>a,((t,e,i)=>{h.name=t,h.options=c.options,"auto"==h.options.server&&(h.options.server=c.optimalServer),h.openingBgm=e,h.secret=i,c.scene.start("game"),c.showPromo=!1,Date.now()-r>a&&(n?(window.localStorage.setItem("lastAd",Date.now()),r=Date.now()):r=Date.now())}));function u(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}c.mobile=e,h.mobile=e,e||(c.showPromo=!0),Object.defineProperty(c,"canvas",{get:u}),Object.defineProperty(h,"canvas",{get:u}),Object.defineProperty(s,"canvas",{get:u}),i.scene.add("title",c),i.scene.add("game",h),i.scene.add("open",s),i.scene.start("open"),document.addEventListener("contextmenu",(function(t){t.preventDefault()}))}))})()})();
//# sourceMappingURL=main.js.map